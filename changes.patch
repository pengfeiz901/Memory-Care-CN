diff --git a/README.md b/README.md
index b22493b..7d5475e 100644
--- a/README.md
+++ b/README.md
@@ -95,3 +95,34 @@ Traditional chatbots forget everything between sessions. **MemoryCare doesn't.**
 
 ## Special thanks to the MemVerge team for creating MemMachine and hosting this innovative hackathon.
 
+---
+
+## ğŸ“š å¼€å‘æ–‡æ¡£
+
+### ğŸ“– è¯¦ç»†å¼€å‘æŒ‡å—
+**é›¶åŸºç¡€ç”¨æˆ·å¿«é€Ÿä¸Šæ‰‹æŒ‡å—**ï¼šæŸ¥çœ‹ [PROJECT_GUIDE.md](./PROJECT_GUIDE.md)
+
+åŒ…å«å†…å®¹ï¼š
+- âœ… é¡¹ç›®æ¶æ„è¯¦è§£ï¼ˆå¸¦å›¾è¡¨ï¼‰
+- âœ… ä»£ç ç»“æ„è¯´æ˜ï¼ˆæ¯ä¸ªæ–‡ä»¶çš„ä½œç”¨ï¼‰
+- âœ… æ ¸å¿ƒæ¦‚å¿µç†è§£ï¼ˆè®°å¿†ç±»å‹ã€æ•°æ®æµå‘ç­‰ï¼‰
+- âœ… å¦‚ä½•ä¿®æ”¹ä»£ç çš„å®Œæ•´æ•™ç¨‹
+- âœ… 5ä¸ªå¸¸è§ä¿®æ”¹åœºæ™¯çš„è¯¦ç»†ç¤ºä¾‹
+- âœ… è°ƒè¯•æŠ€å·§å’Œæœ€ä½³å®è·µ
+
+### âš¡ å¿«é€Ÿå‚è€ƒ
+**å¸¸ç”¨ä»£ç ç‰‡æ®µé€ŸæŸ¥**ï¼šæŸ¥çœ‹ [QUICK_REFERENCE.md](./QUICK_REFERENCE.md)
+
+åŒ…å«å†…å®¹ï¼š
+- âœ… æ–‡ä»¶é€ŸæŸ¥è¡¨
+- âœ… å¸¸ç”¨ä»£ç ç‰‡æ®µï¼ˆå¤åˆ¶å³ç”¨ï¼‰
+- âœ… å¸¸è§ä¿®æ”¹åœºæ™¯é€ŸæŸ¥
+- âœ… å…³é”®ä½ç½®ç´¢å¼•
+- âœ… è°ƒè¯•å‘½ä»¤
+
+**é€‚åˆäººç¾¤**ï¼š
+- ğŸ¯ é›¶åŸºç¡€å¼€å‘è€…ï¼šä»ç†è§£é¡¹ç›®åˆ°ä¸Šæ‰‹ä¿®æ”¹
+- ğŸ”§ æœ‰ç»éªŒçš„å¼€å‘è€…ï¼šå¿«é€ŸæŸ¥æ‰¾ä»£ç ä½ç½®å’Œç¤ºä¾‹
+- ğŸ“ ä»£ç ç»´æŠ¤è€…ï¼šå¿«é€Ÿå®šä½å’Œä¿®æ”¹åŠŸèƒ½
+
+---
diff --git a/api/__pycache__/__init__.cpython-313.pyc b/api/__pycache__/__init__.cpython-313.pyc
index bf54ce6..d09ec2f 100644
Binary files a/api/__pycache__/__init__.cpython-313.pyc and b/api/__pycache__/__init__.cpython-313.pyc differ
diff --git a/api/__pycache__/main.cpython-313.pyc b/api/__pycache__/main.cpython-313.pyc
index 556a380..be89fd5 100644
Binary files a/api/__pycache__/main.cpython-313.pyc and b/api/__pycache__/main.cpython-313.pyc differ
diff --git a/api/main.py b/api/main.py
index baa9dbe..4544314 100644
--- a/api/main.py
+++ b/api/main.py
@@ -100,22 +100,45 @@ class RememberRequest(BaseModel):
 
 # HELPER FUNCTION FOR MEDICATION RESET #
 def check_and_reset_medications(patient_id: int):
-    """Check medication expiration and reset daily counts"""
+    """
+    æ£€æŸ¥å¹¶é‡ç½®è¯ç‰©çŠ¶æ€
+    
+    æ­¤å‡½æ•°ä¼šæ£€æŸ¥æ‚£è€…çš„æ‰€æœ‰æ¿€æ´»è¯ç‰©ï¼Œå¦‚æœè¯ç‰©çš„ç»“æŸæ—¥æœŸå·²è¿‡ï¼Œ
+    åˆ™è‡ªåŠ¨å°†è¯ç‰©æ ‡è®°ä¸ºéæ¿€æ´»çŠ¶æ€ã€‚
+    
+    å‚æ•°:
+        patient_id: æ‚£è€…æ•°æ®åº“ IDï¼ˆæ•´æ•°ï¼‰
+        
+    å·¥ä½œæµç¨‹:
+        1. è·å–æ‚£è€…æ‰€æœ‰æ¿€æ´»çš„è¯ç‰©
+        2. æ£€æŸ¥æ¯ä¸ªè¯ç‰©çš„ç»“æŸæ—¥æœŸ
+        3. å¦‚æœç»“æŸæ—¥æœŸæ—©äºä»Šå¤©ï¼Œå°† active è®¾ä¸º False
+        4. æäº¤æ›´æ”¹åˆ°æ•°æ®åº“
+    """
+    # è·å–æ•°æ®åº“ä¼šè¯ï¼ˆä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ç¡®ä¿ä¼šè¯æ­£ç¡®å…³é—­ï¼‰
     with get_session() as s:
+        # è·å–ä»Šå¤©çš„æ—¥æœŸï¼ˆä¸åŒ…å«æ—¶é—´éƒ¨åˆ†ï¼‰
         today = datetime.now().date()
         
-        # Get active medications
+        # æ­¥éª¤ 1: æŸ¥è¯¢æ‚£è€…æ‰€æœ‰æ¿€æ´»çš„è¯ç‰©
+        # æ¡ä»¶ï¼šæ‚£è€… ID åŒ¹é…ä¸”è¯ç‰©å¤„äºæ¿€æ´»çŠ¶æ€
         meds = s.exec(select(Medication).where(
-            Medication.patient_id == patient_id,
-            Medication.active == True
-        )).all()
+            Medication.patient_id == patient_id,  # åŒ¹é…æ‚£è€… ID
+            Medication.active == True  # åªæŸ¥è¯¢æ¿€æ´»çš„è¯ç‰©
+        )).all()  # è·å–æ‰€æœ‰åŒ¹é…çš„è®°å½•
         
+        # æ­¥éª¤ 2: éå†æ¯ä¸ªè¯ç‰©ï¼Œæ£€æŸ¥æ˜¯å¦è¿‡æœŸ
         for med in meds:
-            # Check if medication period is over
+            # æ£€æŸ¥è¯ç‰©çš„ç»“æŸæ—¥æœŸ
+            # å¦‚æœè¯ç‰©æœ‰ç»“æŸæ—¥æœŸï¼ˆend_date ä¸ä¸º Noneï¼‰ä¸”ç»“æŸæ—¥æœŸæ—©äºä»Šå¤©
             if med.end_date and med.end_date.date() < today:
+                # å°†è¯ç‰©æ ‡è®°ä¸ºéæ¿€æ´»çŠ¶æ€
                 med.active = False
+                # å°†ä¿®æ”¹åçš„è¯ç‰©å¯¹è±¡æ·»åŠ åˆ°ä¼šè¯ï¼ˆæ ‡è®°ä¸ºéœ€è¦æ›´æ–°ï¼‰
                 s.add(med)
         
+        # æ­¥éª¤ 3: æäº¤æ‰€æœ‰æ›´æ”¹åˆ°æ•°æ®åº“
+        # è¿™ä¼šå°†æ‰€æœ‰æ ‡è®°ä¸ºéœ€è¦æ›´æ–°çš„è®°å½•å†™å…¥æ•°æ®åº“
         s.commit()
 
 # FILTER FUNCTION FOR MEMORY EXTRACTION AND ROUTING #
@@ -171,43 +194,69 @@ def extract_and_route_memories(user_id: str, user_message: str, assistant_reply:
                 Your extraction:"""
 
     try:
+        # æ­¥éª¤ 1: è°ƒç”¨ LLM åˆ†æå¯¹è¯ï¼Œæå–äº‹å®ä¿¡æ¯
+        # ä½¿ç”¨ä¸“é—¨çš„ç³»ç»Ÿæç¤ºè¯ï¼ŒæŒ‡å¯¼ LLM è¿›è¡Œè®°å¿†è·¯ç”±åˆ†æ
         extraction = chat(
-            "You are a memory routing specialist.",
-            [{"role": "user", "content": routing_prompt}]
+            "You are a memory routing specialist.",  # ç³»ç»Ÿæç¤ºè¯ï¼šå®šä¹‰ LLM è§’è‰²
+            [{"role": "user", "content": routing_prompt}]  # ç”¨æˆ·æ¶ˆæ¯ï¼šåŒ…å«å®Œæ•´çš„è·¯ç”±æç¤ºè¯
         )
         
+        # æ­¥éª¤ 2: æ£€æŸ¥ LLM æ˜¯å¦è¿”å› "NO_STORAGE"ï¼ˆè¡¨ç¤ºæ²¡æœ‰éœ€è¦å­˜å‚¨çš„ä¿¡æ¯ï¼‰
+        # è½¬æ¢ä¸ºå¤§å†™è¿›è¡Œæ¯”è¾ƒï¼Œé¿å…å¤§å°å†™é—®é¢˜
         if "NO_STORAGE" in extraction.upper():
-            return []
+            return []  # å¦‚æœæ²¡æœ‰éœ€è¦å­˜å‚¨çš„ä¿¡æ¯ï¼Œè¿”å›ç©ºåˆ—è¡¨
         
-        memories_to_store = []
+        # æ­¥éª¤ 3: è§£æ LLM è¿”å›çš„ç»“æ„åŒ–æ•°æ®
+        memories_to_store = []  # åˆå§‹åŒ–å­˜å‚¨åˆ—è¡¨
+        # å°† LLM è¿”å›çš„æ–‡æœ¬æŒ‰è¡Œåˆ†å‰²ï¼ˆæ¯è¡Œä»£è¡¨ä¸€æ¡è®°å¿†ï¼‰
         for line in extraction.strip().split("\n"):
+            # å»é™¤æ¯è¡Œçš„é¦–å°¾ç©ºç™½å­—ç¬¦
             line = line.strip()
+            # è·³è¿‡ç©ºè¡Œæˆ–åŒ…å« "NO_STORAGE" çš„è¡Œ
             if not line or "NO_STORAGE" in line:
                 continue
             
-            # Parse STORE_FOR:user|[category]|fact
+            # æ­¥éª¤ 4: è§£ææ ¼å¼åŒ–çš„è®°å¿†è¡Œ
+            # æ ¼å¼ï¼šSTORE_FOR:user_id|[category]|fact_text
             if line.startswith("STORE_FOR:"):
                 try:
+                    # ä½¿ç”¨ "|" ä½œä¸ºåˆ†éš”ç¬¦ï¼Œæœ€å¤šåˆ†å‰²æˆ 3 éƒ¨åˆ†
+                    # parts[0]: "STORE_FOR:user_id"
+                    # parts[1]: "[category]"
+                    # parts[2]: "fact_text"
                     parts = line.split("|", 2)
+                    print(f"[DEBUG] line: {line}, parts: {parts}")
+                    
+                    # æå–ç›®æ ‡ç”¨æˆ· IDï¼šå»é™¤ "STORE_FOR:" å‰ç¼€å¹¶å»é™¤ç©ºç™½
                     target_user = parts[0].replace("STORE_FOR:", "").strip()
+                    # æå–åˆ†ç±»ï¼šå»é™¤æ–¹æ‹¬å·å¹¶å»é™¤ç©ºç™½
                     category = parts[1].strip().replace("[", "").replace("]", "")
+                    # æå–äº‹å®æ–‡æœ¬ï¼šå»é™¤ç©ºç™½
                     fact = parts[2].strip()
                     
+                    # æ­¥éª¤ 5: éªŒè¯äº‹å®æ–‡æœ¬çš„æœ‰æ•ˆæ€§
+                    # è¦æ±‚ï¼šéç©ºä¸”è‡³å°‘åŒ…å« 3 ä¸ªè¯ï¼ˆç¡®ä¿æ˜¯æœ‰æ„ä¹‰çš„äº‹å®ï¼‰
                     if fact and len(fact.split()) >= 3:
+                        # å°†è§£æå‡ºçš„è®°å¿†æ·»åŠ åˆ°åˆ—è¡¨
+                        print(f"[DEBUG] should_attempt_extraction() - fact: {fact}")
                         memories_to_store.append({
-                            "user_id": target_user,
-                            "text": fact,
-                            "category": category
+                            "user_id": target_user,  # ç›®æ ‡ç”¨æˆ· ID
+                            "text": fact,  # äº‹å®æ–‡æœ¬ï¼ˆç¬¬ä¸€äººç§°è§†è§’ï¼‰
+                            "category": category  # è®°å¿†åˆ†ç±»
                         })
                 except Exception as e:
+                    # å¦‚æœè§£ææŸè¡Œæ—¶å‡ºé”™ï¼Œæ‰“å°è­¦å‘Šä½†ç»§ç»­å¤„ç†å…¶ä»–è¡Œ
                     print(f"[WARN] Failed to parse line: {line} | {e}")
-                    continue
+                    continue  # è·³è¿‡å½“å‰è¡Œï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€è¡Œ
         
+        # æ­¥éª¤ 6: è¿”å›æ‰€æœ‰æˆåŠŸè§£æçš„è®°å¿†åˆ—è¡¨
+        print(f"[DEBUG] memories_to_store: {memories_to_store}")
         return memories_to_store
         
     except Exception as e:
+        # å¦‚æœæ•´ä¸ªæå–è¿‡ç¨‹å‡ºé”™ï¼ˆå¦‚ LLM è°ƒç”¨å¤±è´¥ï¼‰ï¼Œè®°å½•é”™è¯¯å¹¶è¿”å›ç©ºåˆ—è¡¨
         print(f"[ERROR] Memory routing failed: {e}")
-        return []
+        return []  # è¿”å›ç©ºåˆ—è¡¨ï¼Œä¸å½±å“ä¸»æµç¨‹
     
 
 def should_attempt_extraction(message: str) -> bool:
@@ -222,72 +271,110 @@ def should_attempt_extraction(message: str) -> bool:
     
     # 1. Filter out very short messages (unlikely to contain meaningful info)
     word_count = len(message.split())
-    if word_count < 3:
-        return False
+    #if word_count < 3:
+    #    print(f"[DEBUG] should_attempt_extraction() - word_count < 3: {word_count}")
+    #    return False
     
     # 2. Filter out questions - these are requests for information, not statements of fact
     question_words = [
+        # English question words
         "what", "who", "when", "where", "why", "how",
         "which", "whose", "whom",
         "do you", "can you", "could you", "would you", "will you",
         "should you", "are you", "is there", "did you",
-        "tell me", "show me", "help me", "explain"
+        "tell me", "show me", "help me", "explain",
+        # Chinese question words (ä¸­æ–‡ç–‘é—®è¯)
+        "ä»€ä¹ˆ", "è°", "ä½•æ—¶", "å“ªé‡Œ", "ä¸ºä»€ä¹ˆ", "æ€ä¹ˆ", "æ€æ ·",
+        "å“ªä¸ª", "å“ªäº›", "è°çš„",
+        "ä½ èƒ½", "ä½ ä¼š", "ä½ èƒ½å‘Šè¯‰æˆ‘", "ä½ èƒ½å¸®æˆ‘", "ä½ èƒ½", "ä½ ä¼š",
+        "å‘Šè¯‰æˆ‘", "ç»™æˆ‘çœ‹", "å¸®æˆ‘", "è§£é‡Šä¸€ä¸‹", "è§£é‡Š",
+        "è¯·é—®", "é—®ä¸€ä¸‹", "æƒ³çŸ¥é“", "æƒ³äº†è§£"
     ]
     
     if any(message_lower.startswith(q) for q in question_words):
+        print(f"[DEBUG] question_words return False")
         return False
     
     if message.endswith("?"):
+        print(f"[DEBUG] message.endswith('?') return False")
         return False
     
     # 3. Filter out greetings and social pleasantries
     greetings = [
+        # English greetings
         "hello", "hi ", "hi,", "hey", "hey there",
         "good morning", "good afternoon", "good evening", "good night",
         "thanks", "thank you", "thank", "thx",
         "ok", "okay", "sure", "yes", "no", "yeah", "yep", "nope",
-        "bye", "goodbye", "see you", "talk later"
+        "bye", "goodbye", "see you", "talk later",
+        # Chinese greetings (ä¸­æ–‡é—®å€™è¯­)
+        "ä½ å¥½", "æ‚¨å¥½", "æ—©ä¸Šå¥½", "ä¸‹åˆå¥½", "æ™šä¸Šå¥½", "æ™šå®‰",
+        "è°¢è°¢", "å¤šè°¢", "æ„Ÿè°¢",
+        "å¥½çš„", "å¯ä»¥", "è¡Œ", "æ˜¯çš„", "ä¸æ˜¯", "å¯¹", "ä¸å¯¹",
+        "å†è§", "æ‹œæ‹œ", "å›å¤´è§", "å¾…ä¼šè§"
     ]
     
     if any(message_lower.startswith(g) for g in greetings):
+        print(f"[DEBUG] greetings return False")
         return False
     
     # 4. Filter out system/meta requests
     meta_requests = [
+        # English meta requests
         "clear", "delete", "reset", "forget",
-        "remember this", "save this", "store this"  # explicit commands handled differently
+        "remember this", "save this", "store this",  # explicit commands handled differently
+        # Chinese meta requests (ä¸­æ–‡ç³»ç»Ÿè¯·æ±‚)
+        "æ¸…é™¤", "åˆ é™¤", "é‡ç½®", "å¿˜è®°",
+        "è®°ä½è¿™ä¸ª", "ä¿å­˜è¿™ä¸ª", "å­˜å‚¨è¿™ä¸ª"
     ]
     
     if any(meta in message_lower for meta in meta_requests):
+        print(f"[DEBUG] meta_requests return False")
         return False
     
     # 5. POSITIVE SIGNALS - Strong indicators of factual information
     info_indicators = [
         # Identity and personal info
         "i am", "i'm", "my name is", "i was born", "i live in",
+        # Chinese: èº«ä»½å’Œä¸ªäººä¿¡æ¯
+        "æˆ‘æ˜¯", "æˆ‘å«", "æˆ‘å‡ºç”Ÿ", "æˆ‘ä½åœ¨", "æˆ‘æ¥è‡ª",
         
         # Preferences and opinions
         "i like", "i love", "i enjoy", "i prefer", "i hate", "i don't like",
         "my favorite", "i want", "i need",
+        # Chinese: åå¥½å’Œè§‚ç‚¹
+        "æˆ‘å–œæ¬¢", "æˆ‘çˆ±", "æˆ‘äº«å—", "æˆ‘æ›´å–œæ¬¢", "æˆ‘è®¨åŒ", "æˆ‘ä¸å–œæ¬¢",
+        "æˆ‘æœ€å–œæ¬¢", "æˆ‘æƒ³è¦", "æˆ‘éœ€è¦",
         
         # Relationships and family
         "my ", "my wife", "my husband", "my son", "my daughter",
         "my brother", "my sister", "my friend", "my mother", "my father",
+        # Chinese: å…³ç³»å’Œå®¶åº­
+        "æˆ‘çš„", "æˆ‘å¦»å­", "æˆ‘ä¸ˆå¤«", "æˆ‘å„¿å­", "æˆ‘å¥³å„¿",
+        "æˆ‘å…„å¼Ÿ", "æˆ‘å§å¦¹", "æˆ‘æœ‹å‹", "æˆ‘æ¯äº²", "æˆ‘çˆ¶äº²", "æˆ‘å¦ˆå¦ˆ", "æˆ‘çˆ¸çˆ¸",
         
         # Activities and routines
         "i work", "i go to", "i take", "i eat", "i drink", "i play",
         "i watch", "i read", "i listen", "i exercise",
         "every day", "every morning", "every night", "usually",
+        # Chinese: æ´»åŠ¨å’Œæ—¥å¸¸
+        "æˆ‘å·¥ä½œ", "æˆ‘å»", "æˆ‘åƒ", "æˆ‘å–", "æˆ‘ç©", "æˆ‘çœ‹", "æˆ‘è¯»", "æˆ‘å¬", "æˆ‘é”»ç‚¼",
+        "æ¯å¤©", "æ¯å¤©æ—©ä¸Š", "æ¯å¤©æ™šä¸Š", "é€šå¸¸", "ç»å¸¸",
         
         # Medical and health (important for dementia care)
         "i have", "i take medication", "my doctor", "i'm allergic",
+        # Chinese: åŒ»ç–—å’Œå¥åº·
+        "æˆ‘æœ‰", "æˆ‘åƒè¯", "æˆ‘æœè¯", "æˆ‘çš„åŒ»ç”Ÿ", "æˆ‘è¿‡æ•",
         
         # Past experiences and memories
         "i used to", "i remember", "i grew up", "when i was",
-        "i worked at", "i went to", "i met"
+        "i worked at", "i went to", "i met",
+        # Chinese: è¿‡å»çš„ç»å†å’Œè®°å¿†
+        "æˆ‘ä»¥å‰", "æˆ‘è®°å¾—", "æˆ‘é•¿å¤§", "å½“æˆ‘", "æˆ‘åœ¨", "æˆ‘å»è¿‡", "æˆ‘è§è¿‡"
     ]
     
     if any(indicator in message_lower for indicator in info_indicators):
+        print(f"[DEBUG] ****** info_indicators return True")
         return True
     
     # 6. Check for proper nouns (names, places) - often indicates factual content
@@ -296,22 +383,49 @@ def should_attempt_extraction(message: str) -> bool:
     if len(words) > 1:
         capitalized_count = sum(1 for word in words[1:] if word and word[0].isupper())
         if capitalized_count >= 1:  # Has at least one proper noun
+            print(f"proper nouns return True")
             return True
     
     # 7. Default behavior for medium-length declarative statements
     # If it's 5+ words and doesn't match filters above, might be worth checking
     if word_count >= 5 and not message.endswith("?"):
+        print(f"[DEBUG] word_count >= 5 and not message.endswith('?') return True")
         return True
     
     # 8. Default: don't extract (be conservative to save API calls)
+    print(f"[DEBUG] default return False")
     return False
 
 # ============================
 #        ROUTES
 # ============================
 
+# FASTAPI routes #
 @app.get("/health")
 def health() -> Dict[str, Any]:
+    """
+    å¥åº·æ£€æŸ¥ç«¯ç‚¹
+    
+    ç”¨äºæ£€æŸ¥ API æœåŠ¡å™¨å’Œ MemMachine æœåŠ¡çš„è¿è¡ŒçŠ¶æ€ã€‚
+    é€šå¸¸ç”¨äºç›‘æ§ã€è´Ÿè½½å‡è¡¡å™¨å¥åº·æ£€æŸ¥æˆ–ç³»ç»Ÿè¯Šæ–­ã€‚
+    
+    è¿”å›:
+        Dict[str, Any]: åŒ…å«ä»¥ä¸‹å­—æ®µçš„å­—å…¸ï¼š
+            - ok (bool): æ“ä½œæ˜¯å¦æˆåŠŸ
+            - memmachine: MemMachine æœåŠ¡çš„å¥åº·çŠ¶æ€ä¿¡æ¯
+    
+    å¼‚å¸¸:
+        HTTPException(500): å¦‚æœ MemMachine æœåŠ¡ä¸å¯ç”¨æˆ–å‘ç”Ÿå…¶ä»–é”™è¯¯
+    
+    ç¤ºä¾‹å“åº”:
+        {
+            "ok": True,
+            "memmachine": {
+                "status": "healthy",
+                ...
+            }
+        }
+    """
     try:
         return {"ok": True, "memmachine": mm.health()}
     except Exception as e:
@@ -320,6 +434,44 @@ def health() -> Dict[str, Any]:
 # -------------------- AUTH --------------------
 @app.post("/auth/doctor/login")
 def doctor_login(payload: DoctorLogin):
+    """
+    åŒ»ç”Ÿç™»å½•ç«¯ç‚¹
+    
+    éªŒè¯åŒ»ç”Ÿå‡­è¯å¹¶é¢å‘è®¤è¯ Tokenã€‚ç›®å‰ä»…æ”¯æŒç¡¬ç¼–ç çš„åŒ»ç”Ÿè´¦æˆ·ã€‚
+    
+    å‚æ•°:
+        payload (DoctorLogin): åŒ…å«ä»¥ä¸‹å­—æ®µçš„è¯·æ±‚ä½“ï¼š
+            - username (str): åŒ»ç”Ÿç”¨æˆ·åï¼ˆå½“å‰ä»…æ”¯æŒ "doctor"ï¼‰
+            - password (str): åŒ»ç”Ÿå¯†ç ï¼ˆå½“å‰ä»…æ”¯æŒ "doctor"ï¼‰
+    
+    è¿”å›:
+        Dict[str, Any]: åŒ…å«ä»¥ä¸‹å­—æ®µçš„å­—å…¸ï¼š
+            - ok (bool): æ“ä½œæ˜¯å¦æˆåŠŸ
+            - token (str): è®¤è¯ Tokenï¼Œç”¨äºåç»­ API è°ƒç”¨çš„èº«ä»½éªŒè¯
+            - role (str): ç”¨æˆ·è§’è‰²ï¼Œå›ºå®šä¸º "doctor"
+    
+    å¼‚å¸¸:
+        HTTPException(401): å¦‚æœç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®
+    
+    æ³¨æ„:
+        - Token æœ‰æ•ˆæœŸä¸º 8 å°æ—¶
+        - Token æ ¼å¼ï¼šä»¥ "doc_" å¼€å¤´çš„éšæœºå­—ç¬¦ä¸²
+        - ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨æ›´å®‰å…¨çš„è®¤è¯æœºåˆ¶ï¼ˆå¦‚ JWT + å¯†ç å“ˆå¸Œï¼‰
+    
+    ç¤ºä¾‹è¯·æ±‚:
+        POST /auth/doctor/login
+        {
+            "username": "doctor",
+            "password": "doctor"
+        }
+    
+    ç¤ºä¾‹å“åº”:
+        {
+            "ok": True,
+            "token": "doc_abc123...",
+            "role": "doctor"
+        }
+    """
     token = issue_doctor_token(payload.username, payload.password)
     if not token:
         raise HTTPException(401, "Invalid doctor credentials")
@@ -327,56 +479,132 @@ def doctor_login(payload: DoctorLogin):
 
 @app.post("/auth/patient/signup")
 def patient_signup(payload: PatientSignup):
+    """
+    æ‚£è€…æ³¨å†Œç«¯ç‚¹
+    
+    åˆ›å»ºæ–°æ‚£è€…è´¦æˆ·ï¼Œå°†ä¿¡æ¯å­˜å‚¨åˆ°æ•°æ®åº“å’Œ MemMachineã€‚
+    åŒæ—¶åˆ›å»ºæƒ…æ™¯è®°å¿†ï¼ˆæ³¨å†Œäº‹ä»¶ï¼‰å’Œæ¡£æ¡ˆè®°å¿†ï¼ˆä¸ªäººä¿¡æ¯ï¼‰ã€‚
+    """
+    # æ­¥éª¤ 1: æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
     with get_session() as s:
+        # æŸ¥è¯¢æ•°æ®åº“ä¸­æ˜¯å¦å·²æœ‰ç›¸åŒç”¨æˆ·åçš„æ‚£è€…
         existing = s.exec(select(Patient).where(Patient.username == payload.username)).first()
+        # å¦‚æœç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¿”å› 409 å†²çªé”™è¯¯
         if existing:
             raise HTTPException(409, "Username already exists")
+        
+        # æ­¥éª¤ 2: åˆ›å»ºæ–°æ‚£è€…è®°å½•
+        # ä½¿ç”¨è¯·æ±‚æ•°æ®åˆ›å»º Patient å¯¹è±¡
         p = Patient(
-            username=payload.username,
-            password=payload.password,
-            full_name=payload.full_name,
-            family_info=payload.family_info,
-            emergency_contact_name=payload.emergency_contact_name,
-            emergency_contact_phone=payload.emergency_contact_phone,
-            hobbies=payload.hobbies,
+            username=payload.username,  # ç”¨æˆ·åï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
+            password=payload.password,  # å¯†ç ï¼ˆæ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨å“ˆå¸ŒåŠ å¯†ï¼‰
+            full_name=payload.full_name,  # å…¨å
+            family_info=payload.family_info,  # å®¶åº­ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
+            emergency_contact_name=payload.emergency_contact_name,  # ç´§æ€¥è”ç³»äººå§“åï¼ˆå¯é€‰ï¼‰
+            emergency_contact_phone=payload.emergency_contact_phone,  # ç´§æ€¥è”ç³»äººç”µè¯ï¼ˆå¯é€‰ï¼‰
+            hobbies=payload.hobbies,  # å…´è¶£çˆ±å¥½ï¼ˆå¯é€‰ï¼‰
         )
+        # å°†æ–°æ‚£è€…æ·»åŠ åˆ°æ•°æ®åº“ä¼šè¯
         s.add(p)
+        # æäº¤äº‹åŠ¡ï¼Œå°†æ•°æ®å†™å…¥æ•°æ®åº“
         s.commit()
 
+    # æ­¥éª¤ 3: ä¸ºæ‚£è€…é¢å‘è®¤è¯ Token
+    # Token ç”¨äºåç»­ API è°ƒç”¨çš„èº«ä»½éªŒè¯
     token = issue_patient_token(payload.username)
 
+    # æ­¥éª¤ 4: å‡†å¤‡è®°å¿†æ•°æ®
+    # æƒ…æ™¯è®°å¿†ï¼šè®°å½•æ³¨å†Œäº‹ä»¶ï¼ˆä¸´æ—¶æ€§è®°å¿†ï¼‰
     episodic_text = (
         f"{payload.full_name} signed up for MemoryCare on {datetime.now().strftime('%Y-%m-%d')}."
     )
+    
+    # æ¡£æ¡ˆè®°å¿†ï¼šå­˜å‚¨ä¸ªäººä¿¡æ¯ï¼ˆæ°¸ä¹…æ€§è®°å¿†ï¼‰
+    # ä½¿ç”¨ or è¿ç®—ç¬¦æä¾›é»˜è®¤å€¼ï¼Œç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½æœ‰å€¼
     profile_data = {
-        "full_name": payload.full_name,
-        "family_info": payload.family_info or "Not provided",
-        "emergency_contact_name": payload.emergency_contact_name or "Not provided",
-        "emergency_contact_phone": payload.emergency_contact_phone or "Not provided",
-        "hobbies": payload.hobbies or "Not shared",
-        "category": "personal_info"
+        "full_name": payload.full_name,  # å…¨å
+        "family_info": payload.family_info or "Not provided",  # å®¶åº­ä¿¡æ¯ï¼Œå¦‚æœä¸ºç©ºåˆ™ä½¿ç”¨é»˜è®¤æ–‡æœ¬
+        "emergency_contact_name": payload.emergency_contact_name or "Not provided",  # ç´§æ€¥è”ç³»äººå§“å
+        "emergency_contact_phone": payload.emergency_contact_phone or "Not provided",  # ç´§æ€¥è”ç³»äººç”µè¯
+        "hobbies": payload.hobbies or "Not shared",  # å…´è¶£çˆ±å¥½
+        "category": "personal_info"  # åˆ†ç±»æ ‡è®°ï¼Œç”¨äºè®°å¿†ç»„ç»‡
     }
+    
+    # æ­¥éª¤ 5: å¦‚æœæœ‰ç´§æ€¥è”ç³»äººä¿¡æ¯ï¼Œå•ç‹¬å­˜å‚¨ä¸€æ¡åˆå¹¶çš„æ¡£æ¡ˆè®°å¿†
+    # è¿™æ ·å¯ä»¥åœ¨éœ€è¦æ—¶å¿«é€Ÿæ£€ç´¢ç´§æ€¥è”ç³»äººä¿¡æ¯
     if payload.emergency_contact_name:
         profile_data["emergency_contact_name"] = payload.emergency_contact_name
     if payload.emergency_contact_phone:
         profile_data["emergency_contact_phone"] = payload.emergency_contact_phone
-        # Store a combined emergency contact entry in profile memory
+        # å­˜å‚¨åˆå¹¶çš„ç´§æ€¥è”ç³»äººä¿¡æ¯åˆ°æ¡£æ¡ˆè®°å¿†
+        # æ ¼å¼ï¼š"{å§“å} - Phone: {ç”µè¯}"
         mm.remember_profile(
-            user_id=payload.username,
-            key="emergency_contact",
-            value=f"{payload.emergency_contact_name or 'Unknown'} - Phone: {payload.emergency_contact_phone}",
-            category="emergency_info"
+            user_id=payload.username,  # ç”¨æˆ· ID
+            key="emergency_contact",  # è®°å¿†é”®å
+            value=f"{payload.emergency_contact_name or 'Unknown'} - Phone: {payload.emergency_contact_phone}",  # åˆå¹¶çš„å€¼
+            category="emergency_info"  # åˆ†ç±»ä¸ºç´§æ€¥ä¿¡æ¯
         )
+    
+    # æ­¥éª¤ 6: åŒæ—¶å­˜å‚¨æƒ…æ™¯è®°å¿†å’Œæ¡£æ¡ˆè®°å¿†
+    # store_dual_memory ä¼šåŒæ—¶è°ƒç”¨ remember() å’Œ remember_profile()
     mm.store_dual_memory(
-        user_id=payload.username,
-        episodic_text=episodic_text,
-        profile_data=profile_data,
-        tags=["signup", "profile_creation"]
+        user_id=payload.username,  # ç”¨æˆ· ID
+        episodic_text=episodic_text,  # æƒ…æ™¯è®°å¿†æ–‡æœ¬
+        profile_data=profile_data,  # æ¡£æ¡ˆè®°å¿†æ•°æ®
+        tags=["signup", "profile_creation"]  # æ ‡ç­¾ï¼Œç”¨äºè®°å¿†åˆ†ç±»å’Œæ£€ç´¢
     )
+    
+    # æ­¥éª¤ 7: è¿”å›æˆåŠŸå“åº”ï¼ŒåŒ…å« Token å’Œè§’è‰²ä¿¡æ¯
     return {"ok": True, "token": token, "role": "patient"}
 
 @app.post("/auth/patient/login")
 def patient_login(payload: PatientLogin):
+    """
+    æ‚£è€…ç™»å½•ç«¯ç‚¹
+    
+    éªŒè¯æ‚£è€…å‡­è¯ï¼Œè®°å½•ç™»å½•äº‹ä»¶åˆ°è®°å¿†ç³»ç»Ÿï¼Œå¹¶é¢å‘è®¤è¯ Tokenã€‚
+    
+    å‚æ•°:
+        payload (PatientLogin): åŒ…å«ä»¥ä¸‹å­—æ®µçš„è¯·æ±‚ä½“ï¼š
+            - username (str): æ‚£è€…ç”¨æˆ·åï¼ˆæ³¨å†Œæ—¶åˆ›å»ºçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼‰
+            - password (str): æ‚£è€…å¯†ç ï¼ˆæ³¨æ„ï¼šå½“å‰ä¸ºæ˜æ–‡æ¯”è¾ƒï¼Œç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨å“ˆå¸Œï¼‰
+    
+    è¿”å›:
+        Dict[str, Any]: åŒ…å«ä»¥ä¸‹å­—æ®µçš„å­—å…¸ï¼š
+            - ok (bool): æ“ä½œæ˜¯å¦æˆåŠŸ
+            - token (str): è®¤è¯ Tokenï¼Œç”¨äºåç»­ API è°ƒç”¨çš„èº«ä»½éªŒè¯
+            - role (str): ç”¨æˆ·è§’è‰²ï¼Œå›ºå®šä¸º "patient"
+    
+    å¼‚å¸¸:
+        HTTPException(401): å¦‚æœç”¨æˆ·åä¸å­˜åœ¨æˆ–å¯†ç ä¸æ­£ç¡®
+    
+    å·¥ä½œæµç¨‹:
+        1. ä»æ•°æ®åº“æŸ¥è¯¢æ‚£è€…è®°å½•
+        2. éªŒè¯ç”¨æˆ·åå’Œå¯†ç 
+        3. å°†ç™»å½•äº‹ä»¶è®°å½•åˆ° MemMachine æƒ…æ™¯è®°å¿†
+        4. é¢å‘è®¤è¯ Token
+        5. è¿”å› Token å’Œè§’è‰²ä¿¡æ¯
+    
+    æ³¨æ„:
+        - Token æœ‰æ•ˆæœŸä¸º 8 å°æ—¶
+        - Token æ ¼å¼ï¼šä»¥ "pat_" å¼€å¤´çš„éšæœºå­—ç¬¦ä¸²
+        - ç™»å½•äº‹ä»¶ä¼šè‡ªåŠ¨å­˜å‚¨åˆ°è®°å¿†ç³»ç»Ÿï¼Œç”¨äºè¿½è¸ªæ‚£è€…æ´»åŠ¨
+        - ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨å¯†ç å“ˆå¸Œï¼ˆå¦‚ bcryptï¼‰è€Œä¸æ˜¯æ˜æ–‡æ¯”è¾ƒ
+    
+    ç¤ºä¾‹è¯·æ±‚:
+        POST /auth/patient/login
+        {
+            "username": "patient123",
+            "password": "password123"
+        }
+    
+    ç¤ºä¾‹å“åº”:
+        {
+            "ok": True,
+            "token": "pat_xyz789...",
+            "role": "patient"
+        }
+    """
     with get_session() as s:
         p = s.exec(select(Patient).where(Patient.username == payload.username)).first()
         if not p or p.password != payload.password:
@@ -392,6 +620,56 @@ def patient_login(payload: PatientLogin):
 # -------------------- DOCTOR ROUTES --------------------
 @app.get("/doctor/patients")
 def list_patients(token: str = Query(...)):
+    """
+    è·å–æ‰€æœ‰æ‚£è€…åˆ—è¡¨ç«¯ç‚¹ï¼ˆåŒ»ç”Ÿä¸“ç”¨ï¼‰
+    
+    è¿”å›ç³»ç»Ÿä¸­æ‰€æœ‰å·²æ³¨å†Œæ‚£è€…çš„ç®€è¦ä¿¡æ¯åˆ—è¡¨ã€‚
+    ä»…é™åŒ»ç”Ÿè§’è‰²è®¿é—®ï¼Œç”¨äºåŒ»ç”Ÿé€‰æ‹©è¦ç®¡ç†çš„æ‚£è€…ã€‚
+    
+    å‚æ•°:
+        token (str): åŒ»ç”Ÿè®¤è¯ Tokenï¼Œé€šè¿‡æŸ¥è¯¢å‚æ•°ä¼ é€’
+                    æ ¼å¼ï¼šQuery(...) è¡¨ç¤ºå¿…å¡«å‚æ•°
+    
+    è¿”å›:
+        Dict[str, Any]: åŒ…å«ä»¥ä¸‹å­—æ®µçš„å­—å…¸ï¼š
+            - ok (bool): æ“ä½œæ˜¯å¦æˆåŠŸ
+            - patients (List[Dict]): æ‚£è€…åˆ—è¡¨ï¼Œæ¯ä¸ªæ‚£è€…åŒ…å«ï¼š
+                - username (str): æ‚£è€…ç”¨æˆ·å
+                - full_name (str): æ‚£è€…å…¨å
+                - id (int): æ‚£è€…æ•°æ®åº“ ID
+    
+    å¼‚å¸¸:
+        HTTPException(401): å¦‚æœ Token æ— æ•ˆæˆ–ç”¨æˆ·ä¸æ˜¯åŒ»ç”Ÿè§’è‰²
+    
+    ç”¨é€”:
+        - åŒ»ç”Ÿç•Œé¢æ˜¾ç¤ºæ‚£è€…ä¸‹æ‹‰åˆ—è¡¨
+        - åŒ»ç”Ÿé€‰æ‹©è¦ç®¡ç†çš„æ‚£è€…
+        - æ‚£è€…ç®¡ç†åŠŸèƒ½
+    
+    æ³¨æ„:
+        - è¿”å›æ‰€æœ‰æ‚£è€…ï¼Œä¸è¿›è¡Œåˆ†é¡µï¼ˆå¦‚æœæ‚£è€…æ•°é‡å¾ˆå¤§ï¼Œåº”è€ƒè™‘æ·»åŠ åˆ†é¡µï¼‰
+        - ä»…è¿”å›åŸºæœ¬ä¿¡æ¯ï¼Œä¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ï¼‰
+    
+    ç¤ºä¾‹è¯·æ±‚:
+        GET /doctor/patients?token=doc_abc123...
+    
+    ç¤ºä¾‹å“åº”:
+        {
+            "ok": True,
+            "patients": [
+                {
+                    "username": "patient1",
+                    "full_name": "å¼ ä¸‰",
+                    "id": 1
+                },
+                {
+                    "username": "patient2",
+                    "full_name": "æå››",
+                    "id": 2
+                }
+            ]
+        }
+    """
     info = whoami(token)
     if not info or info["role"] != "doctor":
         raise HTTPException(401, "Doctor auth required")
@@ -401,6 +679,68 @@ def list_patients(token: str = Query(...)):
 
 @app.post("/doctor/medications")
 def add_med(payload: MedicationIn, token: str = Query(...), duration_days: int = Query(7)):
+    """
+    æ·»åŠ è¯ç‰©ç«¯ç‚¹ï¼ˆåŒ»ç”Ÿä¸“ç”¨ï¼‰
+    
+    åŒ»ç”Ÿä¸ºæŒ‡å®šæ‚£è€…æ·»åŠ æ–°çš„è¯ç‰©å¤„æ–¹ã€‚ç³»ç»Ÿä¼šï¼š
+    1. éªŒè¯åŒ»ç”Ÿèº«ä»½
+    2. æ£€æŸ¥æ‚£è€…æ˜¯å¦å­˜åœ¨
+    3. æ£€æŸ¥æ˜¯å¦å·²æœ‰åŒåçš„æ¿€æ´»è¯ç‰©ï¼ˆé˜²æ­¢é‡å¤ï¼‰
+    4. åˆ›å»ºè¯ç‰©è®°å½•
+    5. å°†è¯ç‰©ä¿¡æ¯å­˜å‚¨åˆ°è®°å¿†ç³»ç»Ÿï¼ˆæƒ…æ™¯è®°å¿†å’Œæ¡£æ¡ˆè®°å¿†ï¼‰
+    
+    å‚æ•°:
+        payload (MedicationIn): åŒ…å«ä»¥ä¸‹å­—æ®µçš„è¯·æ±‚ä½“ï¼š
+            - patient_username (str): æ‚£è€…ç”¨æˆ·å
+            - name (str): è¯ç‰©åç§°ï¼ˆå¦‚ "é˜¿å¸åŒ¹æ—"ï¼‰
+            - times_per_day (int): æ¯å¤©æœç”¨æ¬¡æ•°ï¼ˆå¦‚ 3 è¡¨ç¤ºæ¯å¤© 3 æ¬¡ï¼‰
+            - specific_times (str): å…·ä½“æœç”¨æ—¶é—´ï¼Œé€—å·åˆ†éš”ï¼ˆå¦‚ "09:00,14:00,20:00"ï¼‰
+            - instructions (str): æœç”¨è¯´æ˜ï¼ˆå¦‚ "é¥­åæœç”¨"ã€"ç”¨æ°´é€æœ"ï¼‰
+            - active (bool): æ˜¯å¦æ¿€æ´»ï¼ˆTrue è¡¨ç¤ºæ­£åœ¨æœç”¨ï¼‰
+        token (str): åŒ»ç”Ÿè®¤è¯ Tokenï¼Œé€šè¿‡æŸ¥è¯¢å‚æ•°ä¼ é€’
+        duration_days (int): è¯ç‰©æŒç»­æ—¶é—´ï¼ˆå¤©æ•°ï¼‰ï¼Œé»˜è®¤ 7 å¤©ï¼Œé€šè¿‡æŸ¥è¯¢å‚æ•°ä¼ é€’
+    
+    è¿”å›:
+        Dict[str, Any]: åŒ…å«ä»¥ä¸‹å­—æ®µçš„å­—å…¸ï¼š
+            - ok (bool): æ“ä½œæ˜¯å¦æˆåŠŸ
+            - message (str): æˆåŠŸæ¶ˆæ¯
+    
+    å¼‚å¸¸:
+        HTTPException(401): å¦‚æœ Token æ— æ•ˆæˆ–ç”¨æˆ·ä¸æ˜¯åŒ»ç”Ÿè§’è‰²
+        HTTPException(404): å¦‚æœæ‚£è€…ä¸å­˜åœ¨
+        HTTPException(400): å¦‚æœå·²å­˜åœ¨åŒåçš„æ¿€æ´»è¯ç‰©
+    
+    å·¥ä½œæµç¨‹:
+        1. éªŒè¯åŒ»ç”Ÿèº«ä»½
+        2. æŸ¥è¯¢æ‚£è€…è®°å½•
+        3. æ£€æŸ¥æ˜¯å¦å·²æœ‰åŒåæ¿€æ´»è¯ç‰©ï¼ˆé˜²æ­¢é‡å¤æ·»åŠ ï¼‰
+        4. åˆ›å»º Medication è®°å½•ï¼ˆè‡ªåŠ¨è®¾ç½® start_date å’Œ created_atï¼‰
+        5. å°†è¯ç‰©ä¿¡æ¯å­˜å‚¨åˆ°è®°å¿†ç³»ç»Ÿï¼š
+           - æƒ…æ™¯è®°å¿†ï¼šè®°å½•åŒ»ç”Ÿæ·»åŠ è¯ç‰©çš„äº‹ä»¶
+           - æ¡£æ¡ˆè®°å¿†ï¼šå­˜å‚¨è¯ç‰©ä¿¡æ¯ä½œä¸ºæ°¸ä¹…æ€§åŒ»ç–—è®°å½•
+    
+    æ³¨æ„:
+        - è¯ç‰©åç§°ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå°å†™å¹¶æ›¿æ¢ç©ºæ ¼ä¸ºä¸‹åˆ’çº¿ä½œä¸ºæ¡£æ¡ˆè®°å¿†çš„é”®å
+        - è¯ç‰©ä¿¡æ¯ä¼šæ°¸ä¹…å­˜å‚¨åˆ°æ‚£è€…çš„æ¡£æ¡ˆè®°å¿†ä¸­ï¼Œä¾› AI åŠ©æ‰‹å‚è€ƒ
+        - å¦‚æœæ‚£è€…å·²æœ‰åŒåæ¿€æ´»è¯ç‰©ï¼Œä¼šæ‹’ç»æ·»åŠ æ–°è®°å½•
+    
+    ç¤ºä¾‹è¯·æ±‚:
+        POST /doctor/medications?token=doc_abc123...&duration_days=30
+        {
+            "patient_username": "patient1",
+            "name": "é˜¿å¸åŒ¹æ—",
+            "times_per_day": 3,
+            "specific_times": "09:00,14:00,20:00",
+            "instructions": "é¥­åæœç”¨ï¼Œç”¨æ°´é€æœ",
+            "active": true
+        }
+    
+    ç¤ºä¾‹å“åº”:
+        {
+            "ok": True,
+            "message": "Medication added"
+        }
+    """
     info = whoami(token)
     if not info or info["role"] != "doctor":
         raise HTTPException(401, "Doctor auth required")
@@ -445,6 +785,69 @@ def add_med(payload: MedicationIn, token: str = Query(...), duration_days: int =
 
 @app.get("/doctor/patient-goals")
 def get_patient_goals(patient_username: str = Query(...), token: str = Query(...)):
+    """
+    è·å–æ‚£è€…ç›®æ ‡åˆ—è¡¨ç«¯ç‚¹ï¼ˆåŒ»ç”Ÿä¸“ç”¨ï¼‰
+    
+    è¿”å›æŒ‡å®šæ‚£è€…çš„æ‰€æœ‰ç›®æ ‡ï¼ˆåŒ…æ‹¬å·²å®Œæˆå’Œæœªå®Œæˆçš„ï¼‰ï¼Œç”¨äºåŒ»ç”ŸæŸ¥çœ‹æ‚£è€…çš„æ²»ç–—è¿›åº¦ã€‚
+    
+    å‚æ•°:
+        patient_username (str): æ‚£è€…ç”¨æˆ·åï¼Œé€šè¿‡æŸ¥è¯¢å‚æ•°ä¼ é€’
+        token (str): åŒ»ç”Ÿè®¤è¯ Tokenï¼Œé€šè¿‡æŸ¥è¯¢å‚æ•°ä¼ é€’
+    
+    è¿”å›:
+        Dict[str, Any]: åŒ…å«ä»¥ä¸‹å­—æ®µçš„å­—å…¸ï¼š
+            - ok (bool): æ“ä½œæ˜¯å¦æˆåŠŸ
+            - goals (List[Dict]): ç›®æ ‡åˆ—è¡¨ï¼Œæ¯ä¸ªç›®æ ‡åŒ…å«ï¼š
+                - id (int): ç›®æ ‡ ID
+                - patient_id (int): æ‚£è€… ID
+                - text (str): ç›®æ ‡æè¿°æ–‡æœ¬
+                - completed (bool): æ˜¯å¦å·²å®Œæˆ
+                - created_at (datetime): åˆ›å»ºæ—¶é—´
+                - completed_at (datetime): å®Œæˆæ—¶é—´ï¼ˆå¦‚æœå·²å®Œæˆï¼‰
+                - completed_at_str (str): å®Œæˆæ—¶é—´çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ˆç”¨äºå‰ç«¯æ˜¾ç¤ºï¼‰
+    
+    å¼‚å¸¸:
+        HTTPException(401): å¦‚æœ Token æ— æ•ˆæˆ–ç”¨æˆ·ä¸æ˜¯åŒ»ç”Ÿè§’è‰²
+        HTTPException(404): å¦‚æœæ‚£è€…ä¸å­˜åœ¨
+    
+    ç”¨é€”:
+        - åŒ»ç”Ÿç•Œé¢æ˜¾ç¤ºæ‚£è€…çš„æ‰€æœ‰ç›®æ ‡
+        - æŸ¥çœ‹ç›®æ ‡å®Œæˆæƒ…å†µ
+        - è¯„ä¼°æ‚£è€…åº·å¤è¿›åº¦
+    
+    æ³¨æ„:
+        - è¿”å›æ‰€æœ‰ç›®æ ‡ï¼ˆåŒ…æ‹¬å·²å®Œæˆå’Œæœªå®Œæˆï¼‰
+        - completed_at_str å­—æ®µæ˜¯ä¸ºäº†æ–¹ä¾¿å‰ç«¯æ˜¾ç¤ºè€Œæ·»åŠ çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²
+        - å¦‚æœç›®æ ‡æœªå®Œæˆï¼Œcompleted_at_str ä¸º None
+    
+    ç¤ºä¾‹è¯·æ±‚:
+        GET /doctor/patient-goals?patient_username=patient1&token=doc_abc123...
+    
+    ç¤ºä¾‹å“åº”:
+        {
+            "ok": True,
+            "goals": [
+                {
+                    "id": 1,
+                    "patient_id": 1,
+                    "text": "æ¯å¤©æ•£æ­¥ 30 åˆ†é’Ÿ",
+                    "completed": false,
+                    "created_at": "2024-01-01T10:00:00",
+                    "completed_at": null,
+                    "completed_at_str": null
+                },
+                {
+                    "id": 2,
+                    "patient_id": 1,
+                    "text": "å®Œæˆè®°å¿†è®­ç»ƒ",
+                    "completed": true,
+                    "created_at": "2024-01-01T10:00:00",
+                    "completed_at": "2024-01-05T15:30:00",
+                    "completed_at_str": "2024-01-05 15:30"
+                }
+            ]
+        }
+    """
     info = whoami(token)
     if not info or info["role"] != "doctor":
         raise HTTPException(401, "Doctor auth required")
@@ -460,6 +863,77 @@ def get_patient_goals(patient_username: str = Query(...), token: str = Query(...
 
 @app.get("/doctor/patient-medications")
 def doctor_view_meds(patient_username: str = Query(...), token: str = Query(...)):
+    """
+    è·å–æ‚£è€…è¯ç‰©åˆ—è¡¨åŠæœç”¨å†å²ç«¯ç‚¹ï¼ˆåŒ»ç”Ÿä¸“ç”¨ï¼‰
+    
+    è¿”å›æŒ‡å®šæ‚£è€…çš„æ‰€æœ‰è¯ç‰©ä¿¡æ¯åŠå…¶æœç”¨å†å²è®°å½•ï¼Œç”¨äºåŒ»ç”Ÿç›‘æ§æ‚£è€…çš„æœè¯ä¾ä»æ€§ã€‚
+    
+    å‚æ•°:
+        patient_username (str): æ‚£è€…ç”¨æˆ·åï¼Œé€šè¿‡æŸ¥è¯¢å‚æ•°ä¼ é€’
+        token (str): åŒ»ç”Ÿè®¤è¯ Tokenï¼Œé€šè¿‡æŸ¥è¯¢å‚æ•°ä¼ é€’
+    
+    è¿”å›:
+        Dict[str, Any]: åŒ…å«ä»¥ä¸‹å­—æ®µçš„å­—å…¸ï¼š
+            - ok (bool): æ“ä½œæ˜¯å¦æˆåŠŸ
+            - medications (List[Dict]): è¯ç‰©åˆ—è¡¨ï¼Œæ¯ä¸ªè¯ç‰©åŒ…å«ï¼š
+                - name (str): è¯ç‰©åç§°
+                - times_per_day (int): æ¯å¤©æœç”¨æ¬¡æ•°
+                - specific_times (str): å…·ä½“æœç”¨æ—¶é—´
+                - instructions (str): æœç”¨è¯´æ˜
+                - logs (List[Dict]): æœç”¨å†å²è®°å½•åˆ—è¡¨ï¼Œæ¯æ¡è®°å½•åŒ…å«ï¼š
+                    - date (str): æ—¥æœŸï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
+                    - time_taken (str): å®é™…æœç”¨æ—¶é—´ï¼ˆæ ¼å¼ï¼šHH:MMï¼‰
+                    - taken (bool): æ˜¯å¦å·²æœç”¨
+    
+    å¼‚å¸¸:
+        HTTPException(401): å¦‚æœ Token æ— æ•ˆæˆ–ç”¨æˆ·ä¸æ˜¯åŒ»ç”Ÿè§’è‰²
+        HTTPException(404): å¦‚æœæ‚£è€…ä¸å­˜åœ¨
+    
+    ç”¨é€”:
+        - åŒ»ç”ŸæŸ¥çœ‹æ‚£è€…çš„æ‰€æœ‰è¯ç‰©ï¼ˆåŒ…æ‹¬å·²åœç”¨çš„ï¼‰
+        - ç›‘æ§æ‚£è€…æœè¯ä¾ä»æ€§
+        - åˆ†ææœè¯å†å²æ•°æ®
+        - è¯„ä¼°æ²»ç–—æ•ˆæœ
+    
+    æ³¨æ„:
+        - è¿”å›æ‰€æœ‰è¯ç‰©ï¼ˆåŒ…æ‹¬æ¿€æ´»å’Œå·²åœç”¨çš„ï¼‰
+        - æ¯æ¡è¯ç‰©éƒ½åŒ…å«å®Œæ•´çš„æœç”¨å†å²è®°å½•
+        - æ—¥æœŸæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²ä»¥ä¾¿å‰ç«¯æ˜¾ç¤º
+        - å¦‚æœè¯ç‰©æ²¡æœ‰æœç”¨è®°å½•ï¼Œlogs ä¸ºç©ºåˆ—è¡¨
+    
+    ç¤ºä¾‹è¯·æ±‚:
+        GET /doctor/patient-medications?patient_username=patient1&token=doc_abc123...
+    
+    ç¤ºä¾‹å“åº”:
+        {
+            "ok": True,
+            "medications": [
+                {
+                    "name": "é˜¿å¸åŒ¹æ—",
+                    "times_per_day": 3,
+                    "specific_times": "09:00,14:00,20:00",
+                    "instructions": "é¥­åæœç”¨",
+                    "logs": [
+                        {
+                            "date": "2024-01-10",
+                            "time_taken": "09:15",
+                            "taken": true
+                        },
+                        {
+                            "date": "2024-01-10",
+                            "time_taken": "14:30",
+                            "taken": true
+                        },
+                        {
+                            "date": "2024-01-10",
+                            "time_taken": null,
+                            "taken": false
+                        }
+                    ]
+                }
+            ]
+        }
+    """
     info = whoami(token)
     if not info or info["role"] != "doctor":
         raise HTTPException(401, "Doctor auth required")
@@ -482,6 +956,56 @@ def doctor_view_meds(patient_username: str = Query(...), token: str = Query(...)
     
 @app.post("/doctor/goals")
 def add_goal(payload: GoalIn, patient_username: str = Query(...), token: str = Query(...)):
+    """
+    æ·»åŠ ç›®æ ‡ç«¯ç‚¹ï¼ˆåŒ»ç”Ÿä¸“ç”¨ï¼‰
+    
+    åŒ»ç”Ÿä¸ºæŒ‡å®šæ‚£è€…åˆ†é…æ–°çš„æ²»ç–—ç›®æ ‡æˆ–åº·å¤ç›®æ ‡ã€‚ç³»ç»Ÿä¼šï¼š
+    1. éªŒè¯åŒ»ç”Ÿèº«ä»½
+    2. æ£€æŸ¥æ‚£è€…æ˜¯å¦å­˜åœ¨
+    3. åˆ›å»ºç›®æ ‡è®°å½•
+    4. å°†ç›®æ ‡ä¿¡æ¯å­˜å‚¨åˆ°è®°å¿†ç³»ç»Ÿï¼ˆæƒ…æ™¯è®°å¿†å’Œæ¡£æ¡ˆè®°å¿†ï¼‰
+    
+    å‚æ•°:
+        payload (GoalIn): åŒ…å«ä»¥ä¸‹å­—æ®µçš„è¯·æ±‚ä½“ï¼š
+            - text (str): ç›®æ ‡æè¿°æ–‡æœ¬ï¼ˆå¦‚ "æ¯å¤©æ•£æ­¥ 30 åˆ†é’Ÿ"ã€"å®Œæˆè®°å¿†è®­ç»ƒ"ï¼‰
+        patient_username (str): æ‚£è€…ç”¨æˆ·åï¼Œé€šè¿‡æŸ¥è¯¢å‚æ•°ä¼ é€’
+        token (str): åŒ»ç”Ÿè®¤è¯ Tokenï¼Œé€šè¿‡æŸ¥è¯¢å‚æ•°ä¼ é€’
+    
+    è¿”å›:
+        Dict[str, Any]: åŒ…å«ä»¥ä¸‹å­—æ®µçš„å­—å…¸ï¼š
+            - ok (bool): æ“ä½œæ˜¯å¦æˆåŠŸ
+            - message (str): æˆåŠŸæ¶ˆæ¯
+    
+    å¼‚å¸¸:
+        HTTPException(401): å¦‚æœ Token æ— æ•ˆæˆ–ç”¨æˆ·ä¸æ˜¯åŒ»ç”Ÿè§’è‰²
+        HTTPException(404): å¦‚æœæ‚£è€…ä¸å­˜åœ¨
+    
+    å·¥ä½œæµç¨‹:
+        1. éªŒè¯åŒ»ç”Ÿèº«ä»½
+        2. æŸ¥è¯¢æ‚£è€…è®°å½•
+        3. åˆ›å»º Goal è®°å½•ï¼ˆè‡ªåŠ¨è®¾ç½® created_atï¼Œcompleted é»˜è®¤ä¸º Falseï¼‰
+        4. å°†ç›®æ ‡ä¿¡æ¯å­˜å‚¨åˆ°è®°å¿†ç³»ç»Ÿï¼š
+           - æƒ…æ™¯è®°å¿†ï¼šè®°å½•åŒ»ç”Ÿåˆ†é…ç›®æ ‡çš„äº‹ä»¶
+           - æ¡£æ¡ˆè®°å¿†ï¼šå­˜å‚¨ç›®æ ‡ä½œä¸ºæ´»è·ƒç›®æ ‡ï¼ˆä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºé”®åçš„ä¸€éƒ¨åˆ†ï¼‰
+    
+    æ³¨æ„:
+        - æ–°åˆ›å»ºçš„ç›®æ ‡é»˜è®¤ä¸ºæœªå®ŒæˆçŠ¶æ€ï¼ˆcompleted=Falseï¼‰
+        - ç›®æ ‡ä¼šæ°¸ä¹…å­˜å‚¨åˆ°æ‚£è€…çš„æ¡£æ¡ˆè®°å¿†ä¸­
+        - æ¡£æ¡ˆè®°å¿†çš„é”®ååŒ…å«æ—¶é—´æˆ³ï¼Œç¡®ä¿æ¯ä¸ªç›®æ ‡éƒ½æœ‰å”¯ä¸€æ ‡è¯†
+        - AI åŠ©æ‰‹å¯ä»¥æ ¹æ®è¿™äº›ç›®æ ‡æä¾›ä¸ªæ€§åŒ–çš„æé†’å’Œé¼“åŠ±
+    
+    ç¤ºä¾‹è¯·æ±‚:
+        POST /doctor/goals?patient_username=patient1&token=doc_abc123...
+        {
+            "text": "æ¯å¤©æ™šé¥­åæ•£æ­¥ 10 åˆ†é’Ÿ"
+        }
+    
+    ç¤ºä¾‹å“åº”:
+        {
+            "ok": True,
+            "message": "Goal assigned"
+        }
+    """
     info = whoami(token)
     if not info or info["role"] != "doctor":
         raise HTTPException(401, "Doctor auth required")
@@ -516,6 +1040,64 @@ def add_goal(payload: GoalIn, patient_username: str = Query(...), token: str = Q
 # -------------------- PATIENT ROUTES --------------------
 @app.get("/patient/goals")
 def list_goals(token: str = Query(...)):
+    """
+    è·å–æ‚£è€…ç›®æ ‡åˆ—è¡¨ç«¯ç‚¹ï¼ˆæ‚£è€…ä¸“ç”¨ï¼‰
+    
+    è¿”å›å½“å‰ç™»å½•æ‚£è€…çš„æ‰€æœ‰æœªå®Œæˆç›®æ ‡ï¼Œç”¨äºæ‚£è€…ç•Œé¢æ˜¾ç¤ºã€‚
+    
+    å‚æ•°:
+        token (str): æ‚£è€…è®¤è¯ Tokenï¼Œé€šè¿‡æŸ¥è¯¢å‚æ•°ä¼ é€’
+    
+    è¿”å›:
+        Dict[str, Any]: åŒ…å«ä»¥ä¸‹å­—æ®µçš„å­—å…¸ï¼š
+            - ok (bool): æ“ä½œæ˜¯å¦æˆåŠŸ
+            - goals (List[Dict]): æœªå®Œæˆç›®æ ‡åˆ—è¡¨ï¼Œæ¯ä¸ªç›®æ ‡åŒ…å«ï¼š
+                - id (int): ç›®æ ‡ ID
+                - patient_id (int): æ‚£è€… ID
+                - text (str): ç›®æ ‡æè¿°æ–‡æœ¬
+                - completed (bool): æ˜¯å¦å·²å®Œæˆï¼ˆå›ºå®šä¸º Falseï¼Œå› ä¸ºåªè¿”å›æœªå®Œæˆçš„ï¼‰
+                - created_at (datetime): åˆ›å»ºæ—¶é—´
+                - completed_at (datetime): å®Œæˆæ—¶é—´ï¼ˆå›ºå®šä¸º Noneï¼‰
+    
+    å¼‚å¸¸:
+        HTTPException(401): å¦‚æœ Token æ— æ•ˆæˆ–ç”¨æˆ·ä¸æ˜¯æ‚£è€…è§’è‰²
+    
+    ç”¨é€”:
+        - æ‚£è€…ç•Œé¢æ˜¾ç¤ºå½“å‰æ´»è·ƒçš„ç›®æ ‡
+        - æ‚£è€…æŸ¥çœ‹éœ€è¦å®Œæˆçš„ä»»åŠ¡
+        - æ¿€åŠ±æ‚£è€…å®Œæˆç›®æ ‡
+    
+    æ³¨æ„:
+        - åªè¿”å›æœªå®Œæˆçš„ç›®æ ‡ï¼ˆcompleted=Falseï¼‰
+        - å·²å®Œæˆçš„ç›®æ ‡ä¸ä¼šæ˜¾ç¤ºç»™æ‚£è€…
+        - ä½¿ç”¨ model_dump() å°† SQLModel å¯¹è±¡è½¬æ¢ä¸ºå­—å…¸
+    
+    ç¤ºä¾‹è¯·æ±‚:
+        GET /patient/goals?token=pat_xyz789...
+    
+    ç¤ºä¾‹å“åº”:
+        {
+            "ok": True,
+            "goals": [
+                {
+                    "id": 1,
+                    "patient_id": 1,
+                    "text": "æ¯å¤©æ•£æ­¥ 30 åˆ†é’Ÿ",
+                    "completed": false,
+                    "created_at": "2024-01-01T10:00:00",
+                    "completed_at": null
+                },
+                {
+                    "id": 3,
+                    "patient_id": 1,
+                    "text": "å®Œæˆè®°å¿†è®­ç»ƒ",
+                    "completed": false,
+                    "created_at": "2024-01-05T10:00:00",
+                    "completed_at": null
+                }
+            ]
+        }
+    """
     me = whoami(token)
     if not me or me["role"] != "patient":
         raise HTTPException(401, "Patient auth required")
@@ -526,6 +1108,78 @@ def list_goals(token: str = Query(...)):
 
 @app.get("/patient/medications")
 def list_medications(token: str = Query(...)):
+    """
+    è·å–æ‚£è€…è¯ç‰©åˆ—è¡¨ç«¯ç‚¹ï¼ˆæ‚£è€…ä¸“ç”¨ï¼‰
+    
+    è¿”å›å½“å‰ç™»å½•æ‚£è€…çš„æ‰€æœ‰æ¿€æ´»è¯ç‰©åŠå…¶æœç”¨å†å²è®°å½•ã€‚
+    åœ¨è¿”å›å‰ä¼šè‡ªåŠ¨æ£€æŸ¥å¹¶é‡ç½®è¿‡æœŸçš„è¯ç‰©çŠ¶æ€ã€‚
+    
+    å‚æ•°:
+        token (str): æ‚£è€…è®¤è¯ Tokenï¼Œé€šè¿‡æŸ¥è¯¢å‚æ•°ä¼ é€’
+    
+    è¿”å›:
+        Dict[str, Any]: åŒ…å«ä»¥ä¸‹å­—æ®µçš„å­—å…¸ï¼š
+            - ok (bool): æ“ä½œæ˜¯å¦æˆåŠŸ
+            - medications (List[Dict]): æ¿€æ´»è¯ç‰©åˆ—è¡¨ï¼Œæ¯ä¸ªè¯ç‰©åŒ…å«ï¼š
+                - name (str): è¯ç‰©åç§°
+                - times_per_day (int): æ¯å¤©æœç”¨æ¬¡æ•°
+                - specific_times (str): å…·ä½“æœç”¨æ—¶é—´
+                - instructions (str): æœç”¨è¯´æ˜
+                - logs (List[Dict]): æœç”¨å†å²è®°å½•åˆ—è¡¨ï¼Œæ¯æ¡è®°å½•åŒ…å«ï¼š
+                    - date (str): æ—¥æœŸï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
+                    - time_taken (str): å®é™…æœç”¨æ—¶é—´ï¼ˆæ ¼å¼ï¼šHH:MMï¼‰
+                    - taken (bool): æ˜¯å¦å·²æœç”¨
+    
+    å¼‚å¸¸:
+        HTTPException(401): å¦‚æœ Token æ— æ•ˆæˆ–ç”¨æˆ·ä¸æ˜¯æ‚£è€…è§’è‰²
+    
+    å·¥ä½œæµç¨‹:
+        1. éªŒè¯æ‚£è€…èº«ä»½
+        2. æŸ¥è¯¢æ‚£è€…è®°å½•
+        3. æ£€æŸ¥å¹¶é‡ç½®è¿‡æœŸçš„è¯ç‰©çŠ¶æ€ï¼ˆè°ƒç”¨ check_and_reset_medicationsï¼‰
+        4. æŸ¥è¯¢æ‰€æœ‰æ¿€æ´»çš„è¯ç‰©
+        5. ä¸ºæ¯ä¸ªè¯ç‰©æŸ¥è¯¢æœç”¨å†å²è®°å½•
+        6. è¿”å›æ ¼å¼åŒ–åçš„è¯ç‰©åˆ—è¡¨
+    
+    ç”¨é€”:
+        - æ‚£è€…ç•Œé¢æ˜¾ç¤ºå½“å‰éœ€è¦æœç”¨çš„è¯ç‰©
+        - æ˜¾ç¤ºè¯ç‰©æœç”¨è¿›åº¦
+        - æ‚£è€…æŸ¥çœ‹æœè¯å†å²
+    
+    æ³¨æ„:
+        - åªè¿”å›æ¿€æ´»çš„è¯ç‰©ï¼ˆactive=Trueï¼‰
+        - å·²åœç”¨çš„è¯ç‰©ä¸ä¼šæ˜¾ç¤º
+        - ä¼šè‡ªåŠ¨æ£€æŸ¥å¹¶é‡ç½®è¿‡æœŸçš„è¯ç‰©ï¼ˆå¦‚æœ end_date å·²è¿‡ï¼Œä¼šè®¾ç½®ä¸º inactiveï¼‰
+        - æ—¥æœŸæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²ä»¥ä¾¿å‰ç«¯æ˜¾ç¤º
+    
+    ç¤ºä¾‹è¯·æ±‚:
+        GET /patient/medications?token=pat_xyz789...
+    
+    ç¤ºä¾‹å“åº”:
+        {
+            "ok": True,
+            "medications": [
+                {
+                    "name": "é˜¿å¸åŒ¹æ—",
+                    "times_per_day": 3,
+                    "specific_times": "09:00,14:00,20:00",
+                    "instructions": "é¥­åæœç”¨",
+                    "logs": [
+                        {
+                            "date": "2024-01-10",
+                            "time_taken": "09:15",
+                            "taken": true
+                        },
+                        {
+                            "date": "2024-01-10",
+                            "time_taken": "14:30",
+                            "taken": true
+                        }
+                    ]
+                }
+            ]
+        }
+    """
     me = whoami(token)
     if not me or me["role"] != "patient":
         raise HTTPException(401, "Patient auth required")
@@ -547,50 +1201,122 @@ def list_medications(token: str = Query(...)):
 
 @app.post("/patient/medications/log")
 def log_medication(med_name: str = Query(...), token: str = Query(...)):
+    """
+    è®°å½•è¯ç‰©æœç”¨ç«¯ç‚¹
+    
+    æ‚£è€…æ ‡è®°æŸä¸ªè¯ç‰©å·²æœç”¨ï¼Œç³»ç»Ÿä¼šï¼š
+    1. éªŒè¯æ‚£è€…èº«ä»½
+    2. æ£€æŸ¥è¯ç‰©æ˜¯å¦å­˜åœ¨ä¸”æ¿€æ´»
+    3. æ£€æŸ¥ä»Šæ—¥æ˜¯å¦å·²è®°å½•è¶³å¤Ÿæ¬¡æ•°ï¼ˆé˜²æ­¢é‡å¤è®°å½•ï¼‰
+    4. åˆ›å»ºæœç”¨æ—¥å¿—
+    5. å°†äº‹ä»¶å­˜å‚¨åˆ°è®°å¿†ç³»ç»Ÿ
+    """
+    # æ­¥éª¤ 1: éªŒè¯æ‚£è€…èº«ä»½
+    # whoami() å‡½æ•°æ ¹æ® Token è¿”å›ç”¨æˆ·ä¿¡æ¯
     me = whoami(token)
+    # å¦‚æœ Token æ— æ•ˆæˆ–ç”¨æˆ·ä¸æ˜¯æ‚£è€…è§’è‰²ï¼Œè¿”å› 401 æœªæˆæƒé”™è¯¯
     if not me or me["role"] != "patient":
         raise HTTPException(401, "Patient auth required")
     
+    # æ­¥éª¤ 2: æŸ¥è¯¢æ‚£è€…å’Œè¯ç‰©ä¿¡æ¯
     with get_session() as s:
+        # æ ¹æ® Token ä¸­çš„ç”¨æˆ·åæŸ¥è¯¢æ‚£è€…è®°å½•t2
         patient = s.exec(select(Patient).where(Patient.username == me["username"])).first()
+        # æŸ¥è¯¢æ‚£è€…æŒ‡å®šçš„æ¿€æ´»è¯ç‰©
+        # æ¡ä»¶ï¼šæ‚£è€… ID åŒ¹é…ã€è¯ç‰©åç§°åŒ¹é…ã€è¯ç‰©å¤„äºæ¿€æ´»çŠ¶æ€
         med = s.exec(select(Medication).where(
-            Medication.patient_id == patient.id, 
-            Medication.name == med_name,
-            Medication.active == True
+            Medication.patient_id == patient.id,  # åŒ¹é…æ‚£è€… ID
+            Medication.name == med_name,  # åŒ¹é…è¯ç‰©åç§°
+            Medication.active == True  # åªæŸ¥è¯¢æ¿€æ´»çš„è¯ç‰©
         )).first()
         
+        # å¦‚æœè¯ç‰©ä¸å­˜åœ¨ï¼Œè¿”å› 404 é”™è¯¯
         if not med:
             raise HTTPException(404, "Medication not found")
         
-        # Check today's logs
+        # æ­¥éª¤ 3: æ£€æŸ¥ä»Šå¤©çš„æœç”¨è®°å½•
+        # è·å–ä»Šå¤©çš„æ—¥æœŸï¼ˆä¸åŒ…å«æ—¶é—´ï¼‰
         today = datetime.now().date()
+        # æŸ¥è¯¢ä»Šå¤©è¯¥è¯ç‰©çš„æ‰€æœ‰æ—¥å¿—
+        # datetime.combine() åˆ›å»ºä»Šå¤© 00:00:00 çš„æ—¶é—´ç‚¹ï¼Œç”¨äºæŸ¥è¯¢ä»Šå¤©çš„æ‰€æœ‰è®°å½•
         today_logs = s.exec(select(MedicationLog).where(
-            MedicationLog.medication_id == med.id,
-            MedicationLog.date >= datetime.combine(today, datetime.min.time())
+            MedicationLog.medication_id == med.id,  # åŒ¹é…è¯ç‰© ID
+            MedicationLog.date >= datetime.combine(today, datetime.min.time())  # æ—¥æœŸ >= ä»Šå¤© 00:00:00
         )).all()
         
-        # Prevent over-logging
+        # æ­¥éª¤ 4: é˜²æ­¢é‡å¤è®°å½•ï¼ˆé˜²æ­¢è¶…è¿‡æ¯æ—¥æœç”¨æ¬¡æ•°ï¼‰
+        # å¦‚æœä»Šå¤©çš„æ—¥å¿—æ•°é‡å·²ç»è¾¾åˆ°æˆ–è¶…è¿‡æ¯æ—¥æœç”¨æ¬¡æ•°ï¼Œæ‹’ç»è®°å½•
         if len(today_logs) >= med.times_per_day:
             raise HTTPException(400, f"Already logged {med.times_per_day} doses today")
         
+        # æ­¥éª¤ 5: åˆ›å»ºæ–°çš„æœç”¨æ—¥å¿—è®°å½•
         log_entry = MedicationLog(
-            medication_id=med.id, 
-            taken=True, 
-            time_taken=datetime.now().strftime("%H:%M")
+            medication_id=med.id,  # å…³è”çš„è¯ç‰© ID
+            taken=True,  # æ ‡è®°ä¸ºå·²æœç”¨
+            time_taken=datetime.now().strftime("%H:%M")  # è®°å½•æœç”¨æ—¶é—´ï¼ˆæ ¼å¼ï¼šHH:MMï¼‰
         )
+        # å°†æ—¥å¿—æ·»åŠ åˆ°æ•°æ®åº“ä¼šè¯
         s.add(log_entry)
+        # æäº¤äº‹åŠ¡ï¼Œå°†æ—¥å¿—å†™å…¥æ•°æ®åº“
         s.commit()
     
+    # æ­¥éª¤ 6: å°†è¯ç‰©æœç”¨äº‹ä»¶å­˜å‚¨åˆ°è®°å¿†ç³»ç»Ÿ
+    # è¿™æ · AI å¯ä»¥åœ¨å¯¹è¯ä¸­æåŠæ‚£è€…çš„æœè¯æƒ…å†µ
     mm.remember(
-        user_id=me["username"],
-        text=f"Took {med_name} at {datetime.now().strftime('%H:%M')} on {datetime.now().strftime('%Y-%m-%d')}",
-        tags=["medication_log"]
+        user_id=me["username"],  # ç”¨æˆ· ID
+        text=f"Took {med_name} at {datetime.now().strftime('%H:%M')} on {datetime.now().strftime('%Y-%m-%d')}",  # è®°å¿†æ–‡æœ¬
+        tags=["medication_log"]  # æ ‡ç­¾ï¼Œç”¨äºè®°å¿†åˆ†ç±»
     )
+    
+    # æ­¥éª¤ 7: è¿”å›æˆåŠŸå“åº”
     return {"ok": True, "message": f"Logged {med_name} as taken."}
 
 # -------------------- MEMORY & CHAT --------------------
 @app.post("/remember")
 def remember(req: RememberRequest) -> Dict[str, Any]:
+    """
+    æ‰‹åŠ¨è®°å¿†å­˜å‚¨ç«¯ç‚¹
+    
+    å…è®¸æ‰‹åŠ¨å°†æ–‡æœ¬ä¿¡æ¯å­˜å‚¨åˆ° MemMachine æƒ…æ™¯è®°å¿†ä¸­ã€‚
+    é€šå¸¸ç”¨äºå­˜å‚¨é‡è¦äº‹ä»¶ã€å¯¹è¯æ‘˜è¦æˆ–å…¶ä»–éœ€è¦è®°ä½çš„ä¿¡æ¯ã€‚
+    
+    å‚æ•°:
+        req (RememberRequest): åŒ…å«ä»¥ä¸‹å­—æ®µçš„è¯·æ±‚ä½“ï¼š
+            - user_id (str): ç”¨æˆ· IDï¼ˆæ‚£è€…ç”¨æˆ·åï¼‰
+            - text (str): è¦å­˜å‚¨çš„è®°å¿†æ–‡æœ¬å†…å®¹
+    
+    è¿”å›:
+        Dict[str, Any]: åŒ…å«ä»¥ä¸‹å­—æ®µçš„å­—å…¸ï¼š
+            - ok (bool): æ“ä½œæ˜¯å¦æˆåŠŸ
+            - saved (bool): è®°å¿†æ˜¯å¦æˆåŠŸä¿å­˜
+    
+    å¼‚å¸¸:
+        HTTPException(500): å¦‚æœ MemMachine æœåŠ¡ä¸å¯ç”¨æˆ–å‘ç”Ÿå…¶ä»–é”™è¯¯
+    
+    ç”¨é€”:
+        - æ‰‹åŠ¨è®°å½•é‡è¦äº‹ä»¶
+        - å­˜å‚¨å¯¹è¯æ‘˜è¦
+        - è¡¥å……è®°å¿†ä¿¡æ¯
+        - è°ƒè¯•å’Œæµ‹è¯•è®°å¿†ç³»ç»Ÿ
+    
+    æ³¨æ„:
+        - å­˜å‚¨çš„æ˜¯æƒ…æ™¯è®°å¿†ï¼ˆepisodic memoryï¼‰ï¼Œç”¨äºè®°å½•äº‹ä»¶å’Œå¯¹è¯
+        - è®°å¿†ä¼šæ°¸ä¹…å­˜å‚¨ï¼Œä¾›åç»­å¯¹è¯æ£€ç´¢ä½¿ç”¨
+        - å»ºè®®åœ¨å­˜å‚¨å‰å¯¹æ–‡æœ¬è¿›è¡Œæ¸…ç†å’Œæ ¼å¼åŒ–
+    
+    ç¤ºä¾‹è¯·æ±‚:
+        POST /remember
+        {
+            "user_id": "patient1",
+            "text": "æ‚£è€…ä»Šå¤©å®Œæˆäº†è®°å¿†è®­ç»ƒæ¸¸æˆï¼Œè¡¨ç°å¾ˆå¥½"
+        }
+    
+    ç¤ºä¾‹å“åº”:
+        {
+            "ok": True,
+            "saved": true
+        }
+    """
     try:
         saved = mm.remember(user_id=req.user_id, text=req.text)
         return {"ok": True, "saved": saved}
@@ -604,119 +1330,196 @@ def remember(req: RememberRequest) -> Dict[str, Any]:
 # -------------------- chat with persistent memory --------------------
 @app.post("/chat")
 def chat_with_memory(req: ChatRequest):
+    """
+    å¸¦æŒä¹…åŒ–è®°å¿†çš„èŠå¤©ç«¯ç‚¹ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
+    
+    è¿™æ˜¯åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæä¾›åŸºäº MemMachine æŒä¹…åŒ–è®°å¿†çš„æ™ºèƒ½å¯¹è¯ã€‚
+    å®Œæ•´å·¥ä½œæµç¨‹ï¼š
+    1. æ£€ç´¢ç”¨æˆ·çš„å†å²è®°å¿†ï¼ˆæƒ…æ™¯è®°å¿†å’Œæ¡£æ¡ˆè®°å¿†ï¼‰
+    2. è·å–æ‚£è€…ä¿¡æ¯ï¼ˆè¯ç‰©ã€ç›®æ ‡ç­‰ï¼‰
+    3. æ„å»ºä¸ªæ€§åŒ–æç¤ºè¯
+    4. è°ƒç”¨ OpenAI ç”Ÿæˆ AI å›å¤
+    5. è‡ªåŠ¨æå–å’Œå­˜å‚¨æ–°çš„äº‹å®ä¿¡æ¯
+    6. æ£€æµ‹ç›®æ ‡å®Œæˆæƒ…å†µ
+    7. æå–æ¡£æ¡ˆä¿¡æ¯
+    8. è®°å½•æƒ…æ„Ÿæ£€æŸ¥
+    """
+    # ä»è¯·æ±‚ä¸­æå–ç”¨æˆ· IDï¼ˆç”¨æˆ·åï¼‰
     user_id = req.user_id
     
-    # Check if this is system-initiated conversation
+    # æ£€æŸ¥æ˜¯å¦æ˜¯ç³»ç»Ÿå‘èµ·çš„å¯¹è¯ï¼ˆé¦–æ¬¡é—®å€™ï¼‰
+    # "__SYSTEM_START__" æ˜¯ç‰¹æ®Šæ¶ˆæ¯ï¼Œç”¨äºè§¦å‘åˆå§‹é—®å€™
     is_system_start = req.message == "__SYSTEM_START__"
     
-    # Get message count and medication tracking from request
+    # ä»è¯·æ±‚ä¸­è·å–æ¶ˆæ¯è®¡æ•°ï¼ˆç”¨äºè¿½è¸ªå¯¹è¯è¿›åº¦ï¼Œæœªæ¥åŠŸèƒ½æ‰©å±•ï¼‰
     message_count = req.dict().get("message_count", 0)
+    # ä»è¯·æ±‚ä¸­è·å–è¯ç‰©æœç”¨è¿½è¸ªä¿¡æ¯ï¼ˆç”¨äºæœªæ¥åŠŸèƒ½æ‰©å±•ï¼‰
     medication_taken = req.dict().get("medication_taken", {})
 
-    # Retrieve EPISODIC memories
+    # æ­¥éª¤ 1: æ£€ç´¢æƒ…æ™¯è®°å¿†ï¼ˆä¸´æ—¶æ€§çš„äº‹ä»¶å’Œå¯¹è¯è®°å½•ï¼‰
+    # å¦‚æœä¸æ˜¯ç³»ç»Ÿå¯åŠ¨ï¼Œä½¿ç”¨ç”¨æˆ·æ¶ˆæ¯ä½œä¸ºæŸ¥è¯¢å…³é”®è¯è¿›è¡Œè¯­ä¹‰æœç´¢
+    # å¦‚æœæ˜¯ç³»ç»Ÿå¯åŠ¨ï¼Œæ£€ç´¢æ‰€æœ‰è®°å¿†
+    # top_k=12 è¡¨ç¤ºæœ€å¤šè¿”å› 12 æ¡æœ€ç›¸å…³çš„è®°å¿†
     episodic_memories = mm.retrieve(user_id=user_id, query=req.message if not is_system_start else "all memories", top_k=12)
+
+    # å¦‚æœç¬¬ä¸€æ¬¡æ£€ç´¢æ²¡æœ‰ç»“æœï¼Œä½¿ç”¨é€šç”¨æŸ¥è¯¢å†æ¬¡å°è¯•ï¼Œå¹¶å¢åŠ è¿”å›æ•°é‡
     if not episodic_memories:
         episodic_memories = mm.retrieve(user_id=user_id, query="all memories", top_k=20)
     
-    # Retrieve PROFILE memories
+    # æ­¥éª¤ 2: æ£€ç´¢æ¡£æ¡ˆè®°å¿†ï¼ˆæ°¸ä¹…æ€§çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚åå¥½ã€å®¶åº­æˆå‘˜ç­‰ï¼‰
     profile_memories = mm.retrieve_profile(user_id=user_id)
-    
-    print(f"[DEBUG] Episodic memories count: {len(episodic_memories)}")
-    print(f"[DEBUG] Profile memories count: {len(profile_memories)}")
 
+    # è°ƒè¯•è¾“å‡ºï¼šæ‰“å°æ£€ç´¢åˆ°çš„è®°å¿†æ•°é‡ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜
+    print(f"[DEBUG] Episodic memories for user_id: {user_id}, message: {req.message}, is_system_start: {is_system_start}, count: {len(episodic_memories)}")
+    print(f"[DEBUG] Profile memories for user_id: {user_id}, count: {len(profile_memories)}")
+
+    # æ­¥éª¤ 3: ä»æ•°æ®åº“è·å–æ‚£è€…ä¿¡æ¯å’Œç›¸å…³æ•°æ®
+    print(f"[DEBUG] Getting patient information and related data for user_id: {user_id}")
     with get_session() as s:
+        # æŸ¥è¯¢æ‚£è€…è®°å½•ï¼šæ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾æ‚£è€…
         patient = s.exec(select(Patient).where(Patient.username == user_id)).first()
+        # å¦‚æœæ‚£è€…å­˜åœ¨ï¼Œæ£€æŸ¥å¹¶é‡ç½®è¿‡æœŸçš„è¯ç‰©çŠ¶æ€
         if patient:
             check_and_reset_medications(patient.id)
 
+        # æŸ¥è¯¢æ‚£è€…çš„æ‰€æœ‰æ¿€æ´»è¯ç‰©ï¼šåªè·å– active=True çš„è¯ç‰©
+        # å¦‚æœæ‚£è€…ä¸å­˜åœ¨ï¼Œè¿”å›ç©ºåˆ—è¡¨
         meds = s.exec(select(Medication).where(Medication.patient_id == patient.id, Medication.active == True)).all() if patient else []
+        # æŸ¥è¯¢æ‚£è€…çš„æ‰€æœ‰æœªå®Œæˆç›®æ ‡ï¼šåªè·å– completed=False çš„ç›®æ ‡
+        # å¦‚æœæ‚£è€…ä¸å­˜åœ¨ï¼Œè¿”å›ç©ºåˆ—è¡¨
         goals = s.exec(select(Goal).where(Goal.patient_id == patient.id, Goal.completed == False)).all() if patient else []
 
-    med_status_lines = []
-    for m in meds:
+    # æ­¥éª¤ 4: è®¡ç®—æ¯ä¸ªè¯ç‰©çš„ä»Šæ—¥æœç”¨çŠ¶æ€
+    print(f"[DEBUG] Calculating medication status for user_id: {user_id}")
+    med_status_lines = []  # å­˜å‚¨æ¯ä¸ªè¯ç‰©çš„çŠ¶æ€æ–‡æœ¬
+    for m in meds:  # éå†æ¯ä¸ªæ¿€æ´»çš„è¯ç‰©
+        # è·å–ä»Šå¤©çš„æ—¥æœŸå­—ç¬¦ä¸²ï¼Œæ ¼å¼ä¸º YYYY-MM-DD
         today_str = datetime.now().strftime("%Y-%m-%d")
+        # æŸ¥è¯¢ä»Šå¤©è¯¥è¯ç‰©çš„æ‰€æœ‰æœç”¨æ—¥å¿—
+        # datetime.combine() ç”¨äºåˆ›å»ºä»Šå¤© 00:00:00 çš„æ—¶é—´ç‚¹ï¼Œç”¨äºæŸ¥è¯¢ä»Šå¤©çš„æ‰€æœ‰è®°å½•
         logs = s.exec(select(MedicationLog).where(
-            MedicationLog.medication_id == m.id,
-            MedicationLog.date >= datetime.combine(datetime.now().date(), datetime.min.time())
+            MedicationLog.medication_id == m.id,  # åŒ¹é…è¯ç‰© ID
+            MedicationLog.date >= datetime.combine(datetime.now().date(), datetime.min.time())  # æ—¥æœŸ >= ä»Šå¤© 00:00:00
         )).all()
         
+        # ç»Ÿè®¡ä»Šå¤©å·²æœç”¨çš„æ¬¡æ•°ï¼ˆæ—¥å¿—æ•°é‡ï¼‰
         taken_count = len(logs)
+        # è®¡ç®—ä»Šå¤©è¿˜éœ€è¦æœç”¨çš„æ¬¡æ•°
         remaining = m.times_per_day - taken_count
         
+        # æ ¹æ®å‰©ä½™æ¬¡æ•°ç”ŸæˆçŠ¶æ€æ–‡æœ¬
         if remaining > 0:
+            # è¿˜æœ‰æœªæœç”¨çš„å‰‚é‡ï¼Œæ˜¾ç¤ºè­¦å‘Šå›¾æ ‡å’Œå‰©ä½™æ¬¡æ•°
             med_status_lines.append(f"âš ï¸ {m.name}: {taken_count}/{m.times_per_day} taken, {remaining} remaining today")
         else:
+            # æ‰€æœ‰å‰‚é‡éƒ½å·²å®Œæˆï¼Œæ˜¾ç¤ºå®Œæˆå›¾æ ‡
             med_status_lines.append(f"âœ… {m.name}: All doses complete ({m.times_per_day}/{m.times_per_day})")
 
+    # å°†æ‰€æœ‰è¯ç‰©çš„çŠ¶æ€æ–‡æœ¬åˆå¹¶æˆä¸€è¡Œï¼Œç”¨æ¢è¡Œç¬¦åˆ†éš”
+    # å¦‚æœæ²¡æœ‰è¯ç‰©ï¼Œæ˜¾ç¤º "No active medications"
     medication_status = "\n".join(med_status_lines) if med_status_lines else "No active medications"
 
 
-    # Process EPISODIC memories
-    episodic_lines = []
-    for r in episodic_memories:
+    # æ­¥éª¤ 5: å¤„ç†æƒ…æ™¯è®°å¿†ï¼Œæå–æ–‡æœ¬å†…å®¹
+    episodic_lines = []  # å­˜å‚¨æå–å‡ºçš„è®°å¿†æ–‡æœ¬
+    for r in episodic_memories:  # éå†æ¯æ¡æ£€ç´¢åˆ°çš„è®°å¿†
+        # è®°å¿†å¯èƒ½æ˜¯å­—å…¸æ ¼å¼ï¼ˆåŒ…å«å¤šä¸ªå­—æ®µï¼‰æˆ–å­—ç¬¦ä¸²æ ¼å¼
         if isinstance(r, dict):
+            # ä»å­—å…¸ä¸­æå–å†…å®¹ï¼Œå°è¯•å¤šä¸ªå¯èƒ½çš„é”®åï¼ˆå…¼å®¹ä¸åŒçš„å“åº”æ ¼å¼ï¼‰
+            # æŒ‰ä¼˜å…ˆçº§å°è¯•ï¼šcontent -> episode_content -> text
             content = r.get("content") or r.get("episode_content") or r.get("text", "")
+            # å¦‚æœæå–åˆ°å†…å®¹ï¼Œæ·»åŠ åˆ°åˆ—è¡¨
             if content:
                 episodic_lines.append(content)
         elif isinstance(r, str):
+            # å¦‚æœè®°å¿†æœ¬èº«å°±æ˜¯å­—ç¬¦ä¸²ï¼Œç›´æ¥æ·»åŠ 
             episodic_lines.append(r)
-    episodic_snippets = "\n".join(f"- {m}" for m in episodic_lines if m).strip() or "No recent memories."
+    # å°†æ‰€æœ‰è®°å¿†æ–‡æœ¬æ ¼å¼åŒ–ï¼šæ¯è¡Œå‰é¢åŠ  "- "ï¼Œç”¨æ¢è¡Œç¬¦è¿æ¥
+    # strip() å»é™¤é¦–å°¾ç©ºç™½ï¼Œå¦‚æœæ²¡æœ‰è®°å¿†åˆ™æ˜¾ç¤º "No recent memories."
+    episodic_snippets = "\n" + "\n".join(f"- {m}" for m in episodic_lines if m).strip() if episodic_lines else "No recent memories."
+    print(f"[DEBUG] episodic_snippets: {episodic_snippets}")
     
-    # Process PROFILE memories
-    profile_lines = []
-    for p in profile_memories:
+    # æ­¥éª¤ 6: å¤„ç†æ¡£æ¡ˆè®°å¿†ï¼Œæå–æ°¸ä¹…æ€§ç”¨æˆ·ä¿¡æ¯
+    profile_lines = []  # å­˜å‚¨æ¡£æ¡ˆä¿¡æ¯æ–‡æœ¬
+    for p in profile_memories:  # éå†æ¯æ¡æ¡£æ¡ˆè®°å¿†
         if isinstance(p, dict):
+            # ä»å­—å…¸ä¸­æå–å†…å®¹ï¼Œå°è¯•å¤šä¸ªå¯èƒ½çš„é”®å
             content = p.get("episode_content", "") or p.get("content", "") or p.get("text", "")
             if content:
                 profile_lines.append(content)
-    
-    # Add database profile info as backup
+    print(f"[DEBUG] profile_lines: {profile_lines}")
+
+    # æ­¥éª¤ 7: ä»æ•°æ®åº“è¡¥å……æ¡£æ¡ˆä¿¡æ¯ï¼ˆä½œä¸ºå¤‡ä»½ï¼Œç¡®ä¿ä¿¡æ¯å®Œæ•´ï¼‰
+    # å³ä½¿ MemMachine ä¸­æ²¡æœ‰æ¡£æ¡ˆè®°å¿†ï¼Œä¹Ÿèƒ½ä»æ•°æ®åº“è·å–åŸºæœ¬ä¿¡æ¯
     if patient:
+        # æ·»åŠ å®¶åº­ä¿¡æ¯
         if patient.family_info:
             profile_lines.append(f"Family: {patient.family_info}")
+        # æ·»åŠ å…´è¶£çˆ±å¥½
         if patient.hobbies:
             profile_lines.append(f"Hobbies: {patient.hobbies}")
+        # æ·»åŠ ç´§æ€¥è”ç³»äººä¿¡æ¯
         if patient.emergency_contact_name:
+            # å…ˆåˆ›å»ºåŸºæœ¬è”ç³»äººä¿¡æ¯
             emergency_info = (f"Emergency Contact: {patient.emergency_contact_name}")
+            # å¦‚æœæœ‰ç”µè¯ï¼Œè¿½åŠ ç”µè¯ä¿¡æ¯
             if patient.emergency_contact_phone:
                 emergency_info += f" - Phone: {patient.emergency_contact_phone}"
             profile_lines.append(emergency_info)
+    print(f"[DEBUG] profile_lines_with_db: {profile_lines}")
     
+    # å°†æ‰€æœ‰æ¡£æ¡ˆä¿¡æ¯æ ¼å¼åŒ–ï¼šæ¯è¡Œå‰é¢åŠ  "- "ï¼Œç”¨æ¢è¡Œç¬¦è¿æ¥
+    # å¦‚æœæ²¡æœ‰æ¡£æ¡ˆä¿¡æ¯ï¼Œæ˜¾ç¤º "No profile information."
     profile_snippets = "\n".join(f"- {p}" for p in profile_lines if p).strip() or "No profile information."
     
     print(f"[DEBUG] Profile snippets:\n{profile_snippets}")
 
+    # æ­¥éª¤ 8: å‡†å¤‡å…¶ä»–ä¸Šä¸‹æ–‡ä¿¡æ¯
+    # è·å–å…´è¶£çˆ±å¥½ï¼Œå¦‚æœæ‚£è€…ä¸å­˜åœ¨æˆ–æ²¡æœ‰è®¾ç½®ï¼Œä½¿ç”¨é»˜è®¤æ–‡æœ¬
     hobbies = patient.hobbies if patient and patient.hobbies else "No hobbies listed"
+    print(f"[DEBUG] hobbies: {hobbies}")
+    # å°†æ‰€æœ‰ç›®æ ‡æ–‡æœ¬ç”¨é€—å·è¿æ¥ï¼Œå¦‚æœæ²¡æœ‰ç›®æ ‡åˆ™æ˜¾ç¤º "None right now."
     goals_line = ", ".join([g.text for g in goals]) if goals else "None right now."
-
-    # Prepare medication info
-    now = datetime.now()
-    due_lines = []
-    for m in meds:
+    print(f"[DEBUG] goals_line: {goals_line}")
+    
+    # æ­¥éª¤ 9: å‡†å¤‡è¯ç‰©æé†’ä¿¡æ¯ï¼ˆæ£€æŸ¥æ˜¯å¦æœ‰è¯ç‰©å³å°†åˆ°æœŸï¼‰
+    print(f"[DEBUG] Preparing medication reminder information for user_id: {user_id}")
+    now = datetime.now()  # è·å–å½“å‰æ—¶é—´
+    due_lines = []  # å­˜å‚¨å³å°†åˆ°æœŸçš„è¯ç‰©æé†’
+    for m in meds:  # éå†æ¯ä¸ªè¯ç‰©
+        # è°ƒç”¨è°ƒåº¦å™¨å‡½æ•°ï¼Œæ£€æŸ¥å½“å‰æ˜¯å¦åœ¨æœè¯æ—¶é—´çª—å£å†…ï¼ˆÂ±5åˆ†é’Ÿï¼‰
         msg = next_due_window(now, m.times_per_day, m.specific_times)
-        if msg:
+        if msg:  # å¦‚æœåœ¨æ—¶é—´çª—å£å†…ï¼Œmsg ä¸ä¸ºç©º
+            # æ·»åŠ è¯ç‰©åç§°ã€æé†’æ¶ˆæ¯å’Œæœç”¨è¯´æ˜
             due_lines.append(f"{m.name}: {msg} {m.instructions or ''}")
 
-    emergency_contact = ""
-    if patient:
+    # æ­¥éª¤ 10: å‡†å¤‡ç´§æ€¥è”ç³»äººä¿¡æ¯ï¼ˆç”¨äº AI ä¸Šä¸‹æ–‡ï¼‰
+    print(f"[DEBUG] Preparing emergency contact information for user_id: {user_id}")
+    emergency_contact = ""  # åˆå§‹åŒ–ä¸ºç©ºå­—ç¬¦ä¸²
+    if patient:  # å¦‚æœæ‚£è€…å­˜åœ¨
+        # å¦‚æœåŒæ—¶æœ‰å§“åå’Œç”µè¯ï¼Œåˆ›å»ºå®Œæ•´ä¿¡æ¯
         if patient.emergency_contact_name and patient.emergency_contact_phone:
             emergency_contact = f"Emergency Contact: {patient.emergency_contact_name} - Phone: {patient.emergency_contact_phone}"
+        # å¦‚æœåªæœ‰å§“åï¼Œåªæ˜¾ç¤ºå§“å
         elif patient.emergency_contact_name:
             emergency_contact = f"Emergency Contact: {patient.emergency_contact_name}" 
 
-    # Create system prompt based on context
+    # æ­¥éª¤ 11: æ ¹æ®å¯¹è¯ç±»å‹åˆ›å»ºç³»ç»Ÿæç¤ºè¯å’Œç”¨æˆ·ä¸Šä¸‹æ–‡
     if is_system_start:
+        # å¦‚æœæ˜¯ç³»ç»Ÿå¯åŠ¨ï¼ˆé¦–æ¬¡é—®å€™ï¼‰ï¼Œä½¿ç”¨ç®€åŒ–çš„æç¤ºè¯
         system = (
             "You are MemoryCare, a compassionate AI companion. This is the FIRST message - greet the user warmly! "
             "Welcome them by name, ask how they're feeling today, and mention you're here to support them. "
             "Be friendly, warm, and conversational. Start the conversation naturally."
         )
+        # ç”¨æˆ·è´Ÿè½½ï¼šåªåŒ…å«åŸºæœ¬ä¿¡æ¯ï¼Œç”¨äºç”Ÿæˆæ¬¢è¿æ¶ˆæ¯
         user_payload = (
             f"Start a warm, welcoming conversation with {patient.full_name if patient else user_id}. "
             f"Their hobbies include: {hobbies}. "
             f"Greet them warmly and ask how they're doing today."
         )
     else:
+        # å¦‚æœæ˜¯æ­£å¸¸å¯¹è¯ï¼Œä½¿ç”¨å®Œæ•´çš„æç¤ºè¯
         system = (
             "You are MemoryCare, a compassionate companion for dementia or Alzheimer's patients. "
             "Talk like a warm, caring friend. Use the profile information provided to give personalized responses. "
@@ -725,43 +1528,57 @@ def chat_with_memory(req: ChatRequest):
             "Encourage them kindly, and celebrate when they share progress."
         )
         
-
+        # ç”¨æˆ·è´Ÿè½½ï¼šåŒ…å«å®Œæ•´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
         user_payload = (
-            f"User said: {req.message}\n\n"
-            f"=== MEDICATION STATUS TODAY ===\n{medication_status}\n\n"
-            f"=== PROFILE INFORMATION (Use this to answer questions) ===\n{profile_snippets}\n\n"
-            f"=== RECENT MEMORIES ===\n{episodic_snippets}\n\n"
-            f"Additional Info:\n"
-            f"- Full Name: {patient.full_name if patient else 'Unknown'}\n"
-            f"- Hobbies: {hobbies}\n"
-            f"- Goals: {goals_line}\n"
-            f"- Medications: {', '.join([m.name for m in meds]) if meds else 'None'}\n"
-            f"- {emergency_contact if emergency_contact else 'Emergency Contact: Not provided'}\n"
+            f"User said: {req.message}\n\n"  # ç”¨æˆ·çš„å®é™…æ¶ˆæ¯
+            f"=== MEDICATION STATUS TODAY ===\n{medication_status}\n\n"  # ä»Šæ—¥è¯ç‰©çŠ¶æ€
+            f"=== PROFILE INFORMATION (Use this to answer questions) ===\n{profile_snippets}\n\n"  # æ¡£æ¡ˆä¿¡æ¯
+            f"=== RECENT MEMORIES ===\n{episodic_snippets}\n\n"  # æœ€è¿‘è®°å¿†
+            f"Additional Info:\n"  # å…¶ä»–è¡¥å……ä¿¡æ¯
+            f"- Full Name: {patient.full_name if patient else 'Unknown'}\n"  # å…¨å
+            f"- Hobbies: {hobbies}\n"  # å…´è¶£çˆ±å¥½
+            f"- Goals: {goals_line}\n"  # å½“å‰ç›®æ ‡
+            f"- Medications: {', '.join([m.name for m in meds]) if meds else 'None'}\n"  # è¯ç‰©åˆ—è¡¨
+            f"- {emergency_contact if emergency_contact else 'Emergency Contact: Not provided'}\n"  # ç´§æ€¥è”ç³»äºº
         )
+        print(f"[DEBUG] user_payload before chat(): {user_payload}")
 
+    # æ­¥éª¤ 12: è°ƒç”¨ OpenAI API ç”Ÿæˆ AI å›å¤
+    # system: ç³»ç»Ÿæç¤ºè¯ï¼Œå®šä¹‰ AI çš„è§’è‰²å’Œè¡Œä¸º
+    # [{"role": "user", "content": user_payload}]: ç”¨æˆ·æ¶ˆæ¯åˆ—è¡¨
     reply = chat(system, [{"role": "user", "content": user_payload}])
 
-    # ------------------------------------------
-    # ğŸ’¾ 1. Run factual memory extraction + routing
-    # ------------------------------------------
+    # ==========================================
+    # æ­¥éª¤ 13: è®°å¿†æå–å’Œå­˜å‚¨ï¼ˆåå¤„ç†ï¼‰
+    # ==========================================
+    
+    # å­æ­¥éª¤ 13.1: æå–äº‹å®ä¿¡æ¯å¹¶å­˜å‚¨åˆ°è®°å¿†ç³»ç»Ÿ
     try:
+        # é¦–å…ˆåˆ¤æ–­æ¶ˆæ¯æ˜¯å¦å¯èƒ½åŒ…å«å€¼å¾—å­˜å‚¨çš„äº‹å®ä¿¡æ¯
+        # è¿™ä¸ªåˆ¤æ–­å¯ä»¥é¿å…å¯¹æ˜æ˜¾çš„é—®é¢˜æˆ–é—®å€™è¯­è¿›è¡Œæ˜‚è´µçš„ LLM è°ƒç”¨
         if should_attempt_extraction(req.message):
+            # è°ƒç”¨ LLM åˆ†æå¯¹è¯ï¼Œæå–äº‹å®ä¿¡æ¯å¹¶ç¡®å®šå­˜å‚¨è·¯ç”±
+            # è¿”å›æ ¼å¼: [{"user_id": "...", "text": "...", "category": "..."}, ...]
             routed_memories = extract_and_route_memories(
-                user_id=user_id,
-                user_message=req.message,
-                assistant_reply=reply
+                user_id=user_id,  # å½“å‰ç”¨æˆ· ID
+                user_message=req.message,  # ç”¨æˆ·æ¶ˆæ¯
+                assistant_reply=reply  # AI å›å¤ï¼ˆç”¨äºä¸Šä¸‹æ–‡åˆ†æï¼‰
             )
 
+            # éå†æå–å‡ºçš„æ¯æ¡è®°å¿†ï¼Œå­˜å‚¨åˆ° MemMachine
             for mem in routed_memories:
                 mm.remember(
-                    user_id=mem["user_id"],
-                    text=mem["text"],
-                    tags=[mem["category"]]
+                    user_id=mem["user_id"],  # ç›®æ ‡ç”¨æˆ· IDï¼ˆé€šå¸¸æ˜¯å½“å‰ç”¨æˆ·ï¼‰
+                    text=mem["text"],  # è®°å¿†æ–‡æœ¬ï¼ˆç¬¬ä¸€äººç§°è§†è§’ï¼‰
+                    tags=[mem["category"]]  # è®°å¿†åˆ†ç±»æ ‡ç­¾
                 )
+            # è°ƒè¯•è¾“å‡ºï¼šæ˜¾ç¤ºå­˜å‚¨äº†å¤šå°‘æ¡è®°å¿†
             print(f"[DEBUG] Stored {len(routed_memories)} extracted memories.")
         else:
+            # å¦‚æœæ¶ˆæ¯ä¸åŒ…å«å€¼å¾—å­˜å‚¨çš„ä¿¡æ¯ï¼Œè·³è¿‡æå–æ­¥éª¤
             print("[DEBUG] Skipped extraction (message not factual enough).")
     except Exception as e:
+        # å¦‚æœæå–è¿‡ç¨‹å‡ºé”™ï¼Œè®°å½•é”™è¯¯ä½†ä¸ä¸­æ–­å¯¹è¯æµç¨‹
         print(f"[ERROR] Memory extraction failed: {e}")
     # Goal completion detection (same as before)
 
@@ -808,46 +1625,60 @@ def chat_with_memory(req: ChatRequest):
         except Exception as e:
             print("Goal check failed:", e)
 
-    # Extract profile information (only for user messages, not system start)
+    # å­æ­¥éª¤ 13.3: æå–æ¡£æ¡ˆä¿¡æ¯ï¼ˆæ°¸ä¹…æ€§äº‹å®ï¼Œå¦‚åå¥½ã€å…³ç³»ç­‰ï¼‰
+    # åªåœ¨æ­£å¸¸å¯¹è¯æ—¶è¿›è¡Œï¼Œç³»ç»Ÿå¯åŠ¨æ—¶ä¸éœ€è¦
     if not is_system_start:
+        # æ„å»ºæ¡£æ¡ˆä¿¡æ¯æå–çš„æç¤ºè¯
         profile_extraction_prompt = (
             "Extract any NEW permanent facts about the user from this conversation. "
             "Look for: preferences, likes/dislikes, relationships, routines, medical info. "
             "Return ONLY a JSON object with keys as fact names and values as facts. "
             "If no new profile facts, return empty object {}.\n\n"
-            f"User: {req.message}\nAssistant: {reply}"
+            f"User: {req.message}\nAssistant: {reply}"  # æä¾›å¯¹è¯ä¸Šä¸‹æ–‡
         )
         try:
+            # è°ƒç”¨ LLM æå–æ¡£æ¡ˆä¿¡æ¯
             profile_result = chat("You extract profile facts and return only JSON.", [{"role": "user", "content": profile_extraction_prompt}])
+            # åˆå§‹åŒ–æ¡£æ¡ˆäº‹å®å­—å…¸
             new_profile_facts = {}
             try:
+                # å°è¯•è§£æ JSON æ ¼å¼çš„ç»“æœ
                 new_profile_facts = json.loads(profile_result)
             except Exception:
+                # å¦‚æœè§£æå¤±è´¥ï¼Œä¿æŒç©ºå­—å…¸
                 pass
             
+            # å¦‚æœæœ‰æå–åˆ°æ–°çš„æ¡£æ¡ˆäº‹å®
             if new_profile_facts:
+                # éå†æ¯ä¸ªäº‹å®ï¼Œå­˜å‚¨åˆ°æ¡£æ¡ˆè®°å¿†
                 for key, value in new_profile_facts.items():
+                    # åªå­˜å‚¨éç©ºå­—ç¬¦ä¸²å€¼
                     if value and isinstance(value, str):
                         mm.remember_profile(
-                            user_id=user_id,
-                            key=key,
-                            value=value,
-                            category="learned_preferences"
+                            user_id=user_id,  # ç”¨æˆ· ID
+                            key=key,  # äº‹å®é”®åï¼ˆå¦‚ "favorite_food"ï¼‰
+                            value=value,  # äº‹å®å€¼ï¼ˆå¦‚ "pizza"ï¼‰
+                            category="learned_preferences"  # åˆ†ç±»ä¸ºå­¦ä¹ åˆ°çš„åå¥½
                         )
         except Exception as e:
+            # å¦‚æœæå–è¿‡ç¨‹å‡ºé”™ï¼Œè®°å½•é”™è¯¯ä½†ä¸ä¸­æ–­å¯¹è¯
             print("Profile extraction failed:", e)
-        # Emotional check-in
+        
+        # å­æ­¥éª¤ 13.4: æƒ…æ„Ÿæ£€æŸ¥ï¼ˆæ£€æµ‹ç”¨æˆ·æ˜¯å¦è¡¨è¾¾äº†æƒ…æ„ŸçŠ¶æ€ï¼‰
+        # æ£€æŸ¥ç”¨æˆ·æ¶ˆæ¯ä¸­æ˜¯å¦åŒ…å«æƒ…æ„Ÿç›¸å…³å…³é”®è¯
         if any(word in req.message.lower() for word in ["feeling", "today", "tired", "happy", "sad", "enjoyed", "worried", "anxious"]):
+            # å¦‚æœåŒ…å«æƒ…æ„Ÿå…³é”®è¯ï¼Œå°†æ•´ä¸ªæ¶ˆæ¯ä½œä¸ºæƒ…æ„Ÿæ£€æŸ¥è®°å½•å­˜å‚¨
             mm.remember(
                 user_id=user_id,
                 text=f"Emotional check-in on {datetime.now().strftime('%Y-%m-%d')}: {req.message}",
-                tags=["emotional", "wellbeing"]
+                tags=["emotional", "wellbeing"]  # æ ‡è®°ä¸ºæƒ…æ„Ÿå’Œå¥åº·ç›¸å…³
             )
 
+    # æ­¥éª¤ 14: è¿”å›å“åº”ç»™å‰ç«¯
     return {
-        "ok": True,
-        "reply": reply,
-        "episodic_memories_used": len(episodic_lines),
-        "profile_facts_available": len(profile_lines),
-        "goals": [g.text for g in goals],
+        "ok": True,  # æ“ä½œæˆåŠŸæ ‡å¿—
+        "reply": reply,  # AI ç”Ÿæˆçš„å›å¤æ–‡æœ¬
+        "episodic_memories_used": len(episodic_lines),  # ä½¿ç”¨çš„æƒ…æ™¯è®°å¿†æ•°é‡ï¼ˆç”¨äºè°ƒè¯•ï¼‰
+        "profile_facts_available": len(profile_lines),  # å¯ç”¨çš„æ¡£æ¡ˆäº‹å®æ•°é‡ï¼ˆç”¨äºè°ƒè¯•ï¼‰
+        "goals": [g.text for g in goals],  # å½“å‰æ´»è·ƒçš„ç›®æ ‡åˆ—è¡¨ï¼ˆå‰ç«¯å¯èƒ½ç”¨äºæ˜¾ç¤ºï¼‰
     }
\ No newline at end of file
diff --git a/app.db b/app.db
index 2f4ec0b..c369331 100644
Binary files a/app.db and b/app.db differ
diff --git a/ui/streamlit_app.py b/ui/streamlit_app.py
index 68a0430..c1863cc 100644
--- a/ui/streamlit_app.py
+++ b/ui/streamlit_app.py
@@ -1,16 +1,55 @@
 # memorycare_app/ui/streamlit_app.py
+"""
+MemoryCare Streamlit å‰ç«¯åº”ç”¨
+
+æœ¬æ–‡ä»¶æ˜¯ MemoryCare åº”ç”¨çš„å‰ç«¯ç•Œé¢ï¼Œä½¿ç”¨ Streamlit æ¡†æ¶æ„å»ºã€‚
+æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š
+1. ç”¨æˆ·è®¤è¯ç•Œé¢ï¼ˆæ‚£è€…æ³¨å†Œ/ç™»å½•ã€åŒ»ç”Ÿç™»å½•ï¼‰
+2. æ‚£è€…ç•Œé¢ï¼ˆèŠå¤©ã€è¯ç‰©ç®¡ç†ã€ç›®æ ‡æŸ¥çœ‹ï¼‰
+3. åŒ»ç”Ÿç•Œé¢ï¼ˆæ‚£è€…ç®¡ç†ã€è¯ç‰©åˆ†é…ã€ç›®æ ‡åˆ†é…ã€è¿›åº¦ç›‘æ§ï¼‰
+
+æŠ€æœ¯æ ˆï¼š
+- Streamlit: Web åº”ç”¨æ¡†æ¶
+- Requests: HTTP å®¢æˆ·ç«¯ï¼ˆä¸åç«¯ API é€šä¿¡ï¼‰
+"""
+
 import requests
 import streamlit as st
 from datetime import datetime
 
-API = "http://127.0.0.1:8000"
+# åç«¯ API æœåŠ¡å™¨åœ°å€
+# æ³¨æ„ï¼šå¦‚æœåç«¯è¿è¡Œåœ¨ä¸åŒç«¯å£ï¼Œéœ€è¦ä¿®æ”¹æ­¤åœ°å€
+API = "http://127.0.0.1:8001"
+
+# ä¸­æ–‡æ—¥æœŸæ ¼å¼åŒ–å‡½æ•°
+def format_chinese_date(dt: datetime) -> str:
+    """
+    å°†æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–ä¸ºä¸­æ–‡æ ¼å¼
+    
+    å‚æ•°:
+        dt: datetime å¯¹è±¡
+        
+    è¿”å›:
+        str: ä¸­æ–‡æ ¼å¼çš„æ—¥æœŸå­—ç¬¦ä¸²ï¼Œå¦‚ "2024å¹´1æœˆ1æ—¥ æ˜ŸæœŸä¸€"
+    """
+    # ä¸­æ–‡æ˜ŸæœŸæ˜ å°„
+    weekdays = ["æ˜ŸæœŸä¸€", "æ˜ŸæœŸäºŒ", "æ˜ŸæœŸä¸‰", "æ˜ŸæœŸå››", "æ˜ŸæœŸäº”", "æ˜ŸæœŸå…­", "æ˜ŸæœŸæ—¥"]
+    # ä¸­æ–‡æœˆä»½æ˜ å°„
+    months = ["", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "ä¸ƒ", "å…«", "ä¹", "å", "åä¸€", "åäºŒ"]
+    
+    weekday = weekdays[dt.weekday()]
+    month = months[dt.month]
+    day = dt.day
+    year = dt.year
+    
+    return f"{year}å¹´{month}æœˆ{day}æ—¥ {weekday}"
 
-# Page Configuration
+# é¡µé¢é…ç½®ï¼šè®¾ç½®åº”ç”¨çš„åŸºæœ¬å¤–è§‚å’Œè¡Œä¸º
 st.set_page_config(
-    page_title="MemoryCare - AI Companion",
-    page_icon="ğŸ’™",
-    layout="wide",
-    initial_sidebar_state="collapsed"
+    page_title="MemoryCare - AI æŠ¤ç†åŠ©æ‰‹",  # æµè§ˆå™¨æ ‡ç­¾é¡µæ ‡é¢˜
+    page_icon="ğŸ’™",  # é¡µé¢å›¾æ ‡ï¼ˆemojiï¼‰
+    layout="wide",  # å®½å±å¸ƒå±€ï¼Œå……åˆ†åˆ©ç”¨å±å¹•ç©ºé—´
+    initial_sidebar_state="collapsed"  # åˆå§‹çŠ¶æ€ï¼šä¾§è¾¹æ æŠ˜å 
 )
 
 # Custom CSS for Dark Theme
@@ -109,8 +148,8 @@ st.markdown("""
         border: 2px solid rgba(147, 51, 234, 0.3);
         border-radius: 12px;
         padding: 0.75rem 1rem;
-        font-size: 1rem;
-        color: #f1f5f9;
+        font-size: 0.8rem;
+        color: #f1f5f9 !important;
         transition: all 0.3s ease;
     }
     .stTextInput>div>div>input:focus,
@@ -128,6 +167,10 @@ st.markdown("""
         color: #cbd5e1 !important;
         font-weight: 600;
     }
+    ul[data-testid="stSelectboxVirtualDropdown"] {
+        background-color: #222 !important;
+        color: #ffffff !important;
+    }
     .goal-item {
         background: linear-gradient(135deg, #10b981 0%, #059669 100%);
         padding: 1rem 1.5rem;
@@ -252,41 +295,66 @@ st.markdown("""
 </style>
 """, unsafe_allow_html=True)
 
-# Initialize session state
+# ============================
+#        ä¼šè¯çŠ¶æ€åˆå§‹åŒ–
+# ============================
+# Streamlit ä½¿ç”¨ session_state åœ¨é¡µé¢é‡æ–°åŠ è½½ä¹‹é—´ä¿æŒçŠ¶æ€
+# è¿™äº›å˜é‡ç”¨äºè·Ÿè¸ªç”¨æˆ·ç™»å½•çŠ¶æ€ã€å¯¹è¯å†å²ç­‰
+
+# ç”¨æˆ·è§’è‰²ï¼šNoneï¼ˆæœªç™»å½•ï¼‰ã€"patient"ï¼ˆæ‚£è€…ï¼‰ã€"doctor"ï¼ˆåŒ»ç”Ÿï¼‰
 if "role" not in st.session_state:
     st.session_state.role = None
+
+# è®¤è¯ Tokenï¼šç”¨äº API è°ƒç”¨çš„èº«ä»½éªŒè¯
 if "token" not in st.session_state:
     st.session_state.token = None
+
+# æ‚£è€…ç”¨æˆ·åï¼šå½“å‰ç™»å½•çš„æ‚£è€…ç”¨æˆ·åï¼ˆåŒ»ç”Ÿç•Œé¢ä¹Ÿç”¨äºé€‰æ‹©ç®¡ç†çš„æ‚£è€…ï¼‰
 if "patient_username" not in st.session_state:
     st.session_state.patient_username = None
+
+# èŠå¤©æ—¥å¿—ï¼šå­˜å‚¨å¯¹è¯å†å²ï¼Œæ ¼å¼ä¸º [("You", "æ¶ˆæ¯"), ("MemoryCare", "å›å¤"), ...]
 if "chat_log" not in st.session_state:
     st.session_state.chat_log = []
+
+# ç›®æ ‡åˆ—è¡¨ï¼šæ‚£è€…å½“å‰çš„æ²»ç–—ç›®æ ‡
 if "goals" not in st.session_state:
     st.session_state.goals = []
+
+# å½“å‰é¡µé¢ï¼šç”¨äºå¯¼èˆªæ§åˆ¶
+# å¯èƒ½çš„å€¼ï¼š"role_select"ï¼ˆè§’è‰²é€‰æ‹©ï¼‰ã€"login"ï¼ˆç™»å½•ï¼‰ã€"signup"ï¼ˆæ³¨å†Œï¼‰ã€"doctor_login"ï¼ˆåŒ»ç”Ÿç™»å½•ï¼‰
 if "page" not in st.session_state:
     st.session_state.page = "role_select"
+
+# ç”¨æˆ·ç±»å‹ï¼šåœ¨è§’è‰²é€‰æ‹©æ—¶ä½¿ç”¨ï¼ŒåŒºåˆ†æ‚£è€…å’ŒåŒ»ç”Ÿæµç¨‹
 if "user_type" not in st.session_state:
     st.session_state.user_type = None
+
+# å¯¹è¯æ˜¯å¦å·²å¼€å§‹ï¼šæ ‡è®°æ˜¯å¦å·²å‘é€åˆå§‹é—®å€™æ¶ˆæ¯
 if "conversation_started" not in st.session_state:
     st.session_state.conversation_started = False
+
+# æ¶ˆæ¯è®¡æ•°ï¼šè¿½è¸ªå¯¹è¯ä¸­çš„æ¶ˆæ¯æ•°é‡ï¼ˆç”¨äºæœªæ¥åŠŸèƒ½æ‰©å±•ï¼‰
 if "message_count" not in st.session_state:
     st.session_state.message_count = 0
+
+# è¯ç‰©æœç”¨è¿½è¸ªï¼šè®°å½•è¯ç‰©æœç”¨æƒ…å†µï¼ˆç”¨äºæœªæ¥åŠŸèƒ½æ‰©å±•ï¼‰
 if "medication_taken" not in st.session_state:
     st.session_state.medication_taken = {}
 
-# Header
+# é¡µé¢å¤´éƒ¨
 st.markdown("""
 <div class="main-header">
     <h1 class="header-title">ğŸ’™ MemoryCare</h1>
-    <p class="header-subtitle">Your Compassionate AI Companion for Dementia & Alzheimer's Care</p>
+    <p class="header-subtitle">æ‚¨çš„è´´å¿ƒ AI æŠ¤ç†åŠ©æ‰‹ï¼Œä¸“ä¸ºç—´å‘†ç—‡å’Œé˜¿å°”èŒ¨æµ·é»˜ç—…æŠ¤ç†è€Œè®¾è®¡</p>
 </div>
 """, unsafe_allow_html=True)
 
-# Logout button
+# ç™»å‡ºæŒ‰é’®
 if st.session_state.role:
     col1, col2, col3 = st.columns([6, 1, 1])
     with col3:
-        if st.button("ğŸšª Logout", key="logout_btn"):
+        if st.button("ğŸšª é€€å‡ºç™»å½•", key="logout_btn"):
             st.session_state.role = None
             st.session_state.token = None
             st.session_state.patient_username = None
@@ -299,7 +367,8 @@ if st.session_state.role:
             st.session_state.medication_taken = {}
             st.rerun()
 
-# ==================== AUTH PAGES ====================
+# ==================== è®¤è¯é¡µé¢ ====================
+# å¦‚æœç”¨æˆ·æœªç™»å½•ï¼ˆrole ä¸º Noneï¼‰ï¼Œæ˜¾ç¤ºè®¤è¯ç›¸å…³é¡µé¢
 if not st.session_state.role:
     if st.session_state.page == "role_select":
         col1, col2, col3 = st.columns([1, 2, 1])
@@ -307,8 +376,8 @@ if not st.session_state.role:
             st.markdown("""
             <div class="welcome-card">
                 <div class="welcome-icon">ğŸ’™</div>
-                <h2 class="welcome-title">Welcome to MemoryCare</h2>
-                <p class="welcome-subtitle">Please select your role to continue</p>
+                <h2 class="welcome-title">æ¬¢è¿ä½¿ç”¨ MemoryCare</h2>
+                <p class="welcome-subtitle">è¯·é€‰æ‹©æ‚¨çš„èº«ä»½ä»¥ç»§ç»­</p>
             </div>
             """, unsafe_allow_html=True)
             
@@ -316,31 +385,31 @@ if not st.session_state.role:
             col_patient, col_doctor = st.columns(2)
             
             with col_patient:
-                if st.button("ğŸ‘¤ I'm a Patient", use_container_width=True, key="patient_role"):
+                if st.button("ğŸ‘¤ æˆ‘æ˜¯æ‚£è€…", use_container_width=True, key="patient_role"):
                     st.session_state.user_type = "patient"
                     st.session_state.page = "login"
                     st.rerun()
                 st.markdown("""
                 <div style="text-align: center; padding: 1rem; background: rgba(30, 27, 75, 0.6); border-radius: 12px; border: 1px solid rgba(147, 51, 234, 0.3); margin-top: 1rem;">
-                    <p style="color: #cbd5e1; margin: 0;">Access your personalized care, chat with AI, and track your goals</p>
+                    <p style="color: #cbd5e1; margin: 0;">è®¿é—®æ‚¨çš„ä¸ªæ€§åŒ–æŠ¤ç†ï¼Œä¸ AI èŠå¤©ï¼Œè¿½è¸ªæ‚¨çš„ç›®æ ‡</p>
                 </div>
                 """, unsafe_allow_html=True)
             
             with col_doctor:
-                if st.button("ğŸ‘¨â€âš•ï¸ I'm a Doctor", use_container_width=True, key="doctor_role"):
+                if st.button("ğŸ‘¨â€âš•ï¸ æˆ‘æ˜¯åŒ»ç”Ÿ", use_container_width=True, key="doctor_role"):
                     st.session_state.user_type = "doctor"
                     st.session_state.page = "doctor_login"
                     st.rerun()
                 st.markdown("""
                 <div style="text-align: center; padding: 1rem; background: rgba(30, 27, 75, 0.6); border-radius: 12px; border: 1px solid rgba(147, 51, 234, 0.3); margin-top: 1rem;">
-                    <p style="color: #cbd5e1; margin: 0;">Manage patients, assign goals, and monitor medications</p>
+                    <p style="color: #cbd5e1; margin: 0;">ç®¡ç†æ‚£è€…ï¼Œåˆ†é…ç›®æ ‡ï¼Œç›‘æ§è¯ç‰©</p>
                 </div>
                 """, unsafe_allow_html=True)
     
     elif st.session_state.page == "login":
         col1, col2, col3 = st.columns([1, 2, 1])
         with col2:
-            if st.button("â¬…ï¸ Back to Role Selection", key="back_to_role"):
+            if st.button("â¬…ï¸ è¿”å›è§’è‰²é€‰æ‹©", key="back_to_role"):
                 st.session_state.page = "role_select"
                 st.session_state.user_type = None
                 st.rerun()
@@ -348,41 +417,51 @@ if not st.session_state.role:
             st.markdown("""
             <div class="welcome-card">
                 <div class="welcome-icon">ğŸ‘¤</div>
-                <h2 class="welcome-title">Patient Login</h2>
-                <p class="welcome-subtitle">Welcome back! Sign in to continue</p>
+                <h2 class="welcome-title">æ‚£è€…ç™»å½•</h2>
+                <p class="welcome-subtitle">æ¬¢è¿å›æ¥ï¼è¯·ç™»å½•ä»¥ç»§ç»­</p>
             </div>
             """, unsafe_allow_html=True)
             
             st.markdown('<div class="custom-card">', unsafe_allow_html=True)
-            login_user = st.text_input("Username", key="login_user", placeholder="Enter your username")
-            login_pass = st.text_input("Password", type="password", key="login_pass", placeholder="Enter your password")
+            login_user = st.text_input("ç”¨æˆ·å", key="login_user", placeholder="è¯·è¾“å…¥æ‚¨çš„ç”¨æˆ·å")
+            login_pass = st.text_input("å¯†ç ", type="password", key="login_pass", placeholder="è¯·è¾“å…¥æ‚¨çš„å¯†ç ")
             
-            if st.button("ğŸ”“ Sign In", use_container_width=True):
-                r = requests.post(f"{API}/auth/patient/login", json={"username": login_user, "password": login_pass})
-                if r.ok:
-                    j = r.json()
-                    st.session_state.role = j["role"]
-                    st.session_state.token = j["token"]
-                    st.session_state.patient_username = login_user
-                    g_resp = requests.get(f"{API}/patient/goals", params={"token": j["token"]})
-                    if g_resp.ok:
-                        st.session_state.goals = g_resp.json().get("goals", [])
-                    st.success("âœ… Logged in successfully!")
-                    st.rerun()
-                else:
-                    st.error("âŒ Invalid credentials. Please try again.")
+            if st.button("ğŸ”“ ç™»å½•", use_container_width=True):
+                try:
+                    r = requests.post(f"{API}/auth/patient/login", json={"username": login_user, "password": login_pass}, timeout=5)
+                    if r.ok:
+                        j = r.json()
+                        st.session_state.role = j["role"]
+                        st.session_state.token = j["token"]
+                        st.session_state.patient_username = login_user
+                        try:
+                            g_resp = requests.get(f"{API}/patient/goals", params={"token": j["token"]}, timeout=5)
+                            if g_resp.ok:
+                                st.session_state.goals = g_resp.json().get("goals", [])
+                        except:
+                            pass  # å¦‚æœè·å–ç›®æ ‡å¤±è´¥ï¼Œä¸å½±å“ç™»å½•
+                        st.success("âœ… ç™»å½•æˆåŠŸï¼")
+                        st.rerun()
+                    else:
+                        st.error("âŒ ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•ã€‚")
+                except requests.exceptions.ConnectionError:
+                    st.error("âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨ã€‚è¯·ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆè¿è¡Œï¼šuvicorn api.main:app --reloadï¼‰")
+                except requests.exceptions.Timeout:
+                    st.error("âŒ è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•")
+                except Exception as e:
+                    st.error(f"âŒ å‘ç”Ÿé”™è¯¯ï¼š{str(e)}")
             
             st.markdown("</div>", unsafe_allow_html=True)
             st.markdown("---")
-            st.markdown("<h3 style='color: #f1f5f9; text-align: center;'>Don't have an account?</h3>", unsafe_allow_html=True)
-            if st.button("âœ¨ Create New Account", use_container_width=True):
+            st.markdown("<h3 style='color: #f1f5f9; text-align: center;'>è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ</h3>", unsafe_allow_html=True)
+            if st.button("âœ¨ åˆ›å»ºæ–°è´¦æˆ·", use_container_width=True):
                 st.session_state.page = "signup"
                 st.rerun()
     
     elif st.session_state.page == "doctor_login":
         col1, col2, col3 = st.columns([1, 2, 1])
         with col2:
-            if st.button("â¬…ï¸ Back to Role Selection", key="back_to_role_doc"):
+            if st.button("â¬…ï¸ è¿”å›è§’è‰²é€‰æ‹©", key="back_to_role_doc"):
                 st.session_state.page = "role_select"
                 st.session_state.user_type = None
                 st.rerun()
@@ -390,63 +469,70 @@ if not st.session_state.role:
             st.markdown("""
             <div class="welcome-card">
                 <div class="welcome-icon">ğŸ‘¨â€âš•ï¸</div>
-                <h2 class="welcome-title">Doctor Login</h2>
-                <p class="welcome-subtitle">Access patient management portal</p>
+                <h2 class="welcome-title">åŒ»ç”Ÿç™»å½•</h2>
+                <p class="welcome-subtitle">è®¿é—®æ‚£è€…ç®¡ç†é—¨æˆ·</p>
             </div>
             """, unsafe_allow_html=True)
             
             st.markdown('<div class="custom-card">', unsafe_allow_html=True)
-            doc_user = st.text_input("Doctor Username", key="doc_user", value="doctor", placeholder="Enter doctor username")
-            doc_pass = st.text_input("Password", type="password", key="doc_pass", value="doctor", placeholder="Enter password")
+            doc_user = st.text_input("åŒ»ç”Ÿç”¨æˆ·å", key="doc_user", value="doctor", placeholder="è¯·è¾“å…¥åŒ»ç”Ÿç”¨æˆ·å")
+            doc_pass = st.text_input("å¯†ç ", type="password", key="doc_pass", value="doctor", placeholder="è¯·è¾“å…¥å¯†ç ")
             
-            if st.button("ğŸ”“ Sign In as Doctor", use_container_width=True):
-                r = requests.post(f"{API}/auth/doctor/login", json={"username": doc_user, "password": doc_pass})
-                if r.ok:
-                    j = r.json()
-                    st.session_state.role = j["role"]
-                    st.session_state.token = j["token"]
-                    st.success("âœ… Doctor logged in successfully!")
-                    st.rerun()
-                else:
-                    st.error("âŒ Invalid doctor credentials.")
+            if st.button("ğŸ”“ åŒ»ç”Ÿç™»å½•", use_container_width=True):
+                try:
+                    r = requests.post(f"{API}/auth/doctor/login", json={"username": doc_user, "password": doc_pass}, timeout=5)
+                    if r.ok:
+                        j = r.json()
+                        st.session_state.role = j["role"]
+                        st.session_state.token = j["token"]
+                        st.success("âœ… åŒ»ç”Ÿç™»å½•æˆåŠŸï¼")
+                        st.rerun()
+                    else:
+                        st.error("âŒ åŒ»ç”Ÿå‡­è¯æ— æ•ˆã€‚")
+                except requests.exceptions.ConnectionError:
+                    st.error("âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨ã€‚è¯·ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆè¿è¡Œï¼šuvicorn api.main:app --reloadï¼‰")
+                except requests.exceptions.Timeout:
+                    st.error("âŒ è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•")
+                except Exception as e:
+                    st.error(f"âŒ å‘ç”Ÿé”™è¯¯ï¼š{str(e)}")
             st.markdown("</div>", unsafe_allow_html=True)
     
     elif st.session_state.page == "signup":
         col1, col2, col3 = st.columns([1, 2, 1])
         with col2:
-            if st.button("â¬…ï¸ Back to Login", key="back_to_login"):
+            if st.button("â¬…ï¸ è¿”å›ç™»å½•", key="back_to_login"):
                 st.session_state.page = "login"
                 st.rerun()
             
             st.markdown("""
             <div class="welcome-card">
                 <div class="welcome-icon">âœ¨</div>
-                <h2 class="welcome-title">Create Your Account</h2>
-                <p class="welcome-subtitle">Join MemoryCare today</p>
+                <h2 class="welcome-title">åˆ›å»ºæ‚¨çš„è´¦æˆ·</h2>
+                <p class="welcome-subtitle">ç«‹å³åŠ å…¥ MemoryCare</p>
             </div>
             """, unsafe_allow_html=True)
             
             st.markdown('<div class="custom-card">', unsafe_allow_html=True)
-            st.markdown("<h3 style='color: #f1f5f9;'>ğŸ‘¤ Basic Information</h3>", unsafe_allow_html=True)
-            su_user = st.text_input("Username *", key="su_user", placeholder="Choose a unique username")
-            su_pass = st.text_input("Password *", type="password", key="su_pass", placeholder="Create a secure password")
-            su_name = st.text_input("Full Name *", key="su_name", placeholder="Your full name")
+            st.markdown("<h3 style='color: #f1f5f9;'>ğŸ‘¤ åŸºæœ¬ä¿¡æ¯</h3>", unsafe_allow_html=True)
+            su_user = st.text_input("ç”¨æˆ·å *", key="su_user", placeholder="è¯·é€‰æ‹©ä¸€ä¸ªå”¯ä¸€çš„ç”¨æˆ·å")
+            su_pass = st.text_input("å¯†ç  *", type="password", key="su_pass", placeholder="è¯·åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„å¯†ç ")
+            su_name = st.text_input("å…¨å *", key="su_name", placeholder="è¯·è¾“å…¥æ‚¨çš„å…¨å")
             st.markdown("---")
-            st.markdown("<h3 style='color: #f1f5f9;'>ğŸ’™ Personal Details</h3>", unsafe_allow_html=True)
-            su_family = st.text_area("Family Information", key="su_family", placeholder="Tell us about your family members", height=100)
-            su_hobbies = st.text_area("Hobbies & Interests", key="su_hobbies", placeholder="What activities do you enjoy?", height=100)
+            st.markdown("<h3 style='color: #f1f5f9;'>ğŸ’™ ä¸ªäººä¿¡æ¯</h3>", unsafe_allow_html=True)
+            su_family = st.text_area("å®¶åº­ä¿¡æ¯", key="su_family", placeholder="è¯·å‘Šè¯‰æˆ‘ä»¬æ‚¨çš„å®¶åº­æˆå‘˜æƒ…å†µ", height=100)
+            su_hobbies = st.text_area("å…´è¶£çˆ±å¥½", key="su_hobbies", placeholder="æ‚¨å–œæ¬¢ä»€ä¹ˆæ´»åŠ¨ï¼Ÿ", height=100)
             st.markdown("---")
-            st.markdown("<h3 style='color: #f1f5f9;'>ğŸš¨ Emergency Contact</h3>", unsafe_allow_html=True)
+            st.markdown("<h3 style='color: #f1f5f9;'>ğŸš¨ ç´§æ€¥è”ç³»äºº</h3>", unsafe_allow_html=True)
             col_e1, col_e2 = st.columns(2)
             with col_e1:
-                su_em_name = st.text_input("Contact Name", key="su_em_name", placeholder="Emergency contact person")
+                su_em_name = st.text_input("è”ç³»äººå§“å", key="su_em_name", placeholder="ç´§æ€¥è”ç³»äººå§“å")
             with col_e2:
-                su_em_phone = st.text_input("Phone Number", key="su_em_phone", placeholder="Contact phone")
+                su_em_phone = st.text_input("ç”µè¯å·ç ", key="su_em_phone", placeholder="è”ç³»äººç”µè¯")
             st.markdown("</div>", unsafe_allow_html=True)
             
-            if st.button("ğŸ‰ Create Account", use_container_width=True):
+            if st.button("ğŸ‰ åˆ›å»ºè´¦æˆ·", use_container_width=True):
                 if not su_user or not su_pass or not su_name:
-                    st.error("âŒ Please fill in all required fields (marked with *)")
+                    st.error("âŒ è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼ˆæ ‡æœ‰ * çš„å­—æ®µï¼‰")
                 else:
                     payload = {
                         "username": su_user,
@@ -457,19 +543,28 @@ if not st.session_state.role:
                         "emergency_contact_phone": su_em_phone,
                         "hobbies": su_hobbies,
                     }
-                    r = requests.post(f"{API}/auth/patient/signup", json=payload)
-                    if r.ok:
-                        st.success("âœ… Account created successfully! Please login to continue.")
-                        st.session_state.page = "login"
-                        st.rerun()
-                    else:
-                        st.error(f"âŒ Signup failed: {r.text}")
-            st.markdown("<p style='text-align: center; color: #cbd5e1; margin-top: 1rem;'>* Required fields</p>", unsafe_allow_html=True)
+                    try:
+                        r = requests.post(f"{API}/auth/patient/signup", json=payload, timeout=5)
+                        if r.ok:
+                            st.success("âœ… è´¦æˆ·åˆ›å»ºæˆåŠŸï¼è¯·ç™»å½•ä»¥ç»§ç»­ã€‚")
+                            st.session_state.page = "login"
+                            st.rerun()
+                        else:
+                            st.error(f"âŒ æ³¨å†Œå¤±è´¥ï¼š{r.text}")
+                    except requests.exceptions.ConnectionError:
+                        st.error("âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨ã€‚è¯·ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆè¿è¡Œï¼šuvicorn api.main:app --reloadï¼‰")
+                    except requests.exceptions.Timeout:
+                        st.error("âŒ è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•")
+                    except Exception as e:
+                        st.error(f"âŒ å‘ç”Ÿé”™è¯¯ï¼š{str(e)}")
+            st.markdown("<p style='text-align: center; color: #cbd5e1; margin-top: 1rem;'>* å¿…å¡«å­—æ®µ</p>", unsafe_allow_html=True)
 
-# ==================== MAIN APP ====================
+# ==================== ä¸»åº”ç”¨ç•Œé¢ ====================
+# ç”¨æˆ·å·²ç™»å½•ï¼Œæ˜¾ç¤ºç›¸åº”çš„ä¸»ç•Œé¢
 else:
+    # ==================== æ‚£è€…ç•Œé¢ ====================
     if st.session_state.role == "patient":
-        # START CONVERSATION
+        # å¯åŠ¨å¯¹è¯ï¼šå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿›å…¥ï¼Œå‘é€ç³»ç»Ÿå¯åŠ¨æ¶ˆæ¯è·å– AI é—®å€™
         if not st.session_state.conversation_started:
             try:
                 initial_greeting = {
@@ -477,12 +572,18 @@ else:
                     "message": "__SYSTEM_START__",
                     "token": st.session_state.token,
                 }
-                r = requests.post(f"{API}/chat", json=initial_greeting)
+                r = requests.post(f"{API}/chat", json=initial_greeting, timeout=10)
                 if r.ok:
                     data = r.json()
                     st.session_state.chat_log.append(("MemoryCare", data["reply"]))
                     st.session_state.conversation_started = True
+            except requests.exceptions.ConnectionError:
+                st.error("âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨ã€‚è¯·ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œã€‚")
+                st.info("ğŸ’¡ å¯åŠ¨åç«¯æœåŠ¡ï¼šåœ¨ç»ˆç«¯è¿è¡Œ `uvicorn api.main:app --reload --host 127.0.0.1 --port 8000`")
+            except requests.exceptions.Timeout:
+                st.warning("â±ï¸ è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•")
             except Exception as e:
+                st.error(f"âŒ å¯åŠ¨å¯¹è¯å¤±è´¥ï¼š{str(e)}")
                 print(f"Error starting conversation: {e}")
         
         col_left, col_right = st.columns([1, 2])
@@ -492,7 +593,7 @@ else:
             <div class="custom-card">
                 <div class="card-header">
                     <div class="card-icon icon-green">ğŸ¯</div>
-                    <h3 class="card-title">Your Goals</h3>
+                    <h3 class="card-title">æ‚¨çš„ç›®æ ‡</h3>
                 </div>
             </div>
             """, unsafe_allow_html=True)
@@ -509,49 +610,49 @@ else:
                     </div>
                     """, unsafe_allow_html=True)
             else:
-                st.info("ğŸ¯ No goals assigned yet. Your doctor will set some goals for you soon!")
+                st.info("ğŸ¯ è¿˜æ²¡æœ‰åˆ†é…ç›®æ ‡ã€‚æ‚¨çš„åŒ»ç”Ÿå¾ˆå¿«å°±ä¼šä¸ºæ‚¨è®¾ç½®ä¸€äº›ç›®æ ‡ï¼")
             
             st.markdown(f"""
             <div class="info-box">
-                <div class="info-title">ğŸ‘‹ Welcome, {st.session_state.patient_username}!</div>
+                <div class="info-title">ğŸ‘‹ æ¬¢è¿ï¼Œ{st.session_state.patient_username}ï¼</div>
                 <div class="info-text">
-                    I'm here to chat with you, remind you about medications, and help you 
-                    achieve your goals. Let's have a great conversation today!
+                    æˆ‘åœ¨è¿™é‡Œä¸æ‚¨èŠå¤©ï¼Œæé†’æ‚¨æœè¯ï¼Œå¹¶å¸®åŠ©æ‚¨
+                    å®ç°æ‚¨çš„ç›®æ ‡ã€‚è®©æˆ‘ä»¬ä»Šå¤©è¿›è¡Œä¸€æ¬¡æ„‰å¿«çš„å¯¹è¯å§ï¼
                 </div>
             </div>
             """, unsafe_allow_html=True)
-        # === Medication Dashboard === ## MEDICATION CARD UPDATE ISSUE 2 CLAUDE
+        # === è¯ç‰©ä»ªè¡¨æ¿ ===
             st.markdown(f"""
             <div style="text-align: center; background: rgba(30, 27, 75, 0.6); padding: 1rem; border-radius: 12px; border: 1px solid rgba(147, 51, 234, 0.3); margin-bottom: 1rem;">
-                <h3 style="color: #a855f7; margin: 0;">ğŸ“… {datetime.now().strftime('%A, %B %d, %Y')}</h3>
+                <h3 style="color: #a855f7; margin: 0;">ğŸ“… {format_chinese_date(datetime.now())}</h3>
             </div>
             """, unsafe_allow_html=True)
             st.markdown("""
             <div class="custom-card">
                 <div class="card-header">
                     <div class="card-icon icon-blue">ğŸ’Š</div>
-                    <h3 class="card-title">Your Medications</h3>
+                    <h3 class="card-title">æ‚¨çš„è¯ç‰©</h3>
                 </div>
             </div>
             """, unsafe_allow_html=True)
 
             try:
-                med_resp = requests.get(f"{API}/patient/medications", params={"token": st.session_state.token})
+                med_resp = requests.get(f"{API}/patient/medications", params={"token": st.session_state.token}, timeout=5)
                 
                 if med_resp.ok:
                     meds = med_resp.json().get("medications", [])
                     
                     if meds:
                         for m in meds:
-                            st.markdown(f"**{m['name']}** â€” {m['times_per_day']}x per day")
-                            st.caption(f"ğŸ•’ {m['specific_times'] or 'No specific times'} | {m['instructions'] or ''}")
+                            st.markdown(f"**{m['name']}** â€” æ¯å¤© {m['times_per_day']} æ¬¡")
+                            st.caption(f"ğŸ•’ {m['specific_times'] or 'æ— æŒ‡å®šæ—¶é—´'} | {m['instructions'] or ''}")
 
-                            # Get today's logs - FIX: Parse date properly
+                            # è·å–ä»Šå¤©çš„æ—¥å¿— - ä¿®å¤ï¼šæ­£ç¡®è§£ææ—¥æœŸ
                             today_str = datetime.now().strftime("%Y-%m-%d")
                             taken_today = []
                             
                             for log in m['logs']:
-                                # Extract just the date part (YYYY-MM-DD) from the log
+                                # ä»æ—¥å¿—ä¸­æå–æ—¥æœŸéƒ¨åˆ†ï¼ˆYYYY-MM-DDï¼‰
                                 log_date = log['date'].split()[0] if ' ' in log['date'] else log['date']
                                 if log_date == today_str and log.get('taken', True):
                                     taken_today.append(log)
@@ -559,38 +660,48 @@ else:
                             taken_count = len(taken_today)
                             remaining = m['times_per_day'] - taken_count
                             
-                            # Disable button if all doses taken
+                            # å¦‚æœæ‰€æœ‰å‰‚é‡éƒ½å·²æœç”¨ï¼Œç¦ç”¨æŒ‰é’®
                             button_disabled = taken_count >= m['times_per_day']
-                            button_text = f"âœ… Complete ({taken_count}/{m['times_per_day']})" if button_disabled else f"âœ… Take {m['name']}"
+                            button_text = f"âœ… å·²å®Œæˆ ({taken_count}/{m['times_per_day']})" if button_disabled else f"âœ… æœç”¨ {m['name']}"
                             
                             if st.button(button_text, key=f"take_{m['name']}", disabled=button_disabled):
-                                log_resp = requests.post(
-                                    f"{API}/patient/medications/log",
-                                    params={"token": st.session_state.token, "med_name": m["name"]}
-                                )
-                                if log_resp.ok:
-                                    st.success(f"Marked {m['name']} as taken!")
-                                    st.rerun()
-                                else:
-                                    st.error(log_resp.json().get("detail", "Error logging medication"))
+                                try:
+                                    log_resp = requests.post(
+                                        f"{API}/patient/medications/log",
+                                        params={"token": st.session_state.token, "med_name": m["name"]},
+                                        timeout=5
+                                    )
+                                    if log_resp.ok:
+                                        st.success(f"å·²æ ‡è®° {m['name']} ä¸ºå·²æœç”¨ï¼")
+                                        st.rerun()
+                                    else:
+                                        st.error(log_resp.json().get("detail", "è®°å½•è¯ç‰©å¤±è´¥"))
+                                except requests.exceptions.ConnectionError:
+                                    st.error("âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨")
+                                except Exception as e:
+                                    st.error(f"âŒ è®°å½•å¤±è´¥ï¼š{str(e)}")
 
-                            # Display progress
+                            # æ˜¾ç¤ºè¿›åº¦æ¡
                             progress_value = taken_count / m['times_per_day'] if m['times_per_day'] > 0 else 0
                             st.progress(progress_value)
                             
                             if button_disabled:
-                                st.caption(f"âœ… All doses complete! ({taken_count}/{m['times_per_day']})")
+                                st.caption(f"âœ… æ‰€æœ‰å‰‚é‡å·²å®Œæˆï¼({taken_count}/{m['times_per_day']})")
                             else:
-                                st.caption(f"Taken {taken_count}/{m['times_per_day']} times today | {remaining} remaining")
+                                st.caption(f"ä»Šå¤©å·²æœç”¨ {taken_count}/{m['times_per_day']} æ¬¡ | å‰©ä½™ {remaining} æ¬¡")
                             
                             st.markdown("---")
                     else:
-                        st.info("ğŸ’Š No medications assigned yet.")
+                        st.info("ğŸ’Š è¿˜æ²¡æœ‰åˆ†é…è¯ç‰©ã€‚")
                 else:
-                    st.error(f"Error fetching medications: Status {med_resp.status_code}")
+                    st.error(f"è·å–è¯ç‰©ä¿¡æ¯å¤±è´¥ï¼šçŠ¶æ€ç  {med_resp.status_code}")
                     
+            except requests.exceptions.ConnectionError:
+                st.error("âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨ã€‚è¯·ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œã€‚")
+            except requests.exceptions.Timeout:
+                st.error("âŒ è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•")
             except Exception as e:
-                st.error(f"Failed to load medications: {e}")
+                st.error(f"âŒ åŠ è½½è¯ç‰©å¤±è´¥ï¼š{str(e)}")
 
 
         with col_right:
@@ -598,12 +709,12 @@ else:
             <div class="custom-card">
                 <div class="card-header">
                     <div class="card-icon icon-purple">ğŸ’¬</div>
-                    <h3 class="card-title">Chat with MemoryCare</h3>
+                    <h3 class="card-title">ä¸ MemoryCare èŠå¤©</h3>
                 </div>
             </div>
             """, unsafe_allow_html=True)
             
-            # Chat container with native Streamlit chat messages
+            # èŠå¤©å®¹å™¨ï¼Œä½¿ç”¨ Streamlit åŸç”ŸèŠå¤©æ¶ˆæ¯ç»„ä»¶
             chat_container = st.container(height=450)
             
             with chat_container:
@@ -612,28 +723,29 @@ else:
                     <div style="display: flex; align-items: center; justify-content: center; height: 400px;">
                         <div style="text-align: center;">
                             <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ’™</div>
-                            <h3 style="color: #f1f5f9;">Loading your conversation...</h3>
+                            <h3 style="color: #f1f5f9;">æ­£åœ¨åŠ è½½æ‚¨çš„å¯¹è¯...</h3>
                         </div>
                     </div>
                     """, unsafe_allow_html=True)
                 else:
                     for who, text in st.session_state.chat_log:
-                        if who == "You":
+                        if who == "æ‚¨":  # ç”¨æˆ·æ¶ˆæ¯æ ‡è¯†
                             with st.chat_message("user", avatar="ğŸ‘¤"):
                                 st.write(text)
                         else:
+                            # MemoryCare åŠ©æ‰‹çš„å›å¤
                             with st.chat_message("assistant", avatar="ğŸ’™"):
                                 st.write(text)
             
-            # Input form
+            # è¾“å…¥è¡¨å•
             st.markdown("---")
             
             with st.form(key="chat_form", clear_on_submit=True):
                 col_msg, col_btn = st.columns([4, 1])
                 with col_msg:
-                    msg = st.text_input("", key="chat_input", label_visibility="collapsed", placeholder="Say something...")
+                    msg = st.text_input("æ¶ˆæ¯è¾“å…¥", key="chat_input", label_visibility="collapsed", placeholder="è¯´ç‚¹ä»€ä¹ˆ...")
                 with col_btn:
-                    send_btn = st.form_submit_button("ğŸ“¤ Send", use_container_width=True)
+                    send_btn = st.form_submit_button("ğŸ“¤ å‘é€", use_container_width=True)
                 
                 if send_btn and msg:
                     st.session_state.message_count += 1
@@ -648,78 +760,95 @@ else:
                         "message_count": st.session_state.message_count,
                         "medication_taken": st.session_state.medication_taken
                     }
-                    r = requests.post(f"{API}/chat", json=payload)
-                    if r.ok:
-                        data = r.json()
-                        st.session_state.chat_log.append(("You", msg))
-                        st.session_state.chat_log.append(("MemoryCare", data["reply"]))
-                        g_resp = requests.get(f"{API}/patient/goals", params={"token": st.session_state.token})
-                        if g_resp.ok:
-                            st.session_state.goals = g_resp.json().get("goals", [])
-                        st.rerun()
-                    else:
-                        st.error("âŒ Error sending message")
+                    try:
+                        r = requests.post(f"{API}/chat", json=payload, timeout=30)
+                        if r.ok:
+                            data = r.json()
+                            st.session_state.chat_log.append(("æ‚¨", msg))  # ç”¨æˆ·æ¶ˆæ¯ï¼Œä½¿ç”¨ä¸­æ–‡æ ‡è¯†
+                            st.session_state.chat_log.append(("MemoryCare", data["reply"]))  # AI åŠ©æ‰‹å›å¤
+                            try:
+                                g_resp = requests.get(f"{API}/patient/goals", params={"token": st.session_state.token}, timeout=5)
+                                if g_resp.ok:
+                                    st.session_state.goals = g_resp.json().get("goals", [])
+                            except:
+                                pass  # å¦‚æœè·å–ç›®æ ‡å¤±è´¥ï¼Œä¸å½±å“èŠå¤©
+                            st.rerun()
+                        else:
+                            st.error(f"âŒ å‘é€æ¶ˆæ¯å¤±è´¥ï¼š{r.text}")
+                    except requests.exceptions.ConnectionError:
+                        st.error("âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨ã€‚è¯·ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œã€‚")
+                    except requests.exceptions.Timeout:
+                        st.error("âŒ è¯·æ±‚è¶…æ—¶ï¼ŒAI å“åº”æ—¶é—´è¾ƒé•¿ï¼Œè¯·ç¨åé‡è¯•")
+                    except Exception as e:
+                        st.error(f"âŒ å‘é€æ¶ˆæ¯å¤±è´¥ï¼š{str(e)}")
 
+    # ==================== åŒ»ç”Ÿç•Œé¢ ====================
     elif st.session_state.role == "doctor":
         st.markdown("""
         <div class="custom-card">
             <div class="card-header">
                 <div class="card-icon icon-orange">ğŸ‘¨â€âš•ï¸</div>
-                <h3 class="card-title">Doctor Dashboard</h3>
+                <h3 class="card-title">åŒ»ç”Ÿå·¥ä½œå°</h3>
             </div>
         </div>
         """, unsafe_allow_html=True)
         
-        # Fetch all patients
+        # è·å–æ‰€æœ‰æ‚£è€…
         try:
-            patients_response = requests.get(f"{API}/doctor/patients", params={"token": st.session_state.token})
+            patients_response = requests.get(f"{API}/doctor/patients", params={"token": st.session_state.token}, timeout=5)
             if patients_response.ok:
                 patients_data = patients_response.json()
                 all_patients = patients_data.get("patients", [])
             else:
                 all_patients = []
+        except requests.exceptions.ConnectionError:
+            all_patients = []
+            st.error("âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨ã€‚è¯·ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œã€‚")
+        except requests.exceptions.Timeout:
+            all_patients = []
+            st.error("âŒ è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•")
         except Exception as e:
             all_patients = []
-            st.error(f"Error fetching patients: {e}")
+            st.error(f"âŒ è·å–æ‚£è€…åˆ—è¡¨å¤±è´¥ï¼š{str(e)}")
         
-        st.markdown("<h3 style='color: #f1f5f9;'>Select Patient to Manage</h3>", unsafe_allow_html=True)
+        st.markdown("<h3 style='color: #f1f5f9;'>é€‰æ‹©è¦ç®¡ç†çš„æ‚£è€…</h3>", unsafe_allow_html=True)
         
         if all_patients:
-            patient_options = ["-- Select a patient --"] + [f"{p['full_name']} ({p['username']})" for p in all_patients]
+            patient_options = ["-- è¯·é€‰æ‹©æ‚£è€… --"] + [f"{p['full_name']} ({p['username']})" for p in all_patients]
             patient_usernames = {f"{p['full_name']} ({p['username']})": p['username'] for p in all_patients}
             
             selected_patient = st.selectbox(
-                "Choose from registered patients:",
+                "ä»å·²æ³¨å†Œæ‚£è€…ä¸­é€‰æ‹©ï¼š",
                 options=patient_options,
                 index=0,
                 key="patient_selector"
             )
             
-            if selected_patient != "-- Select a patient --":
+            if selected_patient != "-- è¯·é€‰æ‹©æ‚£è€… --":
                 selected_username = patient_usernames[selected_patient]
-                if st.button("âœ… Select This Patient", use_container_width=True):
+                if st.button("âœ… é€‰æ‹©æ­¤æ‚£è€…", use_container_width=True):
                     st.session_state.patient_username = selected_username
-                    st.success(f"âœ… Now managing: **{selected_patient}**")
+                    st.success(f"âœ… æ­£åœ¨ç®¡ç†ï¼š**{selected_patient}**")
                     st.rerun()
         else:
-            st.warning("âš ï¸ No patients found in the system. Patients need to sign up first.")
-            st.info("ğŸ’¡ Tip: You can still manually enter a username if you know it.")
+            st.warning("âš ï¸ ç³»ç»Ÿä¸­æ²¡æœ‰æ‰¾åˆ°æ‚£è€…ã€‚æ‚£è€…éœ€è¦å…ˆæ³¨å†Œã€‚")
+            st.info("ğŸ’¡ æç¤ºï¼šå¦‚æœæ‚¨çŸ¥é“ç”¨æˆ·åï¼Œä»ç„¶å¯ä»¥æ‰‹åŠ¨è¾“å…¥ã€‚")
         
-        with st.expander("ğŸ” Or manually enter patient username"):
-            manual_username = st.text_input("Patient username", placeholder="Enter patient username manually")
-            if st.button("âœ… Select Manually"):
+        with st.expander("ğŸ” æˆ–æ‰‹åŠ¨è¾“å…¥æ‚£è€…ç”¨æˆ·å"):
+            manual_username = st.text_input("æ‚£è€…ç”¨æˆ·å", placeholder="è¯·æ‰‹åŠ¨è¾“å…¥æ‚£è€…ç”¨æˆ·å")
+            if st.button("âœ… æ‰‹åŠ¨é€‰æ‹©"):
                 if manual_username:
                     st.session_state.patient_username = manual_username
-                    st.success(f"âœ… Now managing: **{manual_username}**")
+                    st.success(f"âœ… æ­£åœ¨ç®¡ç†ï¼š**{manual_username}**")
                     st.rerun()
                 else:
-                    st.error("Please enter a username")
+                    st.error("è¯·è¾“å…¥ç”¨æˆ·å")
         
         if st.session_state.patient_username:
             st.markdown(f"""
             <div class="info-box">
-                <div class="info-title">Currently Managing</div>
-                <div class="info-text">Patient: <strong>{st.session_state.patient_username}</strong></div>
+                <div class="info-title">å½“å‰ç®¡ç†</div>
+                <div class="info-text">æ‚£è€…ï¼š<strong>{st.session_state.patient_username}</strong></div>
             </div>
             """, unsafe_allow_html=True)
             
@@ -730,143 +859,159 @@ else:
                 <div class="custom-card">
                     <div class="card-header">
                         <div class="card-icon icon-green">ğŸ¯</div>
-                        <h3 class="card-title">Manage Goals</h3>
+                        <h3 class="card-title">ç®¡ç†ç›®æ ‡</h3>
                     </div>
                 </div>
                 """, unsafe_allow_html=True)
 
-                # Fetch patient goals
+                # è·å–æ‚£è€…ç›®æ ‡
                 try:
                     goals_response = requests.get(
                         f"{API}/doctor/patient-goals",
                         params={
                             "patient_username": st.session_state.patient_username,
                             "token": st.session_state.token
-                        }
+                        },
+                        timeout=5
                     )
                     if goals_response.ok:
                         patient_goals = goals_response.json().get("goals", [])
                     else:
                         patient_goals = []
+                except requests.exceptions.ConnectionError:
+                    patient_goals = []
+                    st.error("âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨")
                 except Exception as e:
                     patient_goals = []
-                    st.error(f"Error fetching goals: {e}")
+                    st.error(f"âŒ è·å–ç›®æ ‡å¤±è´¥ï¼š{str(e)}")
 
-                # Show goal status tabs
-                goal_tab1, goal_tab2 = st.tabs(["ğŸ“ Assign New Goal", "ğŸ“Š Goal Status"])
+                # æ˜¾ç¤ºç›®æ ‡çŠ¶æ€æ ‡ç­¾é¡µ
+                goal_tab1, goal_tab2 = st.tabs(["ğŸ“ åˆ†é…æ–°ç›®æ ‡", "ğŸ“Š ç›®æ ‡çŠ¶æ€"])
 
                 with goal_tab1:
                     with st.form("add_goal"):
-                        goal_text = st.text_area("Goal description", placeholder="e.g., Go for a short walk after dinner", height=100)
-                        ok = st.form_submit_button("â• Assign Goal", use_container_width=True)
+                        goal_text = st.text_area("ç›®æ ‡æè¿°", placeholder="ä¾‹å¦‚ï¼šæ™šé¥­åæ•£æ­¥ 10 åˆ†é’Ÿ", height=100)
+                        ok = st.form_submit_button("â• åˆ†é…ç›®æ ‡", use_container_width=True)
                         if ok and goal_text:
-                            r = requests.post(
-                                f"{API}/doctor/goals",
-                                params={
-                                    "patient_username": st.session_state.patient_username,
-                                    "token": st.session_state.token,
-                                },
-                                json={"text": goal_text},
-                            )
-                            if r.ok:
-                                st.success("ğŸ¯ Goal assigned successfully!")
-                                st.rerun()
-                            else:
-                                st.error(f"âŒ {r.text}")
+                            try:
+                                r = requests.post(
+                                    f"{API}/doctor/goals",
+                                    params={
+                                        "patient_username": st.session_state.patient_username,
+                                        "token": st.session_state.token,
+                                    },
+                                    json={"text": goal_text},
+                                    timeout=5
+                                )
+                                if r.ok:
+                                    st.success("ğŸ¯ ç›®æ ‡åˆ†é…æˆåŠŸï¼")
+                                    st.rerun()
+                                else:
+                                    st.error(f"âŒ {r.text}")
+                            except requests.exceptions.ConnectionError:
+                                st.error("âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨")
+                            except Exception as e:
+                                st.error(f"âŒ åˆ†é…ç›®æ ‡å¤±è´¥ï¼š{str(e)}")
 
                 with goal_tab2:
                     if patient_goals:
                         active_goals = [g for g in patient_goals if not g['completed']]
                         completed_goals = [g for g in patient_goals if g['completed']]
                         
-                        # Show active goals
-                        st.markdown("<h4 style='color: #10b981;'>âœ… Active Goals</h4>", unsafe_allow_html=True)
+                        # æ˜¾ç¤ºæ´»è·ƒç›®æ ‡
+                        st.markdown("<h4 style='color: #10b981;'>âœ… æ´»è·ƒç›®æ ‡</h4>", unsafe_allow_html=True)
                         if active_goals:
                             for g in active_goals:
                                 st.markdown(f"""
                                 <div class="goal-item">
                                     <span style="font-size: 1.5rem;">â­•</span>
                                     <span style="flex: 1; color: white; font-weight: 600;">{g['text']}</span>
-                                    <span style="color: #e9d5ff; font-size: 0.9rem;">Assigned: {g['created_at'][:10]}</span>
+                                    <span style="color: #e9d5ff; font-size: 0.9rem;">åˆ†é…æ—¶é—´ï¼š{g['created_at'][:10]}</span>
                                 </div>
                                 """, unsafe_allow_html=True)
                         else:
-                            st.info("No active goals assigned yet.")
+                            st.info("è¿˜æ²¡æœ‰åˆ†é…æ´»è·ƒç›®æ ‡ã€‚")
                         
                         st.markdown("---")
                         
-                        # Show completed goals
-                        st.markdown("<h4 style='color: #6b7280;'>ğŸ‰ Completed Goals</h4>", unsafe_allow_html=True)
+                        # æ˜¾ç¤ºå·²å®Œæˆç›®æ ‡
+                        st.markdown("<h4 style='color: #6b7280;'>ğŸ‰ å·²å®Œæˆç›®æ ‡</h4>", unsafe_allow_html=True)
                         if completed_goals:
                             for g in completed_goals:
-                                completed_date = g.get('completed_at_str', g.get('completed_at', 'Unknown')[:10] if g.get('completed_at') else 'Unknown')
+                                completed_date = g.get('completed_at_str', g.get('completed_at', 'æœªçŸ¥')[:10] if g.get('completed_at') else 'æœªçŸ¥')
                                 st.markdown(f"""
                                 <div class="goal-item goal-completed">
                                     <span style="font-size: 1.5rem;">âœ…</span>
                                     <span style="flex: 1; color: white; font-weight: 600;">{g['text']}</span>
-                                    <span style="color: #d1d5db; font-size: 0.9rem;">Completed: {completed_date}</span>
+                                    <span style="color: #d1d5db; font-size: 0.9rem;">å®Œæˆæ—¶é—´ï¼š{completed_date}</span>
                                 </div>
                                 """, unsafe_allow_html=True)
                         else:
-                            st.info("No completed goals yet.")
+                            st.info("è¿˜æ²¡æœ‰å®Œæˆçš„ç›®æ ‡ã€‚")
                         
-                        # Summary statistics
+                        # ç»Ÿè®¡æ‘˜è¦
                         total_goals = len(patient_goals)
                         completion_rate = (len(completed_goals) / total_goals * 100) if total_goals > 0 else 0
                         
                         st.markdown(f"""
                         <div class="info-box" style="margin-top: 1rem;">
-                            <div class="info-title">ğŸ“ˆ Goal Progress Summary</div>
+                            <div class="info-title">ğŸ“ˆ ç›®æ ‡è¿›åº¦æ‘˜è¦</div>
                             <div class="info-text">
-                                Total Goals: <strong>{total_goals}</strong> | 
-                                Active: <strong>{len(active_goals)}</strong> | 
-                                Completed: <strong>{len(completed_goals)}</strong> | 
-                                Completion Rate: <strong>{completion_rate:.1f}%</strong>
+                                æ€»ç›®æ ‡æ•°ï¼š<strong>{total_goals}</strong> | 
+                                æ´»è·ƒï¼š<strong>{len(active_goals)}</strong> | 
+                                å·²å®Œæˆï¼š<strong>{len(completed_goals)}</strong> | 
+                                å®Œæˆç‡ï¼š<strong>{completion_rate:.1f}%</strong>
                             </div>
                         </div>
                         """, unsafe_allow_html=True)
                     else:
-                        st.info("No goals assigned yet. Use the 'Assign New Goal' tab to create one.")
+                        st.info("è¿˜æ²¡æœ‰åˆ†é…ç›®æ ‡ã€‚è¯·ä½¿ç”¨'åˆ†é…æ–°ç›®æ ‡'æ ‡ç­¾é¡µåˆ›å»ºä¸€ä¸ªã€‚")
             
             with col2:
                 st.markdown("""
                 <div class="custom-card">
                     <div class="card-header">
                         <div class="card-icon icon-blue">ğŸ’Š</div>
-                        <h3 class="card-title">Add Medication</h3>
+                        <h3 class="card-title">æ·»åŠ è¯ç‰©</h3>
                     </div>
                 </div>
                 """, unsafe_allow_html=True)
                 
                 with st.form("add_med"):
-                    name = st.text_input("Medication name", placeholder="e.g., Aspirin")
-                    tpd = st.number_input("Times per day", min_value=1, max_value=6, value=3)
-                    times = st.text_input("Specific times (HH:MM)", value="09:00,14:00,20:00")
-                    instr = st.text_area("Instructions", value="Take with water.", height=80)
-                    ok = st.form_submit_button("â• Add Medication", use_container_width=True)
+                    name = st.text_input("è¯ç‰©åç§°", placeholder="ä¾‹å¦‚ï¼šé˜¿å¸åŒ¹æ—")
+                    tpd = st.number_input("æ¯å¤©æ¬¡æ•°", min_value=1, max_value=6, value=3)
+                    times = st.text_input("å…·ä½“æ—¶é—´ (æ—¶:åˆ†)", value="09:00,14:00,20:00")
+                    instr = st.text_area("æœç”¨è¯´æ˜", value="ä¸å¤§é‡æ°´ä¸€èµ·æœç”¨ã€‚", height=80)
+                    ok = st.form_submit_button("â• æ·»åŠ è¯ç‰©", use_container_width=True)
                     if ok and name:
-                        r = requests.post(
-                            f"{API}/doctor/medications",
-                            params={"token": st.session_state.token},
-                            json={
-                                "patient_username": st.session_state.patient_username,
-                                "name": name,
-                                "times_per_day": int(tpd),
-                                "specific_times": times.strip(),
-                                "instructions": instr,
-                                "active": True,
-                            },
-                        )
-                        if r.ok:
-                            st.success("ğŸ’Š Medication added successfully!")
-                        else:
-                            st.error(f"âŒ {r.text}")
+                        try:
+                            r = requests.post(
+                                f"{API}/doctor/medications",
+                                params={"token": st.session_state.token},
+                                json={
+                                    "patient_username": st.session_state.patient_username,
+                                    "name": name,
+                                    "times_per_day": int(tpd),
+                                    "specific_times": times.strip(),
+                                    "instructions": instr,
+                                    "active": True,
+                                },
+                                timeout=5
+                            )
+                            if r.ok:
+                                st.success("ğŸ’Š è¯ç‰©æ·»åŠ æˆåŠŸï¼")
+                            else:
+                                st.error(f"âŒ {r.text}")
+                        except requests.exceptions.ConnectionError:
+                            st.error("âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨")
+                        except Exception as e:
+                            st.error(f"âŒ æ·»åŠ è¯ç‰©å¤±è´¥ï¼š{str(e)}")
                 
                 st.markdown("""
                 <div class="custom-card">
                     <div class="card-header">
                         <div class="card-icon icon-blue">ğŸ“Š</div>
-                        <h3 class="card-title">Medication Status</h3>
+                        <h3 class="card-title">è¯ç‰©çŠ¶æ€</h3>
                     </div>
                 </div>
                 """, unsafe_allow_html=True)
@@ -874,37 +1019,42 @@ else:
                 try:
                     med_hist_resp = requests.get(
                         f"{API}/doctor/patient-medications",
-                        params={"patient_username": st.session_state.patient_username, "token": st.session_state.token}
+                        params={"patient_username": st.session_state.patient_username, "token": st.session_state.token},
+                        timeout=5
                     )
                     if med_hist_resp.ok:
                         meds = med_hist_resp.json().get("medications", [])
                         if meds:
                             for m in meds:
-                                st.markdown(f"**{m['name']}** â€” {m['times_per_day']}x/day | {m['specific_times']}")
+                                st.markdown(f"**{m['name']}** â€” æ¯å¤© {m['times_per_day']} æ¬¡ | {m['specific_times']}")
                                 st.caption(f"ğŸ“ {m['instructions'] or ''}")
 
                                 logs = m.get('logs', [])
                                 recent_logs = [l for l in logs if l['date'] == datetime.now().strftime("%Y-%m-%d")]
                                 taken_today = sum(1 for l in recent_logs if l['taken'])
                                 st.progress(taken_today / m['times_per_day'])
-                                st.caption(f"Taken {taken_today}/{m['times_per_day']} times today")
+                                st.caption(f"ä»Šå¤©å·²æœç”¨ {taken_today}/{m['times_per_day']} æ¬¡")
 
-                                with st.expander("ğŸ“… View History"):
+                                with st.expander("ğŸ“… æŸ¥çœ‹å†å²è®°å½•"):
                                     for l in logs[-10:]:
                                         st.write(f"{l['date']} â€” {'âœ…' if l['taken'] else 'âŒ'} {l.get('time_taken', '')}")
                         else:
-                            st.info("No medications found for this patient.")
+                            st.info("è¯¥æ‚£è€…æ²¡æœ‰æ‰¾åˆ°è¯ç‰©ã€‚")
                     else:
-                        st.error("Failed to fetch medication history.")
+                        st.error("è·å–è¯ç‰©å†å²è®°å½•å¤±è´¥ã€‚")
+                except requests.exceptions.ConnectionError:
+                    st.error("âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨")
+                except requests.exceptions.Timeout:
+                    st.error("âŒ è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•")
                 except Exception as e:
-                    st.error(f"Error: {e}")
+                    st.error(f"âŒ é”™è¯¯ï¼š{str(e)}")
 
 
         else:
             st.markdown("""
             <div style="text-align: center; padding: 3rem; background: rgba(30, 27, 75, 0.6); border-radius: 20px; border: 2px solid rgba(147, 51, 234, 0.3); margin-top: 2rem;">
                 <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ¥</div>
-                <h3 style="color: #f1f5f9;">Select a Patient to Begin</h3>
-                <p style="color: #cbd5e1;">Choose a patient from the dropdown above to manage their care</p>
+                <h3 style="color: #f1f5f9;">è¯·é€‰æ‹©æ‚£è€…å¼€å§‹</h3>
+                <p style="color: #cbd5e1;">è¯·ä»ä¸Šæ–¹ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©ä¸€ä¸ªæ‚£è€…æ¥ç®¡ç†ä»–ä»¬çš„æŠ¤ç†</p>
             </div>
-            """, unsafe_allow_html=True)
\ No newline at end of file
+            """, unsafe_allow_html=True)
diff --git a/utils/auth.py b/utils/auth.py
index 0d850e0..ba5bc1e 100644
--- a/utils/auth.py
+++ b/utils/auth.py
@@ -1,27 +1,122 @@
 # memorycare_app/utils/auth.py
+"""
+è®¤è¯å’Œæˆæƒæ¨¡å—
+
+æœ¬æ¨¡å—å®ç°äº†ç®€å•çš„åŸºäº Token çš„èº«ä»½éªŒè¯ç³»ç»Ÿã€‚
+æ”¯æŒåŒ»ç”Ÿå’Œæ‚£è€…ä¸¤ç§è§’è‰²ï¼Œä½¿ç”¨å†…å­˜å­˜å‚¨ Tokenï¼ˆç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨ Redis æˆ–æ•°æ®åº“ï¼‰ã€‚
+
+æ³¨æ„ï¼šè¿™æ˜¯ç®€åŒ–ç‰ˆå®ç°ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦ï¼š
+1. ä½¿ç”¨ JWT æˆ– OAuth2
+2. å¯†ç å“ˆå¸ŒåŠ å¯†ï¼ˆbcrypt/argon2ï¼‰
+3. Token æŒä¹…åŒ–å­˜å‚¨
+4. åˆ·æ–° Token æœºåˆ¶
+"""
+
 from typing import Optional
 from datetime import datetime, timedelta
 import secrets
 
+# Token å­˜å‚¨å­—å…¸ï¼šå†…å­˜ä¸­çš„ä¸´æ—¶å­˜å‚¨
+# é”®ï¼šToken å­—ç¬¦ä¸²
+# å€¼ï¼šåŒ…å«è§’è‰²ã€ç”¨æˆ·åå’Œè¿‡æœŸæ—¶é—´çš„å­—å…¸
+# æ³¨æ„ï¼šæœåŠ¡å™¨é‡å¯åæ‰€æœ‰ Token ä¼šå¤±æ•ˆ
 _tokens = {}  # token -> {"role": "doctor"|"patient", "username": str, "expires": datetime}
 
+
 def issue_doctor_token(username: str, password: str) -> Optional[str]:
+    """
+    ä¸ºåŒ»ç”Ÿç”¨æˆ·é¢å‘è®¤è¯ Token
+    
+    å‚æ•°:
+        username: åŒ»ç”Ÿç”¨æˆ·å
+        password: åŒ»ç”Ÿå¯†ç 
+        
+    è¿”å›:
+        Optional[str]: å¦‚æœè®¤è¯æˆåŠŸè¿”å› Token å­—ç¬¦ä¸²ï¼Œå¦åˆ™è¿”å› None
+        
+    æ³¨æ„:
+        - å½“å‰å®ç°ä½¿ç”¨ç¡¬ç¼–ç çš„å‡­è¯ï¼ˆdoctor/doctorï¼‰
+        - ç”Ÿäº§ç¯å¢ƒåº”ä»æ•°æ®åº“éªŒè¯å¹¶è¿”å›é”™è¯¯ä¿¡æ¯
+    """
+    # éªŒè¯åŒ»ç”Ÿå‡­è¯ï¼šå½“å‰ä½¿ç”¨ç¡¬ç¼–ç éªŒè¯
+    # ç”Ÿäº§ç¯å¢ƒåº”è¯¥ä»æ•°æ®åº“æŸ¥è¯¢å¹¶éªŒè¯å¯†ç å“ˆå¸Œ
     if username == "doctor" and password == "doctor":
+        # ç”Ÿæˆå®‰å…¨çš„éšæœº Tokenï¼šä½¿ç”¨ secrets æ¨¡å—ç”Ÿæˆ URL å®‰å…¨çš„éšæœºå­—ç¬¦ä¸²
         token = "doc_" + secrets.token_urlsafe(16)
-        _tokens[token] = {"role": "doctor", "username": "doctor", "expires": datetime.utcnow() + timedelta(hours=8)}
+        print(f"[DEBUG] Issued doctor token: {token}")
+        
+        # å­˜å‚¨ Token ä¿¡æ¯ï¼šåŒ…æ‹¬è§’è‰²ã€ç”¨æˆ·åå’Œè¿‡æœŸæ—¶é—´ï¼ˆ8å°æ—¶åï¼‰
+        _tokens[token] = {
+            "role": "doctor",
+            "username": "doctor",
+            "expires": datetime.utcnow() + timedelta(hours=8)  # Token æœ‰æ•ˆæœŸ 8 å°æ—¶
+        }
         return token
+    
+    # è®¤è¯å¤±è´¥è¿”å› None
     return None
 
+
 def issue_patient_token(username: str) -> str:
+    """
+    ä¸ºæ‚£è€…ç”¨æˆ·é¢å‘è®¤è¯ Token
+    
+    å‚æ•°:
+        username: æ‚£è€…ç”¨æˆ·åï¼ˆå·²é€šè¿‡ç™»å½•éªŒè¯ï¼‰
+        
+    è¿”å›:
+        str: æ‚£è€… Token å­—ç¬¦ä¸²
+        
+    æ³¨æ„:
+        - æ­¤å‡½æ•°å‡è®¾ç”¨æˆ·åå·²ç»é€šè¿‡å¯†ç éªŒè¯
+        - è°ƒç”¨æ­¤å‡½æ•°å‰åº”ç¡®ä¿æ‚£è€…å­˜åœ¨ä¸”å¯†ç æ­£ç¡®
+    """
+    # ç”Ÿæˆå®‰å…¨çš„éšæœº Tokenï¼šä½¿ç”¨ secrets æ¨¡å—ç”Ÿæˆ URL å®‰å…¨çš„éšæœºå­—ç¬¦ä¸²
     token = "pat_" + secrets.token_urlsafe(16)
-    _tokens[token] = {"role": "patient", "username": username, "expires": datetime.utcnow() + timedelta(hours=8)}
+    print(f"[DEBUG] Issued patient token: {token}")
+    
+    # å­˜å‚¨ Token ä¿¡æ¯ï¼šåŒ…æ‹¬è§’è‰²ã€ç”¨æˆ·åå’Œè¿‡æœŸæ—¶é—´ï¼ˆ8å°æ—¶åï¼‰
+    _tokens[token] = {
+        "role": "patient",
+        "username": username,
+        "expires": datetime.utcnow() + timedelta(hours=8)  # Token æœ‰æ•ˆæœŸ 8 å°æ—¶
+    }
     return token
 
+
 def whoami(token: str) -> Optional[dict]:
+    """
+    æ ¹æ® Token è·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯
+    
+    å‚æ•°:
+        token: ç”¨æˆ·æä¾›çš„è®¤è¯ Token
+        
+    è¿”å›:
+        Optional[dict]: å¦‚æœ Token æœ‰æ•ˆï¼Œè¿”å›åŒ…å«è§’è‰²å’Œç”¨æˆ·åçš„å­—å…¸ï¼š
+            {
+                "role": "doctor" | "patient",
+                "username": str,
+                "expires": datetime
+            }
+            å¦‚æœ Token æ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œè¿”å› None
+            
+    ä½¿ç”¨åœºæ™¯:
+        - API ç«¯ç‚¹éªŒè¯ç”¨æˆ·èº«ä»½
+        - æ£€æŸ¥ç”¨æˆ·æƒé™ï¼ˆåŒ»ç”Ÿ vs æ‚£è€…ï¼‰
+        - è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯
+    """
+    # ä» Token å­˜å‚¨ä¸­æŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯
     info = _tokens.get(token)
+    
+    # å¦‚æœ Token ä¸å­˜åœ¨ï¼Œè¿”å› None
     if not info:
         return None
+    
+    # æ£€æŸ¥ Token æ˜¯å¦å·²è¿‡æœŸ
     if info["expires"] < datetime.utcnow():
+        # Token å·²è¿‡æœŸï¼Œä»å­˜å‚¨ä¸­åˆ é™¤å¹¶è¿”å› None
         del _tokens[token]
         return None
+    
+    # Token æœ‰æ•ˆï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯
     return info
diff --git a/utils/db.py b/utils/db.py
index c90a7fc..13947f4 100644
--- a/utils/db.py
+++ b/utils/db.py
@@ -1,12 +1,52 @@
 # memorycare_app/utils/db.py
+"""
+æ•°æ®åº“è¿æ¥å’Œåˆå§‹åŒ–æ¨¡å—
+
+æœ¬æ¨¡å—è´Ÿè´£æ•°æ®åº“å¼•æ“çš„åˆ›å»ºã€ä¼šè¯ç®¡ç†å’Œè¡¨ç»“æ„çš„åˆå§‹åŒ–ã€‚
+ä½¿ç”¨ SQLite ä½œä¸ºæ•°æ®åº“ï¼ŒSQLModel ä½œä¸º ORM æ¡†æ¶ã€‚
+"""
+
 from sqlmodel import SQLModel, create_engine, Session
 
+# æ•°æ®åº“è¿æ¥ URLï¼šä½¿ç”¨ SQLite æ•°æ®åº“ï¼Œæ–‡ä»¶åä¸º app.db
+# SQLite æ˜¯è½»é‡çº§åµŒå…¥å¼æ•°æ®åº“ï¼Œé€‚åˆå•æœºåº”ç”¨
 DB_URL = "sqlite:///app.db"
+
+# åˆ›å»ºæ•°æ®åº“å¼•æ“ï¼šç”¨äºè¿æ¥æ•°æ®åº“å’Œæ‰§è¡Œ SQL æ“ä½œ
+# echo=False è¡¨ç¤ºä¸åœ¨æ§åˆ¶å°è¾“å‡º SQL è¯­å¥ï¼ˆè®¾ä¸º True å¯ç”¨äºè°ƒè¯•ï¼‰
 engine = create_engine(DB_URL, echo=False)
 
+
 def get_session() -> Session:
+    """
+    è·å–æ•°æ®åº“ä¼šè¯å¯¹è±¡
+    
+    è¿”å›:
+        Session: SQLModel ä¼šè¯å¯¹è±¡ï¼Œç”¨äºæ‰§è¡Œæ•°æ®åº“æ“ä½œ
+        
+    ä½¿ç”¨ç¤ºä¾‹:
+        with get_session() as session:
+            patient = session.get(Patient, patient_id)
+    """
     return Session(engine)
 
+
 def create_db_and_tables():
+    """
+    åˆ›å»ºæ•°æ®åº“å’Œæ‰€æœ‰è¡¨ç»“æ„
+    
+    æ­¤å‡½æ•°ä¼šæ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºã€‚
+    ç„¶åæ ¹æ®æ¨¡å‹ä¸­å®šä¹‰çš„è¡¨ç»“æ„åˆ›å»ºæ‰€æœ‰æ•°æ®è¡¨ã€‚
+    
+    æ³¨æ„ï¼š
+        - æ­¤å‡½æ•°åº”è¯¥åœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨ä¸€æ¬¡
+        - å¦‚æœè¡¨å·²å­˜åœ¨ï¼Œä¸ä¼šé‡å¤åˆ›å»º
+        - ä¸ä¼šåˆ é™¤æˆ–ä¿®æ”¹ç°æœ‰è¡¨ç»“æ„ï¼ˆéœ€è¦æ‰‹åŠ¨è¿ç§»ï¼‰
+    """
+    # å¯¼å…¥æ‰€æœ‰æ¨¡å‹ç±»ï¼Œç¡®ä¿ SQLModel èƒ½å¤Ÿè¯†åˆ«æ‰€æœ‰è¡¨å®šä¹‰
+    # å»¶è¿Ÿå¯¼å…¥é¿å…å¾ªç¯ä¾èµ–
     from .models import Patient, Medication, Goal, MedicationLog
-    SQLModel.metadata.create_all(engine)
\ No newline at end of file
+    
+    # æ ¹æ®æ‰€æœ‰å·²æ³¨å†Œçš„ SQLModel ç±»åˆ›å»ºå¯¹åº”çš„æ•°æ®è¡¨
+    # å¦‚æœè¡¨å·²å­˜åœ¨ï¼Œæ­¤æ“ä½œä¸ä¼šæŠ¥é”™
+    SQLModel.metadata.create_all(engine)
diff --git a/utils/llm_client.py b/utils/llm_client.py
index 3044848..b90b40a 100644
--- a/utils/llm_client.py
+++ b/utils/llm_client.py
@@ -1,33 +1,223 @@
 # memorycare_app/utils/llm_client.py
-import os, requests
+"""
+OpenAI LLM å®¢æˆ·ç«¯æ¨¡å—
 
-OPENAI_API_KEY = os.getenv("OPENAI_API_KEY", "INSERT API KEY"
-                           )
+æœ¬æ¨¡å—å°è£…äº†ä¸ OpenAI API çš„äº¤äº’ï¼Œæä¾›ç»Ÿä¸€çš„èŠå¤©æ¥å£ã€‚
+æ”¯æŒæ¨¡å‹å›é€€æœºåˆ¶ï¼Œå¦‚æœé¦–é€‰æ¨¡å‹ä¸å¯ç”¨ï¼Œä¼šè‡ªåŠ¨å°è¯•å¤‡ç”¨æ¨¡å‹ã€‚
+"""
+
+import os
+import requests
+import logging
+
+# é…ç½®æ—¥å¿—è®°å½•å™¨
+logger = logging.getLogger(__name__)
+# åªåœ¨æ ¹æ—¥å¿—è®°å½•å™¨æœªé…ç½®æ—¶æ‰é…ç½®
+if not logging.root.handlers:
+    logging.basicConfig(
+        level=logging.DEBUG,
+        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
+    )
+
+# ç¡®ä¿åŠ è½½ .env æ–‡ä»¶ï¼ˆå¦‚æœè¿˜æ²¡æœ‰åŠ è½½ï¼‰
+# è¿™å¾ˆé‡è¦ï¼Œå› ä¸ºæ¨¡å—çº§åˆ«çš„ç¯å¢ƒå˜é‡è¯»å–å¯èƒ½åœ¨ load_dotenv() ä¹‹å‰æ‰§è¡Œ
+_dotenv_loaded = False
+try:
+    # å°è¯•å¯¼å…¥ load_dotenv å‡½æ•°
+    from dotenv import load_dotenv  # type: ignore
+    # è°ƒç”¨ load_dotenv() åŠ è½½ .env æ–‡ä»¶
+    # override=False è¡¨ç¤ºå¦‚æœç¯å¢ƒå˜é‡å·²å­˜åœ¨ï¼Œåˆ™ä¸è¦†ç›–å®ƒä»¬
+    load_dotenv(override=False)
+    _dotenv_loaded = True
+    logger.debug("âœ… å·²åŠ è½½ .env æ–‡ä»¶")
+except ImportError as e:
+    # python-dotenv æœªå®‰è£…ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼ˆå¦‚æœ api/main.py ä¸­å·²ç»åŠ è½½äº†ï¼‰
+    logger.debug(f"dotenv æ¨¡å—æœªæ‰¾åˆ°ï¼ˆå¯èƒ½å·²åœ¨å…¶ä»–åœ°æ–¹åŠ è½½ï¼‰: {e}")
+except Exception as e:
+    logger.warning(f"âš ï¸ åŠ è½½ .env æ–‡ä»¶æ—¶å‡ºé”™ï¼š{type(e).__name__}: {e}")
+    import traceback
+    logger.debug(traceback.format_exc())
+
+# ä»ç¯å¢ƒå˜é‡è·å– OpenAI API å¯†é’¥
+# å¦‚æœæœªè®¾ç½®ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼ï¼ˆä¼šå¯¼è‡´ API è°ƒç”¨å¤±è´¥ï¼‰
+OPENAI_API_KEY = os.getenv("OPENAI_API_KEY", "INSERT API KEY")
+
+# è°ƒè¯•æ—¥å¿—ï¼šè®°å½• API Key çš„åŠ è½½çŠ¶æ€ï¼ˆåªæ˜¾ç¤ºå‰å‡ ä¸ªå­—ç¬¦ä»¥ä¿æŠ¤éšç§ï¼‰
+if OPENAI_API_KEY and OPENAI_API_KEY != "INSERT API KEY":
+    api_key_preview = OPENAI_API_KEY[:8] + "..." if len(OPENAI_API_KEY) > 8 else "***"
+    logger.info(f"âœ… OPENAI_API_KEY å·²åŠ è½½ï¼ˆé¢„è§ˆï¼š{api_key_preview}ï¼‰")
+else:
+    logger.error("âŒ OPENAI_API_KEY æœªè®¾ç½®æˆ–ä½¿ç”¨é»˜è®¤å€¼")
+
+# OpenAI API åŸºç¡€ URLï¼šé»˜è®¤ä¸ºå®˜æ–¹ API åœ°å€
+# å¯ä»¥è®¾ç½®ä¸ºè‡ªå®šä¹‰ä»£ç†æˆ–å…¼å®¹ OpenAI API çš„æœåŠ¡
 OPENAI_BASE = os.getenv("OPENAI_BASE_URL", "https://api.openai.com/v1")
-# choose a model you have access to in your org/project
+
+# è°ƒè¯•æ—¥å¿—ï¼šè®°å½• Base URL
+logger.info(f"ğŸ“¡ OPENAI_BASE_URL = {OPENAI_BASE}")
+
+# é¦–é€‰æ¨¡å‹ï¼šä»ç¯å¢ƒå˜é‡è¯»å–ï¼Œå¦‚æœæœªè®¾ç½®åˆ™ä¸ºç©ºå­—ç¬¦ä¸²
+# ç”¨æˆ·å¯ä»¥åœ¨ .env æ–‡ä»¶ä¸­è®¾ç½® OPENAI_MODEL æ¥æŒ‡å®šé¦–é€‰æ¨¡å‹
 PREFERRED = os.getenv("OPENAI_MODEL", "").strip()
-FALLBACKS = [m for m in [PREFERRED, "gpt-4.1-mini"] if m]
+
+# è°ƒè¯•æ—¥å¿—ï¼šè®°å½•æ¨¡å‹é…ç½®
+if PREFERRED:
+    logger.info(f"ğŸ¯ é¦–é€‰æ¨¡å‹ OPENAI_MODEL = '{PREFERRED}'")
+else:
+    logger.warning("âš ï¸ OPENAI_MODEL æœªè®¾ç½®ï¼Œå°†ä½¿ç”¨å¤‡ç”¨æ¨¡å‹")
+
+# æ¨¡å‹å›é€€åˆ—è¡¨ï¼šåŒ…å«é¦–é€‰æ¨¡å‹å’Œå¤‡ç”¨æ¨¡å‹
+# å¦‚æœé¦–é€‰æ¨¡å‹ä¸å¯ç”¨ï¼Œä¼šä¾æ¬¡å°è¯•åˆ—è¡¨ä¸­çš„å…¶ä»–æ¨¡å‹
+# è¿‡æ»¤æ‰ç©ºå­—ç¬¦ä¸²ï¼Œç¡®ä¿åˆ—è¡¨ä¸­åªåŒ…å«æœ‰æ•ˆçš„æ¨¡å‹å
+FALLBACKS = [m for m in [PREFERRED, "qwen-max"] if m]
+
+# è°ƒè¯•æ—¥å¿—ï¼šè®°å½•æœ€ç»ˆçš„æ¨¡å‹åˆ—è¡¨
+logger.info(f"ğŸ“‹ æ¨¡å‹å›é€€åˆ—è¡¨ï¼š{FALLBACKS}")
+
+# æ£€æŸ¥æ‰€æœ‰ç¯å¢ƒå˜é‡
+logger.debug("=" * 60)
+logger.debug("ç¯å¢ƒå˜é‡æ£€æŸ¥ï¼š")
+logger.debug(f"  OPENAI_API_KEY: {'å·²è®¾ç½®' if OPENAI_API_KEY and OPENAI_API_KEY != 'INSERT API KEY' else 'æœªè®¾ç½®'}")
+logger.debug(f"  OPENAI_BASE_URL: {OPENAI_BASE}")
+logger.debug(f"  OPENAI_MODEL: '{PREFERRED}' (åŸå§‹å€¼)")
+logger.debug(f"  æœ€ç»ˆæ¨¡å‹åˆ—è¡¨: {FALLBACKS}")
+logger.debug("=" * 60)
+
 
 def chat(system_text: str, messages: list) -> str:
-    if not OPENAI_API_KEY:
+    """
+    è°ƒç”¨ OpenAI API è¿›è¡Œå¯¹è¯
+    
+    å‚æ•°:
+        system_text: ç³»ç»Ÿæç¤ºè¯ï¼Œå®šä¹‰ AI çš„è§’è‰²å’Œè¡Œä¸º
+        messages: æ¶ˆæ¯åˆ—è¡¨ï¼Œæ ¼å¼ä¸º [{"role": "user", "content": "..."}, ...]
+                 role å¯ä»¥æ˜¯ "user"ã€"assistant" æˆ– "system"
+        
+    è¿”å›:
+        str: AI çš„å›å¤æ–‡æœ¬
+             å¦‚æœæ‰€æœ‰æ¨¡å‹éƒ½ä¸å¯ç”¨æˆ– API å¯†é’¥ç¼ºå¤±ï¼Œè¿”å›é”™è¯¯æç¤ºå­—ç¬¦ä¸²
+        
+    å·¥ä½œæµç¨‹:
+        1. æ£€æŸ¥ API å¯†é’¥æ˜¯å¦å­˜åœ¨
+        2. éå†æ¨¡å‹åˆ—è¡¨ï¼ˆé¦–é€‰æ¨¡å‹ -> å¤‡ç”¨æ¨¡å‹ï¼‰
+        3. å°è¯•è°ƒç”¨æ¯ä¸ªæ¨¡å‹ï¼Œç›´åˆ°æˆåŠŸæˆ–æ‰€æœ‰æ¨¡å‹éƒ½å¤±è´¥
+        4. è¿”å›ç¬¬ä¸€ä¸ªæˆåŠŸçš„å“åº”ï¼Œæˆ–é”™è¯¯æç¤º
+        
+    å¼‚å¸¸å¤„ç†:
+        - å¦‚æœæŸä¸ªæ¨¡å‹è°ƒç”¨å¤±è´¥ï¼Œä¼šé™é»˜ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªæ¨¡å‹
+        - æ‰€æœ‰æ¨¡å‹éƒ½å¤±è´¥æ—¶è¿”å›å‹å¥½çš„é”™è¯¯æç¤º
+    """
+    logger.debug("=" * 60)
+    logger.debug("å¼€å§‹è°ƒç”¨ chat() å‡½æ•°")
+    logger.debug(f"ç³»ç»Ÿæç¤ºè¯é•¿åº¦: {len(system_text)} å­—ç¬¦")
+    logger.debug(f"æ¶ˆæ¯æ•°é‡: {len(messages)}")
+    
+    # æ£€æŸ¥ API å¯†é’¥ï¼šå¦‚æœæœªè®¾ç½®ï¼Œç›´æ¥è¿”å›é”™è¯¯æç¤º
+    if not OPENAI_API_KEY or OPENAI_API_KEY == "INSERT API KEY":
+        logger.error("âŒ API å¯†é’¥ç¼ºå¤±æˆ–æœªæ­£ç¡®è®¾ç½®")
+        logger.error(f"   å½“å‰ OPENAI_API_KEY å€¼: '{OPENAI_API_KEY}'")
         return "[OpenAI key missing]"
 
+    # æ£€æŸ¥æ¨¡å‹åˆ—è¡¨æ˜¯å¦ä¸ºç©º
+    if not FALLBACKS:
+        logger.error("âŒ æ¨¡å‹åˆ—è¡¨ä¸ºç©ºï¼Œæ²¡æœ‰å¯ç”¨çš„æ¨¡å‹")
+        return "[No models configured. Please set OPENAI_MODEL in .env file.]"
+
+    # å‡†å¤‡ HTTP è¯·æ±‚å¤´ï¼šåŒ…å«è®¤è¯ä¿¡æ¯å’Œå†…å®¹ç±»å‹
     headers = {
-        "Authorization": f"Bearer {OPENAI_API_KEY}",
-        "Content-Type": "application/json",
+        "Authorization": f"Bearer {OPENAI_API_KEY}",  # Bearer Token è®¤è¯
+        "Content-Type": "application/json",  # JSON å†…å®¹ç±»å‹
     }
+    
+    logger.debug(f"è¯·æ±‚ URL: {OPENAI_BASE}/chat/completions")
+    logger.debug(f"å°†å°è¯• {len(FALLBACKS)} ä¸ªæ¨¡å‹: {FALLBACKS}")
 
-    for model in FALLBACKS:
-        body = {"model": model, "messages": [{"role": "system", "content": system_text}, *messages]}
+    # éå†æ¨¡å‹åˆ—è¡¨ï¼Œå°è¯•æ¯ä¸ªæ¨¡å‹ç›´åˆ°æˆåŠŸ
+    for idx, model in enumerate(FALLBACKS, 1):
+        logger.info(f"ğŸ”„ å°è¯•æ¨¡å‹ {idx}/{len(FALLBACKS)}: {model}")
+        
+        # æ„å»ºè¯·æ±‚ä½“ï¼šåŒ…å«æ¨¡å‹åå’Œæ¶ˆæ¯åˆ—è¡¨
+        # ç³»ç»Ÿæç¤ºè¯ä½œä¸ºç¬¬ä¸€æ¡ system æ¶ˆæ¯
+        body = {
+            "model": model,
+            "messages": [
+                {"role": "system", "content": system_text},  # ç³»ç»Ÿè§’è‰²æ¶ˆæ¯
+                *messages  # å±•å¼€ç”¨æˆ·å’ŒåŠ©æ‰‹çš„å†å²æ¶ˆæ¯
+            ]
+        }
+        
+        # ä½¿ç”¨ JSON æ ¼å¼è¾“å‡º body.messages çš„æ‰€æœ‰å†…å®¹ï¼ˆç±»ä¼¼ jq æ ¼å¼ï¼‰
+        import json
+        logger.debug(f"è¯·æ±‚ä½“ï¼ˆæ¨¡å‹: {model}ï¼‰:")
+        logger.debug(f"  - æ¶ˆæ¯æ•°é‡: {len(body['messages'])}")
+        logger.debug(f"  - messages å†…å®¹ (JSON æ ¼å¼):")
+        logger.debug(json.dumps(body['messages'], indent=2, ensure_ascii=False))
+        
         try:
-            r = requests.post(f"{OPENAI_BASE}/chat/completions", headers=headers, json=body, timeout=60)
+            # å‘é€ POST è¯·æ±‚åˆ° OpenAI Chat Completions API
+            # timeout=60 è¡¨ç¤ºè¯·æ±‚è¶…æ—¶æ—¶é—´ä¸º 60 ç§’
+            logger.debug(f"å‘é€è¯·æ±‚åˆ°: {OPENAI_BASE}/chat/completions")
+            r = requests.post(
+                f"{OPENAI_BASE}/chat/completions",
+                headers=headers,
+                json=body,
+                timeout=60
+            )
+            
+            logger.debug(f"å“åº”çŠ¶æ€ç : {r.status_code}")
+            
+            # å¦‚æœè¯·æ±‚æˆåŠŸï¼ˆçŠ¶æ€ç  200ï¼‰
             if r.status_code == 200:
+                # è§£æ JSON å“åº”
                 data = r.json()
-                return data["choices"][0]["message"]["content"]
+                # æå– AI çš„å›å¤å†…å®¹
+                # choices[0] æ˜¯ç¬¬ä¸€ä¸ªï¼ˆé€šå¸¸ä¹Ÿæ˜¯å”¯ä¸€çš„ï¼‰å›å¤é€‰é¡¹
+                # message.content åŒ…å«å®é™…çš„æ–‡æœ¬å›å¤
+                reply = data["choices"][0]["message"]["content"]
+                logger.info(f"âœ… æ¨¡å‹ {model} è°ƒç”¨æˆåŠŸï¼")
+                logger.debug(f"å›å¤é•¿åº¦: {len(reply)} å­—ç¬¦")
+                logger.debug(f"å›å¤: {reply}")
+                logger.debug("=" * 60)
+                return reply
             else:
-                # try next model
+                # è¯·æ±‚å¤±è´¥ï¼ˆå¦‚æ¨¡å‹ä¸å¯ç”¨ã€é…é¢ä¸è¶³ç­‰ï¼‰ï¼Œç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªæ¨¡å‹
+                error_detail = ""
+                try:
+                    error_data = r.json()
+                    error_detail = error_data.get("error", {}).get("message", "æœªçŸ¥é”™è¯¯")
+                    error_type = error_data.get("error", {}).get("type", "æœªçŸ¥ç±»å‹")
+                    logger.warning(f"âŒ æ¨¡å‹ {model} è°ƒç”¨å¤±è´¥:")
+                    logger.warning(f"   çŠ¶æ€ç : {r.status_code}")
+                    logger.warning(f"   é”™è¯¯ç±»å‹: {error_type}")
+                    logger.warning(f"   é”™è¯¯ä¿¡æ¯: {error_detail}")
+                except:
+                    logger.warning(f"âŒ æ¨¡å‹ {model} è°ƒç”¨å¤±è´¥: çŠ¶æ€ç  {r.status_code}, å“åº”: {r.text[:200]}")
+                
+                # ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªæ¨¡å‹
+                logger.debug(f"ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªæ¨¡å‹...")
                 continue
-        except Exception:
+                
+        except requests.exceptions.Timeout:
+            logger.error(f"â±ï¸ æ¨¡å‹ {model} è¯·æ±‚è¶…æ—¶ï¼ˆ60ç§’ï¼‰")
+            continue
+        except requests.exceptions.ConnectionError as e:
+            logger.error(f"ğŸ”Œ æ¨¡å‹ {model} è¿æ¥é”™è¯¯: {str(e)}")
+            continue
+        except requests.exceptions.RequestException as e:
+            logger.error(f"ğŸŒ æ¨¡å‹ {model} è¯·æ±‚å¼‚å¸¸: {type(e).__name__}: {str(e)}")
+            continue
+        except Exception as e:
+            # å‘ç”Ÿå…¶ä»–å¼‚å¸¸ï¼ˆå¦‚ç½‘ç»œé”™è¯¯ã€è¶…æ—¶ç­‰ï¼‰ï¼Œç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªæ¨¡å‹
+            logger.error(f"ğŸ’¥ æ¨¡å‹ {model} å‘ç”Ÿæœªé¢„æœŸçš„å¼‚å¸¸: {type(e).__name__}: {str(e)}")
+            import traceback
+            logger.debug(traceback.format_exc())
             continue
 
-    return "[All configured models unavailable in this project. Please set OPENAI_MODEL to one you can use.]"
\ No newline at end of file
+    # æ‰€æœ‰æ¨¡å‹éƒ½å¤±è´¥ï¼Œè¿”å›å‹å¥½çš„é”™è¯¯æç¤º
+    logger.error("=" * 60)
+    logger.error("âŒ æ‰€æœ‰æ¨¡å‹éƒ½è°ƒç”¨å¤±è´¥ï¼")
+    logger.error(f"   å°è¯•çš„æ¨¡å‹: {FALLBACKS}")
+    logger.error(f"   API Base URL: {OPENAI_BASE}")
+    logger.error(f"   API Key: {'å·²è®¾ç½®' if OPENAI_API_KEY and OPENAI_API_KEY != 'INSERT API KEY' else 'æœªè®¾ç½®'}")
+    logger.error("=" * 60)
+    return "[All configured models unavailable in this project. Please set OPENAI_MODEL to one you can use.]"
diff --git a/utils/memmachine_client.py b/utils/memmachine_client.py
index 68c4fe0..ea9af1e 100644
--- a/utils/memmachine_client.py
+++ b/utils/memmachine_client.py
@@ -1,220 +1,419 @@
+# memorycare_app/utils/memmachine_client.py
+"""
+MemMachine å®¢æˆ·ç«¯æ¨¡å—
+
+æœ¬æ¨¡å—å°è£…äº†ä¸ MemMachine æŒä¹…åŒ–è®°å¿†æœåŠ¡çš„äº¤äº’ã€‚
+MemMachine æ˜¯ä¸€ä¸ªå¤–éƒ¨æœåŠ¡ï¼Œç”¨äºå­˜å‚¨å’Œæ£€ç´¢ç”¨æˆ·çš„é•¿æœŸè®°å¿†ã€‚
+
+æ ¸å¿ƒåŠŸèƒ½ï¼š
+1. å­˜å‚¨æƒ…æ™¯è®°å¿†ï¼ˆepisodic memoryï¼‰ï¼šå¯¹è¯ã€äº‹ä»¶ç­‰ä¸´æ—¶æ€§è®°å¿†
+2. å­˜å‚¨æ¡£æ¡ˆè®°å¿†ï¼ˆprofile memoryï¼‰ï¼šç”¨æˆ·åå¥½ã€ä¸ªäººä¿¡æ¯ç­‰æ°¸ä¹…æ€§è®°å¿†
+3. æ£€ç´¢è®°å¿†ï¼šæ ¹æ®æŸ¥è¯¢æ¡ä»¶æœç´¢ç›¸å…³è®°å¿†
+"""
+
 import os
 import uuid
+import json
 from typing import List, Dict, Any, Optional
 import requests
 
+# MemMachine æœåŠ¡çš„åŸºç¡€ URL
+# ä»ç¯å¢ƒå˜é‡ MEMMACHINE_BASE_URL è¯»å–ï¼Œå¦‚æœæœªè®¾ç½®åˆ™ä½¿ç”¨é»˜è®¤å€¼ localhost:8080
 BASE_URL = os.getenv("MEMMACHINE_BASE_URL", "http://localhost:8080")
 
+
 class MemMachine:
+    """
+    MemMachine å®¢æˆ·ç«¯ç±»
+    
+    æä¾›ä¸ MemMachine æœåŠ¡äº¤äº’çš„æ‰€æœ‰æ–¹æ³•ï¼ŒåŒ…æ‹¬å­˜å‚¨å’Œæ£€ç´¢è®°å¿†ã€‚
+    """
+    
     def __init__(self, base_url: Optional[str] = None):
+        """
+        åˆå§‹åŒ– MemMachine å®¢æˆ·ç«¯
+        
+        å‚æ•°:
+            base_url: å¯é€‰ï¼ŒMemMachine æœåŠ¡çš„ URL
+                     å¦‚æœæœªæä¾›ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é»˜è®¤å€¼
+        """
+        # ä½¿ç”¨æä¾›çš„ base_urlï¼Œæˆ–å›é€€åˆ°ç¯å¢ƒå˜é‡/é»˜è®¤å€¼
         self.base_url = base_url or BASE_URL
 
     def health(self) -> Dict[str, Any]:
+        """
+        æ£€æŸ¥ MemMachine æœåŠ¡çš„å¥åº·çŠ¶æ€
+        
+        è¿”å›:
+            Dict[str, Any]: æœåŠ¡å¥åº·çŠ¶æ€ä¿¡æ¯
+            
+        å¼‚å¸¸:
+            å¦‚æœæœåŠ¡ä¸å¯ç”¨ï¼Œä¼šæŠ›å‡º requests.HTTPError
+        """
+        # å‘é€ GET è¯·æ±‚åˆ°å¥åº·æ£€æŸ¥ç«¯ç‚¹
         r = requests.get(f"{self.base_url}/health", timeout=10)
+        # å¦‚æœçŠ¶æ€ç ä¸æ˜¯ 2xxï¼ŒæŠ›å‡ºå¼‚å¸¸
         r.raise_for_status()
+        # è¿”å› JSON å“åº”
         return r.json()
 
     def remember(self, user_id: str, text: str, tags: Optional[List[str]] = None) -> Dict[str, Any]:
         """
-        Stores a new memory in MemMachine using the v1/memories endpoint format.
+        å­˜å‚¨ä¸€æ¡æƒ…æ™¯è®°å¿†ï¼ˆepisodic memoryï¼‰
+        
+        æƒ…æ™¯è®°å¿†ç”¨äºå­˜å‚¨ä¸´æ—¶æ€§çš„äº‹ä»¶å’Œå¯¹è¯ï¼Œå¦‚ï¼š
+        - ç”¨æˆ·ä»Šå¤©è¯´äº†ä»€ä¹ˆ
+        - å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…
+        - å¯¹è¯å†å²
+        
+        å‚æ•°:
+            user_id: ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·åï¼‰
+            text: è¦å­˜å‚¨çš„è®°å¿†å†…å®¹æ–‡æœ¬
+            tags: å¯é€‰ï¼Œæ ‡ç­¾åˆ—è¡¨ï¼Œç”¨äºåˆ†ç±»å’Œæ£€ç´¢ï¼Œå¦‚ ["medication_log", "emotional"]
+            
+        è¿”å›:
+            Dict[str, Any]: MemMachine è¿”å›çš„å“åº”æ•°æ®
+            
+        å¼‚å¸¸:
+            å¦‚æœå­˜å‚¨å¤±è´¥ï¼Œä¼šæŠ›å‡º requests.HTTPError
         """
+        # æ„å»º MemMachine API è¯·æ±‚è´Ÿè½½
         payload = {
+            # ä¼šè¯ä¿¡æ¯ï¼šæ ‡è¯†è¿™æ¬¡è®°å¿†å­˜å‚¨çš„ä¸Šä¸‹æ–‡
             "session": {
-                "group_id": user_id,
-                "agent_id": ["memorycare_app"],
-                "user_id": [user_id],
-                "session_id": str(uuid.uuid4())
+                "group_id": user_id,  # ç”¨æˆ·ç»„ IDï¼Œç”¨äºç»„ç»‡ç›¸å…³è®°å¿†
+                "agent_id": ["memorycare_app"],  # åº”ç”¨æ ‡è¯†ç¬¦
+                "user_id": [user_id],  # ç”¨æˆ· ID åˆ—è¡¨
+                #"session_id": str(uuid.uuid4())  # å”¯ä¸€ä¼šè¯ ID
+                "session_id": user_id  # å”¯ä¸€ä¼šè¯ ID
             },
-            "producer": "memorycare_app",
-            "produced_for": user_id,
-            "episode_content": text,
-            "episode_type": "memory_entry",
+            "producer": user_id,  # è®°å¿†çš„ç”Ÿäº§è€…ï¼ˆåº”ç”¨åç§°ï¼‰
+            "produced_for": user_id,  # è®°å¿†çš„ç›®æ ‡ç”¨æˆ·
+            "episode_content": text,  # è®°å¿†çš„å®é™…å†…å®¹
+            "episode_type": "memory_entry",  # è®°å¿†ç±»å‹
             "metadata": {
-                "tags": tags or [],
-                "actual_user_id": user_id
+                "tags": tags or [],  # æ ‡ç­¾åˆ—è¡¨ï¼Œç”¨äºåˆ†ç±»
+                "actual_user_id": user_id  # å®é™…ç”¨æˆ· IDï¼ˆç”¨äºè¿‡æ»¤ï¼‰
             }
         }
 
+        # å‘é€ POST è¯·æ±‚åˆ° MemMachine çš„è®°å¿†å­˜å‚¨ç«¯ç‚¹
+        print(f"[INFO - remember()] Storing memory for {user_id} ...")
+        print(f"[INFO - remember()] Payload: {json.dumps(payload, indent=4)}")
         r = requests.post(f"{self.base_url}/v1/memories", json=payload, timeout=20)
+        print(f"[INFO - remember()] Response: {r.text}")
+        # æ£€æŸ¥å“åº”çŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯ 2xx åˆ™æŠ›å‡ºå¼‚å¸¸
         r.raise_for_status()
+        # è¿”å› JSON å“åº”
         return r.json()
 
     def remember_profile(self, user_id: str, key: str, value: str, category: Optional[str] = None) -> Dict[str, Any]:
-        """Store profile memory - permanent facts about the user."""
+        """
+        å­˜å‚¨ä¸€æ¡æ¡£æ¡ˆè®°å¿†ï¼ˆprofile memoryï¼‰
+        
+        æ¡£æ¡ˆè®°å¿†ç”¨äºå­˜å‚¨æ°¸ä¹…æ€§çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚ï¼š
+        - ç”¨æˆ·åå¥½ï¼ˆå–œæ¬¢ä»€ä¹ˆã€ä¸å–œæ¬¢ä»€ä¹ˆï¼‰
+        - ä¸ªäººä¿¡æ¯ï¼ˆå®¶åº­æˆå‘˜ã€å…´è¶£çˆ±å¥½ï¼‰
+        - åŒ»ç–—ä¿¡æ¯ï¼ˆè¯ç‰©ã€è¿‡æ•å²ï¼‰
+        
+        å‚æ•°:
+            user_id: ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦
+            key: è®°å¿†çš„é”®åï¼Œå¦‚ "favorite_food"ã€"emergency_contact"
+            value: è®°å¿†çš„å€¼ï¼Œå¦‚ "pizza"ã€"John - 123-456-7890"
+            category: å¯é€‰ï¼Œè®°å¿†åˆ†ç±»ï¼Œå¦‚ "personal"ã€"medical"ã€"preference"
+            
+        è¿”å›:
+            Dict[str, Any]: åŒ…å« "ok" é”®çš„å­—å…¸ï¼Œè¡¨ç¤ºå­˜å‚¨æ˜¯å¦æˆåŠŸ
+                           å¦‚æœå¤±è´¥ï¼Œå¯èƒ½åŒ…å« "error" é”®
+        """
+        # æ„å»ºæ¡£æ¡ˆè®°å¿†çš„è¯·æ±‚è´Ÿè½½
         payload = {
             "session": {
-                "group_id": "memorycare_group",
+                "group_id": "memorycare_group",  # ä½¿ç”¨å›ºå®šçš„ç»„ ID ç”¨äºæ¡£æ¡ˆè®°å¿†
                 "agent_id": ["memorycare_app"],
                 "user_id": [user_id],
-                "session_id": str(uuid.uuid4())
+                #"session_id": str(uuid.uuid4())
+                "session_id": user_id
             },
-            "producer": "memorycare_app",
+            "producer": user_id,
             "produced_for": user_id,
-            "episode_content": f"{key}: {value}",  # Store as episode content
-            "episode_type": category or "profile_info",
+            "episode_content": f"{key}: {value}",  # å°†é”®å€¼å¯¹å­˜å‚¨ä¸ºæ–‡æœ¬å†…å®¹
+            "episode_type": category or "profile_info",  # ä½¿ç”¨åˆ†ç±»ä½œä¸ºç±»å‹
             "metadata": {
-                "type": "profile",
-                "key": key,
-                "value": value,
-                "category": category or "personal",
-                "actual_user_id": user_id
-
+                "type": "profile",  # æ ‡è®°ä¸ºæ¡£æ¡ˆç±»å‹
+                "key": key,  # å­˜å‚¨é”®å
+                "value": value,  # å­˜å‚¨å€¼
+                "category": category or "personal",  # åˆ†ç±»
+                "actual_user_id": user_id  # å®é™…ç”¨æˆ· ID
             }
         }
+        print(f"[INFO - remember_profile()] Storing profile memory for {user_id} ...")
+        print(f"[INFO - remember_profile()] Payload: {json.dumps(payload, indent=4)}")
+        
         try:
-            # Use /v1/memories/profile endpoint
+            # å‘é€ POST è¯·æ±‚åˆ°æ¡£æ¡ˆè®°å¿†ç«¯ç‚¹
             r = requests.post(f"{self.base_url}/v1/memories/profile", json=payload, timeout=20)
+            print(f"[INFO - remember_profile()] Response: {r.text}")
+            
+            # æ£€æŸ¥å“åº”çŠ¶æ€ç 
             if r.status_code not in (200, 201):
+                # å¦‚æœå¤±è´¥ï¼Œæ‰“å°è­¦å‘Šä¿¡æ¯
                 print("[WARN] profile write failed:", r.text)
+            
+            # è¿”å›æˆåŠŸçŠ¶æ€
             return {"ok": r.status_code in (200, 201)}
         except Exception as e:
+            # æ•è·å¼‚å¸¸å¹¶è¿”å›é”™è¯¯ä¿¡æ¯
             print("[ERROR] profile write exception:", e)
             return {"ok": False, "error": str(e)}
 
     def retrieve(self, user_id: str, query: Optional[str] = None, top_k: int = 10) -> list:
         """
-        Retrieve episodic memories for a user.
-        Handles the nested response format:
-        {"status":0, "content":{"episodic_memory":[[], [ {...}, {...} ], [""]]}}
+        æ£€ç´¢ç”¨æˆ·çš„æƒ…æ™¯è®°å¿†
+        
+        æ ¹æ®æŸ¥è¯¢æ¡ä»¶æœç´¢å¹¶è¿”å›ç›¸å…³çš„è®°å¿†ã€‚æ”¯æŒè¯­ä¹‰æœç´¢ï¼Œå¯ä»¥ç†è§£æŸ¥è¯¢çš„æ„å›¾ã€‚
+        
+        å‚æ•°:
+            user_id: ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦
+            query: å¯é€‰ï¼Œæœç´¢æŸ¥è¯¢æ–‡æœ¬ï¼Œå¦‚ "medication"ã€"family"
+                  å¦‚æœä¸º Noneï¼Œè¿”å›æ‰€æœ‰è®°å¿†
+            top_k: è¿”å›çš„æœ€å¤§è®°å¿†æ•°é‡ï¼Œé»˜è®¤ 10
+                   æ³¨æ„ï¼šå®é™…è¯·æ±‚æ—¶ä¼šè¯·æ±‚ top_k * 3 æ¡ï¼Œç„¶åè¿‡æ»¤åè¿”å› top_k æ¡
+            
+        è¿”å›:
+            list: è®°å¿†å¯¹è±¡åˆ—è¡¨ï¼Œæ¯ä¸ªå¯¹è±¡åŒ…å«è®°å¿†å†…å®¹å’Œå…ƒæ•°æ®
+                  å¦‚æœæ£€ç´¢å¤±è´¥æˆ–æ²¡æœ‰åŒ¹é…çš„è®°å¿†ï¼Œè¿”å›ç©ºåˆ—è¡¨
+                  
+        è®°å¿†è¿‡æ»¤:
+            - åªè¿”å›å±äºæŒ‡å®šç”¨æˆ·çš„è®°å¿†ï¼ˆé€šè¿‡ actual_user_id è¿‡æ»¤ï¼‰
+            - é˜²æ­¢ç”¨æˆ·çœ‹åˆ°å…¶ä»–ç”¨æˆ·çš„è®°å¿†
+            
+        å“åº”æ ¼å¼å¤„ç†:
+            MemMachine è¿”å›çš„æ ¼å¼å¯èƒ½æ˜¯åµŒå¥—çš„ï¼š
+            {"status": 0, "content": {"episodic_memory": [[], [{...}, {...}], [""]]}}
+            æœ¬æ–¹æ³•ä¼šå¤„ç†å¤šç§å¯èƒ½çš„å“åº”æ ¼å¼
         """
         import uuid
 
+        # å¦‚æœæŸ¥è¯¢ä¸ºç©ºï¼Œä½¿ç”¨é»˜è®¤æŸ¥è¯¢
         if not query:
             query = "all memories"
 
+        # æ„å»ºæœç´¢è¯·æ±‚è´Ÿè½½
         payload = {
             "session": {
                 "group_id": user_id,
                 "agent_id": ["memorycare_app"],
                 "user_id": [user_id],
-                "session_id": str(uuid.uuid4()),
+                #"session_id": str(uuid.uuid4())
+                "session_id": user_id
             },
-            "query": query,
-            "limit": top_k * 3,
+            "query": query,  # æœç´¢æŸ¥è¯¢æ–‡æœ¬
+            "limit": top_k * 3,  # è¯·æ±‚æ›´å¤šç»“æœä»¥ä¾¿è¿‡æ»¤åä»æœ‰è¶³å¤Ÿæ•°é‡
         }
 
         url = f"{self.base_url}/v1/memories/search"
-        print(f"[INFO] Retrieving memories for {user_id} ...")
+        print(f"[INFO - retrieve()] Retrieving memories for {user_id} ...")
+        print(f"[INFO - retrieve()] Payload: {json.dumps(payload, indent=4)}")
 
         try:
+            # å‘é€ POST è¯·æ±‚åˆ°æœç´¢ç«¯ç‚¹
             r = requests.post(url, json=payload, timeout=20)
             r.raise_for_status()
             data = r.json()
 
             results = []
 
-            # --- Correct unwrapping for your MemMachine response ---
+            # å¤„ç† MemMachine çš„åµŒå¥—å“åº”æ ¼å¼
+            # æ ¼å¼ï¼š{"content": {"episodic_memory": [[], [{...}, {...}], [""]]}}
+            # å®é™…è®°å¿†åœ¨ä¸­é—´åˆ—è¡¨ä¸­ï¼ˆç´¢å¼• 1ï¼‰
             if (
                 isinstance(data, dict)
                 and "content" in data
                 and "episodic_memory" in data["content"]
             ):
                 episodic = data["content"]["episodic_memory"]
-                # episodic is [[], [ {...}, {...} ], [""]]
+                #print(f"[RETRIEVE DEBUG] Episodic: {json.dumps(episodic, indent=4)}")
+
+                # episodic æ˜¯ [[], [{...}, {...}], [""]] æ ¼å¼
                 if isinstance(episodic, list) and len(episodic) > 1:
-                    middle = episodic[1]
-                    if isinstance(middle, list):
-                        results = middle
+                    # åŒæ—¶è·å– episodic[0] å’Œ episodic[1] çš„å†…å®¹ï¼Œåˆå¹¶åˆ°åŒä¸€ä¸ªåˆ—è¡¨ä¸­
+                    results = []
+                    if isinstance(episodic[0], list):
+                        results.extend(episodic[0])
+                    if len(episodic) > 1 and isinstance(episodic[1], list):
+                        results.extend(episodic[1])
+                    print(f"[RETRIEVE DEBUG] Combined results from episodic[0] and episodic[1]: {json.dumps(results, indent=4)}")
 
-            # fallback: if it's already a list of dicts
+            # å›é€€å¤„ç†ï¼šå¦‚æœå“åº”å·²ç»æ˜¯å­—å…¸åˆ—è¡¨æ ¼å¼
             elif isinstance(data, list):
                 results = data
+                print(f"[RETRIEVE DEBUG] Data: {data}")
+            # å›é€€å¤„ç†ï¼šå¦‚æœå“åº”åŒ…å« "results" é”®
             elif isinstance(data, dict) and "results" in data:
                 results = data["results"]
+                print(f"[RETRIEVE DEBUG] Results: {results}")
             else:
+                # æ— æ³•è¯†åˆ«çš„å“åº”æ ¼å¼
                 print("[WARN] Unrecognized episodic response shape:", data)
                 return []
+            
+            # è¿‡æ»¤è®°å¿†ï¼šåªè¿”å›å±äºå½“å‰ç”¨æˆ·çš„è®°å¿†
             filtered = []
             for mem in results:
                 if isinstance(mem, dict):
-                # Debug: print what we're looking at
+                    # è°ƒè¯•ä¿¡æ¯ï¼šæ‰“å°è®°å¿†å†…å®¹é¢„è§ˆ
                     content_preview = mem.get("content", "")[:50]
+                    # è·å–ç”¨æˆ·å…ƒæ•°æ®
                     metadata = mem.get("user_metadata", {})
+                    # è·å–å­˜å‚¨æ—¶çš„å®é™…ç”¨æˆ· ID
                     stored_user = metadata.get("actual_user_id")
                     
+                    # è°ƒè¯•è¾“å‡ºï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰
                     print(f"[RETRIEVE DEBUG] Content: '{content_preview}...'")
-                    print(f"[RETRIEVE DEBUG]   Metadata: {metadata}")
-                    print(f"[RETRIEVE DEBUG]   Stored user: {stored_user}")
-                    print(f"[RETRIEVE DEBUG]   Requested user: {user_id}")
-                    print(f"[RETRIEVE DEBUG]   Match: {stored_user == user_id}")
+                    #print(f"[RETRIEVE DEBUG]   Metadata: {metadata}")
+                    #print(f"[RETRIEVE DEBUG]   Stored user: {stored_user}")
+                    #print(f"[RETRIEVE DEBUG]   Requested user: {user_id}")
+                    #print(f"[RETRIEVE DEBUG]   Match: {stored_user == user_id}")
                     
+                    # åªåŒ…å«å±äºå½“å‰ç”¨æˆ·çš„è®°å¿†
                     if stored_user == user_id:
                         filtered.append(mem)
                         print(f"[RETRIEVE DEBUG]   âœ“ INCLUDED")
                     else:
+                        # è¿‡æ»¤æ‰å…¶ä»–ç”¨æˆ·çš„è®°å¿†
                         print(f"[RETRIEVE DEBUG]   âœ— FILTERED OUT")
         
             print(f"[RETRIEVE] After filtering: {len(filtered)} memories for {user_id}")
             
+            # è¿”å›å‰ top_k æ¡è®°å¿†
             return filtered[:top_k]
 
         except Exception as e:
+            # æ•è·å¼‚å¸¸å¹¶è¿”å›ç©ºåˆ—è¡¨
             print("[ERROR] Retrieval exception:", e)
             return []
+    
     def retrieve_profile(self, user_id: str, category: Optional[str] = None) -> List[Dict[str, Any]]:
-        """Get user's profile memories (permanent facts)."""
+        """
+        æ£€ç´¢ç”¨æˆ·çš„æ¡£æ¡ˆè®°å¿†ï¼ˆæ°¸ä¹…æ€§ä¿¡æ¯ï¼‰
+        
+        å‚æ•°:
+            user_id: ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦
+            category: å¯é€‰ï¼Œè®°å¿†åˆ†ç±»è¿‡æ»¤ï¼Œå¦‚ "personal"ã€"medical"
+                     å¦‚æœä¸º Noneï¼Œè¿”å›æ‰€æœ‰æ¡£æ¡ˆè®°å¿†
+            
+        è¿”å›:
+            List[Dict[str, Any]]: æ¡£æ¡ˆè®°å¿†å¯¹è±¡åˆ—è¡¨
+                                 æ¯ä¸ªå¯¹è±¡åŒ…å«é”®å€¼å¯¹ä¿¡æ¯å’Œå…ƒæ•°æ®
+                                 å¦‚æœæ£€ç´¢å¤±è´¥ï¼Œè¿”å›ç©ºåˆ—è¡¨
+        """
+        # æ„å»ºæ¡£æ¡ˆè®°å¿†æœç´¢è¯·æ±‚è´Ÿè½½
         payload = {
             "session": {
-                "group_id": "memorycare_group",
+                "group_id": "memorycare_group",  # ä½¿ç”¨å›ºå®šçš„ç»„ ID
                 "agent_id": ["memorycare_app"],
                 "user_id": [user_id],
-                "session_id": str(uuid.uuid4())
+                #"session_id": str(uuid.uuid4())
+                "session_id": user_id
             },
-            "query": "profile information",
+            "query": "profile information",  # æœç´¢æŸ¥è¯¢
             "filter": {
-                "produced_for_id": user_id,
-                "additionalProp1": {}
+                "produced_for_id": user_id,  # è¿‡æ»¤æ¡ä»¶ï¼šåªè¿”å›è¯¥ç”¨æˆ·çš„è®°å¿†
+                "additionalProp1": {}  # é¢å¤–çš„è¿‡æ»¤å±æ€§ï¼ˆå ä½ç¬¦ï¼‰
             },
-            "limit": 50
+            "limit": 50  # æœ€å¤šè¿”å› 50 æ¡æ¡£æ¡ˆè®°å¿†
         }
         
         url = f"{self.base_url}/v1/memories/profile/search"
+        print(f"[INFO - retrieve_profile()] Retrieving profile memories for {user_id} ...")
+        print(f"[INFO - retrieve_profile()] Payload: {json.dumps(payload, indent=4)}")
+        
         try:
+            # å‘é€ POST è¯·æ±‚åˆ°æ¡£æ¡ˆè®°å¿†æœç´¢ç«¯ç‚¹
             r = requests.post(url, json=payload, timeout=20)
             r.raise_for_status()
             data = r.json()
             
-            # Handle various response formats similar to episodic
+            # å¤„ç†å¤šç§å¯èƒ½çš„å“åº”æ ¼å¼ï¼ˆç±»ä¼¼æƒ…æ™¯è®°å¿†çš„å¤„ç†ï¼‰
+            # æ ¼å¼ 1ï¼šåµŒå¥—æ ¼å¼ {"content": {"profile_memory": [[], [{...}], [""]]}}
             if isinstance(data, dict) and "content" in data:
                 if "profile_memory" in data["content"]:
                     pm = data["content"]["profile_memory"]
+                    print(f"[RETRIEVE DEBUG] Profile: {json.dumps(pm, indent=4)}")
+
+                    # å¦‚æœæ˜¯åµŒå¥—åˆ—è¡¨æ ¼å¼ï¼Œæå–ä¸­é—´åˆ—è¡¨
                     if isinstance(pm, list) and len(pm) > 1 and isinstance(pm[1], list):
+                        # è¿‡æ»¤ï¼šåªè¿”å›å±äºå½“å‰ç”¨æˆ·çš„è®°å¿†
                         return [m for m in pm[1] if isinstance(m, dict) and m.get("produced_for_id") == user_id]
                     elif isinstance(pm, list):
+                        # å¦‚æœå·²ç»æ˜¯åˆ—è¡¨æ ¼å¼ï¼Œç›´æ¥è¿‡æ»¤
                         return [m for m in pm if isinstance(m, dict)]
             
+            # æ ¼å¼ 2ï¼šåŒ…å« "results" é”®
             if isinstance(data, dict) and "results" in data:
                 return [m for m in data["results"] if m.get("produced_for_id") == user_id]
             
+            # æ ¼å¼ 3ï¼šç›´æ¥æ˜¯åˆ—è¡¨æ ¼å¼
             if isinstance(data, list):
                 return [m for m in data if isinstance(m, dict) and m.get("produced_for_id") == user_id]
             
+            # æ— æ³•è¯†åˆ«çš„å“åº”æ ¼å¼
             print("[WARN] Unrecognized profile response:", data)
             return []
         except Exception as e:
+            # æ•è·å¼‚å¸¸å¹¶è¿”å›ç©ºåˆ—è¡¨
             print("[ERROR] profile retrieval exception:", e)
             return []
+    
     def store_dual_memory(self, user_id: str, episodic_text: str, profile_data: Optional[Dict[str, Any]] = None, tags: Optional[List[str]] = None):
         """
-        Store information in both episodic and profile memory.
+        åŒæ—¶å­˜å‚¨æƒ…æ™¯è®°å¿†å’Œæ¡£æ¡ˆè®°å¿†
         
-        Args:
-            user_id: User identifier
-            episodic_text: Text for episodic memory (events, conversations)
-            profile_data: Dictionary of profile facts {key: value, category: str}
-            tags: Tags for episodic memory
+        è¿™æ˜¯ä¸€ä¸ªä¾¿æ·æ–¹æ³•ï¼Œç”¨äºåœ¨ä¸€æ¬¡æ“ä½œä¸­åŒæ—¶å­˜å‚¨ä¸¤ç§ç±»å‹çš„è®°å¿†ã€‚
+        ä¾‹å¦‚ï¼šç”¨æˆ·æ³¨å†Œæ—¶ï¼Œæ—¢éœ€è¦è®°å½•æ³¨å†Œäº‹ä»¶ï¼ˆæƒ…æ™¯è®°å¿†ï¼‰ï¼Œ
+        ä¹Ÿéœ€è¦å­˜å‚¨ä¸ªäººä¿¡æ¯ï¼ˆæ¡£æ¡ˆè®°å¿†ï¼‰ã€‚
+        
+        å‚æ•°:
+            user_id: ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦
+            episodic_text: æƒ…æ™¯è®°å¿†çš„æ–‡æœ¬å†…å®¹ï¼ˆäº‹ä»¶ã€å¯¹è¯ç­‰ï¼‰
+            profile_data: å¯é€‰ï¼Œæ¡£æ¡ˆè®°å¿†çš„å­—å…¸æ•°æ®
+                         æ ¼å¼ï¼š{"key1": "value1", "key2": "value2", "category": "personal"}
+                         æ³¨æ„ï¼šå­—å…¸ä¸­çš„ "category" é”®ä¼šè¢«ç”¨ä½œæ‰€æœ‰æ¡£æ¡ˆè®°å¿†çš„åˆ†ç±»
+            tags: å¯é€‰ï¼Œæƒ…æ™¯è®°å¿†çš„æ ‡ç­¾åˆ—è¡¨
+            
+        ä½¿ç”¨ç¤ºä¾‹:
+            mm.store_dual_memory(
+                user_id="alice",
+                episodic_text="Alice signed up on 2024-01-01",
+                profile_data={
+                    "full_name": "Alice Smith",
+                    "hobbies": "reading, hiking",
+                    "category": "personal"
+                },
+                tags=["signup", "profile_creation"]
+            )
         """
-        # Store episodic memory
+        # æ­¥éª¤ 1ï¼šå­˜å‚¨æƒ…æ™¯è®°å¿†ï¼ˆäº‹ä»¶è®°å½•ï¼‰
+        print(f"[INFO - store_dual_memory()] Storing dual memory for {user_id} ...")
+        print(f"[INFO - store_dual_memory()] Episodic text: {episodic_text}")
+        print(f"[INFO - store_dual_memory()] Profile data: {json.dumps(profile_data, indent=4)}")
+        print(f"[INFO - store_dual_memory()] Tags: {tags}")
         self.remember(user_id=user_id, text=episodic_text, tags=tags)
         
-        # Store profile memory if provided
+        # æ­¥éª¤ 2ï¼šå¦‚æœæä¾›äº†æ¡£æ¡ˆæ•°æ®ï¼Œå­˜å‚¨æ¡£æ¡ˆè®°å¿†
         if profile_data:
+            # éå†å­—å…¸ä¸­çš„æ¯ä¸ªé”®å€¼å¯¹
             for key, value in profile_data.items():
-                if key != "category" and value:  # Skip category key and empty values
+                # è·³è¿‡ "category" é”®ï¼ˆå®ƒç”¨äºè®¾ç½®åˆ†ç±»ï¼Œä¸æ˜¯è¦å­˜å‚¨çš„æ•°æ®ï¼‰
+                # è·³è¿‡ç©ºå€¼
+                if key != "category" and value:
+                    # è·å–åˆ†ç±»ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤å€¼ "personal"
                     category = profile_data.get("category", "personal")
+                    # å­˜å‚¨æ¡£æ¡ˆè®°å¿†
                     self.remember_profile(
                         user_id=user_id,
                         key=key,
-                        value=str(value),
+                        value=str(value),  # ç¡®ä¿å€¼ä¸ºå­—ç¬¦ä¸²
                         category=category
-                    )
\ No newline at end of file
+                    )
diff --git a/utils/models.py b/utils/models.py
index 5d4d7cb..70ebd4e 100644
--- a/utils/models.py
+++ b/utils/models.py
@@ -1,45 +1,178 @@
 # memorycare_app/utils/models.py
+"""
+æ•°æ®åº“æ¨¡å‹å®šä¹‰æ¨¡å—
+
+æœ¬æ¨¡å—ä½¿ç”¨ SQLModel å®šä¹‰æ•°æ®åº“è¡¨ç»“æ„ï¼ŒåŒ…å«ä»¥ä¸‹å››ä¸ªæ ¸å¿ƒæ¨¡å‹ï¼š
+1. Patientï¼ˆæ‚£è€…ï¼‰ï¼šå­˜å‚¨æ‚£è€…çš„åŸºæœ¬ä¿¡æ¯å’Œè´¦æˆ·ä¿¡æ¯
+2. Medicationï¼ˆè¯ç‰©ï¼‰ï¼šå­˜å‚¨æ‚£è€…éœ€è¦æœç”¨çš„è¯ç‰©ä¿¡æ¯
+3. MedicationLogï¼ˆè¯ç‰©è®°å½•ï¼‰ï¼šè®°å½•æ‚£è€…æ¯æ¬¡æœè¯çš„æƒ…å†µ
+4. Goalï¼ˆç›®æ ‡ï¼‰ï¼šå­˜å‚¨åŒ»ç”Ÿä¸ºæ‚£è€…è®¾å®šçš„æ²»ç–—ç›®æ ‡
+
+æ•°æ®åº“å…³ç³»è¯´æ˜ï¼š
+- Patientï¼ˆæ‚£è€…ï¼‰ä¸ Medicationï¼ˆè¯ç‰©ï¼‰ï¼šä¸€å¯¹å¤šå…³ç³»ï¼ˆä¸€ä¸ªæ‚£è€…å¯ä»¥æœ‰å¤šä¸ªè¯ç‰©ï¼‰
+- Patientï¼ˆæ‚£è€…ï¼‰ä¸ Goalï¼ˆç›®æ ‡ï¼‰ï¼šä¸€å¯¹å¤šå…³ç³»ï¼ˆä¸€ä¸ªæ‚£è€…å¯ä»¥æœ‰å¤šä¸ªç›®æ ‡ï¼‰
+- Medicationï¼ˆè¯ç‰©ï¼‰ä¸ MedicationLogï¼ˆè¯ç‰©è®°å½•ï¼‰ï¼šä¸€å¯¹å¤šå…³ç³»ï¼ˆä¸€ä¸ªè¯ç‰©å¯ä»¥æœ‰å¤šæ¬¡æœè¯è®°å½•ï¼‰
+
+ä½¿ç”¨ SQLModel çš„å¥½å¤„ï¼š
+- åŒæ—¶æ”¯æŒ ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰å’Œ Pydantic éªŒè¯
+- ç±»å‹å®‰å…¨ï¼Œæ”¯æŒ IDE è‡ªåŠ¨è¡¥å…¨
+- è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“è¡¨ç»“æ„
+"""
+
 from typing import Optional, List
 from datetime import datetime
 from sqlmodel import SQLModel, Field, Relationship
 
 
 class Patient(SQLModel, table=True):
+    """
+    æ‚£è€…æ¨¡å‹ï¼ˆPatientï¼‰
+    
+    è¿™æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒç”¨æˆ·æ¨¡å‹ï¼Œå­˜å‚¨æ‰€æœ‰æ‚£è€…çš„åŸºæœ¬ä¿¡æ¯ã€‚
+    æ¯ä¸ªæ‚£è€…å¯ä»¥æœ‰å¤šä¸ªè¯ç‰©ï¼ˆMedicationï¼‰å’Œå¤šä¸ªç›®æ ‡ï¼ˆGoalï¼‰ã€‚
+    
+    æ•°æ®åº“è¡¨åï¼špatient
+    """
+    
+    # ä¸»é”®ï¼šæ‚£è€… IDï¼Œè‡ªåŠ¨é€’å¢ï¼Œåˆ›å»ºæ–°æ‚£è€…æ—¶ç”±æ•°æ®åº“è‡ªåŠ¨åˆ†é…
     id: Optional[int] = Field(default=None, primary_key=True)
+    
+    # ç”¨æˆ·åï¼šç”¨äºç™»å½•çš„å”¯ä¸€æ ‡è¯†ç¬¦
+    # index=True è¡¨ç¤ºåœ¨æ•°æ®åº“ä¸­å¯¹è¯¥å­—æ®µåˆ›å»ºç´¢å¼•ï¼Œæé«˜æŸ¥è¯¢é€Ÿåº¦
+    # unique=True è¡¨ç¤ºè¯¥å­—æ®µå€¼å¿…é¡»å”¯ä¸€ï¼Œä¸èƒ½æœ‰é‡å¤çš„ç”¨æˆ·å
     username: str = Field(index=True, unique=True)
+    
+    # å¯†ç ï¼šæ‚£è€…ç™»å½•å¯†ç ï¼ˆæ³¨æ„ï¼šå®é™…åº”ç”¨ä¸­åº”è¯¥å­˜å‚¨å“ˆå¸Œå€¼ï¼Œè€Œä¸æ˜¯æ˜æ–‡ï¼‰
     password: str
+    
+    # å…¨åï¼šæ‚£è€…çš„çœŸå®å§“åï¼Œç”¨äºæ˜¾ç¤ºå’Œè¯†åˆ«
     full_name: str
+    
+    # å®¶åº­ä¿¡æ¯ï¼šå¯é€‰å­—æ®µï¼Œå­˜å‚¨æ‚£è€…çš„å®¶åº­èƒŒæ™¯ã€å®¶åº­æˆå‘˜ç­‰ä¿¡æ¯
+    # ç”¨äº AI åŠ©æ‰‹æ›´å¥½åœ°äº†è§£æ‚£è€…çš„ç”Ÿæ´»ç¯å¢ƒ
     family_info: Optional[str] = None
+    
+    # ç´§æ€¥è”ç³»äººå§“åï¼šå¯é€‰å­—æ®µï¼Œç”¨äºç´§æ€¥æƒ…å†µä¸‹çš„è”ç³»
     emergency_contact_name: Optional[str] = None
+    
+    # ç´§æ€¥è”ç³»äººç”µè¯ï¼šå¯é€‰å­—æ®µï¼Œä¸ç´§æ€¥è”ç³»äººå§“åé…å¥—ä½¿ç”¨
     emergency_contact_phone: Optional[str] = None
-    hobbies: Optional[str] = None  # NEW FIELD
+    
+    # å…´è¶£çˆ±å¥½ï¼šå¯é€‰å­—æ®µï¼Œå­˜å‚¨æ‚£è€…çš„å…´è¶£çˆ±å¥½
+    # ç”¨äº AI åŠ©æ‰‹ä¸æ‚£è€…è¿›è¡Œæ›´ä¸ªæ€§åŒ–çš„å¯¹è¯ï¼Œå»ºç«‹æ›´å¥½çš„å…³ç³»
+    hobbies: Optional[str] = None
 
+    # å…³ç³»å­—æ®µï¼šä¸€ä¸ªæ‚£è€…å¯ä»¥æœ‰å¤šä¸ªè¯ç‰©
+    # Relationship å®šä¹‰ ORM å…³ç³»ï¼Œback_populates="patient" è¡¨ç¤ºåœ¨ Medication æ¨¡å‹ä¸­ä¹Ÿæœ‰å¯¹åº”çš„ patient å…³ç³»
+    # ä½¿ç”¨å­—ç¬¦ä¸² "Medication" æ˜¯å› ä¸ºæ­¤æ—¶ Medication ç±»è¿˜æœªå®šä¹‰ï¼Œé¿å…å‰å‘å¼•ç”¨é—®é¢˜
     medications: List["Medication"] = Relationship(back_populates="patient")
+    
+    # å…³ç³»å­—æ®µï¼šä¸€ä¸ªæ‚£è€…å¯ä»¥æœ‰å¤šä¸ªç›®æ ‡
+    # åŒæ ·ä½¿ç”¨å­—ç¬¦ä¸² "Goal" é¿å…å‰å‘å¼•ç”¨é—®é¢˜
     goals: List["Goal"] = Relationship(back_populates="patient")
 
 
 class Medication(SQLModel, table=True):
+    """
+    è¯ç‰©æ¨¡å‹ï¼ˆMedicationï¼‰
+    
+    å­˜å‚¨æ‚£è€…éœ€è¦æœç”¨çš„è¯ç‰©ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯ç‰©åç§°ã€æœç”¨é¢‘ç‡ã€å…·ä½“æ—¶é—´ç­‰ã€‚
+    æ¯ä¸ªè¯ç‰©å±äºä¸€ä¸ªæ‚£è€…ï¼Œå¯ä»¥æœ‰å¤šä¸ªæœè¯è®°å½•ï¼ˆMedicationLogï¼‰ã€‚
+    
+    æ•°æ®åº“è¡¨åï¼šmedication
+    """
+    
+    # ä¸»é”®ï¼šè¯ç‰© IDï¼Œè‡ªåŠ¨é€’å¢
     id: Optional[int] = Field(default=None, primary_key=True)
+    
+    # å¤–é”®ï¼šæ‚£è€… IDï¼Œå…³è”åˆ° Patient è¡¨çš„ id å­—æ®µ
+    # foreign_key="patient.id" æŒ‡å®šå¤–é”®å…³ç³»
+    # index=True åˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºç»å¸¸éœ€è¦é€šè¿‡ patient_id æŸ¥è¯¢æŸä¸ªæ‚£è€…çš„æ‰€æœ‰è¯ç‰©
     patient_id: int = Field(foreign_key="patient.id", index=True)
+    
+    # è¯ç‰©åç§°ï¼šä¾‹å¦‚ "é˜¿å¸åŒ¹æ—"ã€"ç»´ç”Ÿç´  D" ç­‰
     name: str
+    
+    # æ¯å¤©æœç”¨æ¬¡æ•°ï¼šé»˜è®¤ä¸º 1 æ¬¡ï¼Œè¡¨ç¤ºè¯¥è¯ç‰©æ¯å¤©éœ€è¦æœç”¨å‡ æ¬¡
+    # ä¾‹å¦‚ï¼š3 è¡¨ç¤ºæ¯å¤© 3 æ¬¡
     times_per_day: int = 1
+    
+    # å…·ä½“æœç”¨æ—¶é—´ï¼šå¯é€‰å­—æ®µï¼Œå­˜å‚¨å…·ä½“çš„æœç”¨æ—¶é—´ç‚¹
+    # æ ¼å¼é€šå¸¸æ˜¯é€—å·åˆ†éš”çš„æ—¶é—´å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ "09:00,14:00,20:00"
+    # å¦‚æœä¸ºç©ºï¼Œåˆ™æŒ‰ç…§ times_per_day å‡åŒ€åˆ†é…æ—¶é—´
     specific_times: Optional[str] = None
+    
+    # æœç”¨è¯´æ˜ï¼šå¯é€‰å­—æ®µï¼Œå­˜å‚¨è¯ç‰©çš„æœç”¨è¯´æ˜
+    # ä¾‹å¦‚ï¼š"é¥­åæœç”¨"ã€"ç”¨æ°´é€æœ"ã€"é¿å…ä¸ç‰›å¥¶åŒæœ" ç­‰
     instructions: Optional[str] = None
+    
+    # æ˜¯å¦æ¿€æ´»ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥è¯ç‰©æ˜¯å¦è¿˜åœ¨ä½¿ç”¨ä¸­
+    # True è¡¨ç¤ºæ‚£è€…å½“å‰æ­£åœ¨æœç”¨æ­¤è¯ç‰©
+    # False è¡¨ç¤ºè¯¥è¯ç‰©å·²åœç”¨ï¼ˆä¾‹å¦‚ç–—ç¨‹ç»“æŸæˆ–åŒ»ç”Ÿè¦æ±‚åœè¯ï¼‰
     active: bool = True
-    start_date: datetime = Field(default_factory=datetime.now)  # NEW
-    end_date: Optional[datetime] = None  # NEW - when to stop
+    
+    # å¼€å§‹æ—¥æœŸï¼šè¯ç‰©å¼€å§‹æœç”¨çš„æ—¥æœŸå’Œæ—¶é—´
+    # default_factory=datetime.now è¡¨ç¤ºåˆ›å»ºè®°å½•æ—¶è‡ªåŠ¨è®¾ç½®ä¸ºå½“å‰æ—¶é—´
+    start_date: datetime = Field(default_factory=datetime.now)
+    
+    # ç»“æŸæ—¥æœŸï¼šå¯é€‰å­—æ®µï¼Œè¯ç‰©åœæ­¢æœç”¨çš„æ—¥æœŸå’Œæ—¶é—´
+    # å¦‚æœä¸º Noneï¼Œè¡¨ç¤ºè¯¥è¯ç‰©ä»åœ¨æœç”¨ä¸­
+    # å½“åŒ»ç”Ÿåœç”¨è¯ç‰©æ—¶ï¼Œä¼šè®¾ç½®æ­¤å­—æ®µ
+    end_date: Optional[datetime] = None
+    
+    # åˆ›å»ºæ—¶é—´ï¼šè®°å½•åˆ›å»ºè¯¥è¯ç‰©è®°å½•çš„æ—¶é—´
+    # ç”¨äºè¿½è¸ªè¯ç‰©ä¿¡æ¯ä½•æ—¶è¢«æ·»åŠ åˆ°ç³»ç»Ÿä¸­
     created_at: datetime = Field(default_factory=datetime.now)
     
+    # å…³ç³»å­—æ®µï¼šåå‘å…³è”åˆ°æ‰€å±çš„æ‚£è€…
+    # back_populates="medications" ä¸ Patient æ¨¡å‹ä¸­çš„ medications å­—æ®µå¯¹åº”
     patient: Patient = Relationship(back_populates="medications")
+    
+    # å…³ç³»å­—æ®µï¼šä¸€ä¸ªè¯ç‰©å¯ä»¥æœ‰å¤šä¸ªæœè¯è®°å½•
+    # æ¯æ¬¡æ‚£è€…æœè¯æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€æ¡ MedicationLog è®°å½•
     logs: List["MedicationLog"] = Relationship(back_populates="medication")
 
 class MedicationLog(SQLModel, table=True):
+    """
+    è¯ç‰©è®°å½•æ¨¡å‹ï¼ˆMedicationLogï¼‰
+    
+    è®°å½•æ‚£è€…æ¯æ¬¡æœè¯çš„æƒ…å†µï¼ŒåŒ…æ‹¬æ˜¯å¦æœç”¨ã€æœç”¨æ—¶é—´ç­‰ã€‚
+    æ¯æ¡è®°å½•å…³è”åˆ°ä¸€ä¸ªå…·ä½“çš„è¯ç‰©ï¼ˆMedicationï¼‰ã€‚
+    
+    æ•°æ®åº“è¡¨åï¼šmedicationlog
+    
+    ç”¨é€”ï¼š
+    - è¿½è¸ªæ‚£è€…çš„æœè¯ä¾ä»æ€§ï¼ˆæ˜¯å¦æŒ‰æ—¶æœè¯ï¼‰
+    - ç”Ÿæˆæœè¯å†å²æŠ¥å‘Š
+    - å¸®åŠ©åŒ»ç”Ÿè¯„ä¼°æ²»ç–—æ•ˆæœ
+    """
+    
+    # ä¸»é”®ï¼šè®°å½• IDï¼Œè‡ªåŠ¨é€’å¢
     id: Optional[int] = Field(default=None, primary_key=True)
+    
+    # å¤–é”®ï¼šè¯ç‰© IDï¼Œå…³è”åˆ° Medication è¡¨çš„ id å­—æ®µ
+    # index=True åˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºç»å¸¸éœ€è¦é€šè¿‡ medication_id æŸ¥è¯¢æŸä¸ªè¯ç‰©çš„æ‰€æœ‰è®°å½•
     medication_id: int = Field(foreign_key="medication.id", index=True)
+    
+    # æ—¥æœŸï¼šè®°å½•è¯¥æœè¯è®°å½•çš„æ—¥æœŸå’Œæ—¶é—´
+    # default_factory=datetime.now è¡¨ç¤ºåˆ›å»ºè®°å½•æ—¶è‡ªåŠ¨è®¾ç½®ä¸ºå½“å‰æ—¶é—´
+    # é€šå¸¸ç”¨äºè®°å½•"åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™æœè¯"æˆ–"å®é™…ä»€ä¹ˆæ—¶å€™æœè¯çš„"
     date: datetime = Field(default_factory=datetime.now)
+    
+    # å®é™…æœç”¨æ—¶é—´ï¼šå¯é€‰å­—æ®µï¼Œå­˜å‚¨æ‚£è€…å®é™…æœç”¨è¯ç‰©çš„æ—¶é—´
+    # æ ¼å¼é€šå¸¸æ˜¯ "HH:MM"ï¼Œä¾‹å¦‚ "09:15"ã€"14:30" ç­‰
+    # å¦‚æœæ‚£è€…æŒ‰æ—¶æœè¯ï¼Œæ­¤å­—æ®µå¯èƒ½ä¸ date ä¸­çš„æ—¶é—´ä¸€è‡´
+    # å¦‚æœæ‚£è€…å¿˜è®°æœè¯æˆ–å»¶è¿Ÿæœè¯ï¼Œæ­¤å­—æ®µä¼šè®°å½•å®é™…æ—¶é—´
     time_taken: Optional[str] = None
+    
+    # æ˜¯å¦å·²æœç”¨ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ‚£è€…æ˜¯å¦å®é™…æœç”¨äº†è¯ç‰©
+    # True è¡¨ç¤ºå·²æœç”¨ï¼ŒFalse è¡¨ç¤ºæœªæœç”¨ï¼ˆå¿˜è®°æˆ–æ‹’ç»ï¼‰
+    # è¿™æ˜¯æœ€é‡è¦çš„å­—æ®µï¼Œç”¨äºåˆ¤æ–­æ‚£è€…çš„æœè¯ä¾ä»æ€§
     taken: bool = False
 
+    # å…³ç³»å­—æ®µï¼šåå‘å…³è”åˆ°æ‰€å±çš„è¯ç‰©
+    # Optional è¡¨ç¤ºåœ¨æŸäº›æŸ¥è¯¢åœºæ™¯ä¸‹å¯èƒ½ä¸éœ€è¦åŠ è½½å…³è”çš„è¯ç‰©å¯¹è±¡
+    # back_populates="logs" ä¸ Medication æ¨¡å‹ä¸­çš„ logs å­—æ®µå¯¹åº”
     medication: Optional["Medication"] = Relationship(back_populates="logs")
 
 
@@ -48,11 +181,48 @@ class MedicationLog(SQLModel, table=True):
 
 
 class Goal(SQLModel, table=True):
+    """
+    ç›®æ ‡æ¨¡å‹ï¼ˆGoalï¼‰
+    
+    å­˜å‚¨åŒ»ç”Ÿä¸ºæ‚£è€…è®¾å®šçš„æ²»ç–—ç›®æ ‡æˆ–åº·å¤ç›®æ ‡ã€‚
+    ä¾‹å¦‚ï¼š"æ¯å¤©æ•£æ­¥ 30 åˆ†é’Ÿ"ã€"å®Œæˆè®°å¿†è®­ç»ƒæ¸¸æˆ" ç­‰ã€‚
+    æ¯ä¸ªç›®æ ‡å±äºä¸€ä¸ªæ‚£è€…ï¼Œå¯ä»¥æ ‡è®°ä¸ºå·²å®Œæˆã€‚
+    
+    æ•°æ®åº“è¡¨åï¼šgoal
+    
+    ç”¨é€”ï¼š
+    - å¸®åŠ©æ‚£è€…è®¾å®šå’Œè¿½è¸ªæ²»ç–—ç›®æ ‡
+    - è¯„ä¼°æ‚£è€…çš„åº·å¤è¿›åº¦
+    - AI åŠ©æ‰‹å¯ä»¥æ ¹æ®ç›®æ ‡æä¾›ä¸ªæ€§åŒ–çš„æé†’å’Œé¼“åŠ±
+    """
+    
+    # ä¸»é”®ï¼šç›®æ ‡ IDï¼Œè‡ªåŠ¨é€’å¢
     id: Optional[int] = Field(default=None, primary_key=True)
+    
+    # å¤–é”®ï¼šæ‚£è€… IDï¼Œå…³è”åˆ° Patient è¡¨çš„ id å­—æ®µ
+    # index=True åˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºç»å¸¸éœ€è¦é€šè¿‡ patient_id æŸ¥è¯¢æŸä¸ªæ‚£è€…çš„æ‰€æœ‰ç›®æ ‡
     patient_id: int = Field(foreign_key="patient.id", index=True)
+    
+    # ç›®æ ‡æ–‡æœ¬ï¼šç›®æ ‡çš„æè¿°å†…å®¹
+    # ä¾‹å¦‚ï¼š"æ™šé¥­åæ•£æ­¥ 10 åˆ†é’Ÿ"ã€"å®Œæˆä»Šå¤©çš„è®°å¿†è®­ç»ƒ"ã€"æŒ‰æ—¶æœç”¨æ‰€æœ‰è¯ç‰©"
     text: str
+    
+    # æ˜¯å¦å·²å®Œæˆï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥ç›®æ ‡æ˜¯å¦å·²ç»å®Œæˆ
+    # False è¡¨ç¤ºç›®æ ‡è¿˜åœ¨è¿›è¡Œä¸­ï¼ˆæ´»è·ƒç›®æ ‡ï¼‰
+    # True è¡¨ç¤ºç›®æ ‡å·²ç»å®Œæˆ
     completed: bool = False
+    
+    # åˆ›å»ºæ—¶é—´ï¼šç›®æ ‡è¢«åˆ›å»ºçš„æ—¶é—´
+    # default_factory=datetime.now è¡¨ç¤ºåˆ›å»ºè®°å½•æ—¶è‡ªåŠ¨è®¾ç½®ä¸ºå½“å‰æ—¶é—´
+    # ç”¨äºè¿½è¸ªç›®æ ‡ä½•æ—¶è¢«åˆ†é…ç»™æ‚£è€…
     created_at: datetime = Field(default_factory=datetime.now)
+    
+    # å®Œæˆæ—¶é—´ï¼šå¯é€‰å­—æ®µï¼Œç›®æ ‡å®Œæˆçš„æ—¶é—´
+    # å¦‚æœä¸º Noneï¼Œè¡¨ç¤ºç›®æ ‡å°šæœªå®Œæˆ
+    # å½“ç›®æ ‡è¢«æ ‡è®°ä¸ºå®Œæˆæ—¶ï¼Œä¼šè®¾ç½®æ­¤å­—æ®µä¸ºå½“å‰æ—¶é—´
+    # ç”¨äºåˆ†ææ‚£è€…å®Œæˆç›®æ ‡æ‰€éœ€çš„æ—¶é—´ï¼Œè¯„ä¼°åº·å¤è¿›åº¦
     completed_at: Optional[datetime] = None
 
+    # å…³ç³»å­—æ®µï¼šåå‘å…³è”åˆ°æ‰€å±çš„æ‚£è€…
+    # back_populates="goals" ä¸ Patient æ¨¡å‹ä¸­çš„ goals å­—æ®µå¯¹åº”
     patient: Patient = Relationship(back_populates="goals")
diff --git a/utils/scheduler.py b/utils/scheduler.py
index fb91187..497b074 100644
--- a/utils/scheduler.py
+++ b/utils/scheduler.py
@@ -1,41 +1,133 @@
 # memorycare_app/utils/scheduler.py
+"""
+è¯ç‰©æé†’è°ƒåº¦å™¨æ¨¡å—
+
+æœ¬æ¨¡å—è´Ÿè´£è®¡ç®—è¯ç‰©çš„ä¸‹æ¬¡æœç”¨æ—¶é—´ï¼Œåˆ¤æ–­å½“å‰æ˜¯å¦åœ¨æœè¯æ—¶é—´çª—å£å†…ã€‚
+æ”¯æŒä¸¤ç§æ¨¡å¼ï¼šæŒ‡å®šå…·ä½“æ—¶é—´å’Œè‡ªåŠ¨å¹³å‡åˆ†é…ã€‚
+"""
+
 from __future__ import annotations
 from datetime import datetime, time
 from typing import List, Optional
 
+
 def _parse_specific_times(csv_times: Optional[str]) -> List[time]:
+    """
+    è§£æé€—å·åˆ†éš”çš„æ—¶é—´å­—ç¬¦ä¸²ä¸º time å¯¹è±¡åˆ—è¡¨
+    
+    å‚æ•°:
+        csv_times: é€—å·åˆ†éš”çš„æ—¶é—´å­—ç¬¦ä¸²ï¼Œå¦‚ "09:00,14:00,20:00"
+        
+    è¿”å›:
+        List[time]: time å¯¹è±¡åˆ—è¡¨ï¼Œå¦‚ [time(9, 0), time(14, 0), time(20, 0)]
+        
+    ç¤ºä¾‹:
+        _parse_specific_times("09:00,14:00,20:00")
+        # è¿”å› [time(9, 0), time(14, 0), time(20, 0)]
+        
+    æ³¨æ„:
+        - æ— æ•ˆçš„æ—¶é—´æ ¼å¼ä¼šè¢«å¿½ç•¥ï¼ˆä¸æŠ›å‡ºå¼‚å¸¸ï¼‰
+        - ç©ºå­—ç¬¦ä¸²æˆ– None è¿”å›ç©ºåˆ—è¡¨
+    """
+    # å¦‚æœè¾“å…¥ä¸ºç©ºï¼Œç›´æ¥è¿”å›ç©ºåˆ—è¡¨
     if not csv_times:
         return []
+    
     out = []
+    # æŒ‰é€—å·åˆ†å‰²æ—¶é—´å­—ç¬¦ä¸²
     for t in csv_times.split(","):
-        t = t.strip()
+        t = t.strip()  # å»é™¤å‰åç©ºæ ¼
         try:
+            # æŒ‰å†’å·åˆ†å‰²å°æ—¶å’Œåˆ†é’Ÿ
             hh, mm = t.split(":")
+            # è½¬æ¢ä¸º time å¯¹è±¡å¹¶æ·»åŠ åˆ°åˆ—è¡¨
             out.append(time(int(hh), int(mm)))
         except:
+            # å¦‚æœè§£æå¤±è´¥ï¼ˆæ ¼å¼é”™è¯¯ï¼‰ï¼Œè·³è¿‡è¯¥æ—¶é—´
             pass
     return out
 
+
 def next_due_window(now: datetime, times_per_day: int, specific_times: Optional[str]) -> Optional[str]:
-    """Return a friendly message if a dose is due now/soon (+/- 5 min)."""
+    """
+    åˆ¤æ–­å½“å‰æ˜¯å¦åœ¨è¯ç‰©æœç”¨æ—¶é—´çª—å£å†…ï¼ˆÂ±5 åˆ†é’Ÿï¼‰
+    
+    å‚æ•°:
+        now: å½“å‰æ—¥æœŸæ—¶é—´å¯¹è±¡
+        times_per_day: æ¯å¤©éœ€è¦æœç”¨çš„æ¬¡æ•°
+        specific_times: å¯é€‰ï¼Œé€—å·åˆ†éš”çš„å…·ä½“æ—¶é—´å­—ç¬¦ä¸²ï¼Œå¦‚ "09:00,14:00,20:00"
+                      å¦‚æœä¸º Noneï¼Œç³»ç»Ÿä¼šæ ¹æ® times_per_day è‡ªåŠ¨å¹³å‡åˆ†é…æ—¶é—´
+        
+    è¿”å›:
+        Optional[str]: å¦‚æœåœ¨æ—¶é—´çª—å£å†…ï¼Œè¿”å›å‹å¥½çš„æé†’æ¶ˆæ¯å­—ç¬¦ä¸²
+                      å¦‚æœä¸åœ¨æ—¶é—´çª—å£å†…ï¼Œè¿”å› None
+        
+    æ—¶é—´çª—å£:
+        - çª—å£å¤§å°ï¼šÂ±5 åˆ†é’Ÿ
+        - ä¾‹å¦‚ï¼šå¦‚æœè®¾å®šæ—¶é—´ä¸º 09:00ï¼Œåˆ™åœ¨ 08:55-09:05 ä¹‹é—´ä¼šè¿”å›æé†’
+        
+    å·¥ä½œæµç¨‹:
+        1. å¦‚æœæŒ‡å®šäº†å…·ä½“æ—¶é—´ï¼Œæ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦æ¥è¿‘ä»»ä½•ä¸€ä¸ªæŒ‡å®šæ—¶é—´
+        2. å¦‚æœæœªæŒ‡å®šå…·ä½“æ—¶é—´ï¼Œå°†ä¸€å¤©å¹³å‡åˆ†æˆ times_per_day ä¸ªæ—¶é—´æ®µ
+        3. æ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦æ¥è¿‘ä»»ä½•ä¸€ä¸ªæ—¶é—´æ®µ
+        4. å¦‚æœåœ¨çª—å£å†…ï¼Œè¿”å›æé†’æ¶ˆæ¯ï¼›å¦åˆ™è¿”å› None
+        
+    ç¤ºä¾‹:
+        # æŒ‡å®šæ—¶é—´æ¨¡å¼
+        next_due_window(datetime(2024, 1, 1, 9, 2), 3, "09:00,14:00,20:00")
+        # è¿”å› "Medication time window right now (~09:00)."
+        
+        # è‡ªåŠ¨åˆ†é…æ¨¡å¼
+        next_due_window(datetime(2024, 1, 1, 8, 0), 3, None)
+        # å¯èƒ½è¿”å› "Medication time window right now (~08:00)."
+    """
+    # å¦‚æœæ¯å¤©æœç”¨æ¬¡æ•°å°äºç­‰äº 0ï¼Œæ— éœ€æé†’
     if times_per_day <= 0:
         return None
+    
+    # æ—¶é—´çª—å£å¤§å°ï¼š5 åˆ†é’Ÿï¼ˆÂ±5 åˆ†é’Ÿï¼‰
     window = 5  # minutes
 
+    # æ¨¡å¼ 1ï¼šå¦‚æœæŒ‡å®šäº†å…·ä½“æœç”¨æ—¶é—´
     if specific_times:
+        # è§£ææ—¶é—´å­—ç¬¦ä¸²ä¸º time å¯¹è±¡åˆ—è¡¨
         for tt in _parse_specific_times(specific_times):
+            # å°†å½“å‰æ—¥æœŸä¸æŒ‡å®šæ—¶é—´ç»„åˆï¼Œåˆ›å»ºç›®æ ‡æ—¶é—´ç‚¹
+            # replace æ–¹æ³•å°†å½“å‰æ—¶é—´çš„å°æ—¶ã€åˆ†é’Ÿã€ç§’ã€å¾®ç§’æ›¿æ¢ä¸ºæŒ‡å®šå€¼
             dose_dt = now.replace(hour=tt.hour, minute=tt.minute, second=0, microsecond=0)
+            
+            # è®¡ç®—å½“å‰æ—¶é—´ä¸ç›®æ ‡æ—¶é—´çš„å·®å€¼ï¼ˆä»¥åˆ†é’Ÿä¸ºå•ä½ï¼‰
             delta = abs((dose_dt - now).total_seconds()) / 60
+            
+            # å¦‚æœå·®å€¼åœ¨æ—¶é—´çª—å£å†…ï¼ˆâ‰¤5 åˆ†é’Ÿï¼‰ï¼Œè¿”å›æé†’æ¶ˆæ¯
             if delta <= window:
                 return f"Medication time window right now (~{tt.strftime('%H:%M')})."
     else:
-        # equal spacing across day
+        # æ¨¡å¼ 2ï¼šæœªæŒ‡å®šå…·ä½“æ—¶é—´ï¼Œè‡ªåŠ¨å¹³å‡åˆ†é…
+        
+        # è®¡ç®—æ¯ä¸ªæ—¶é—´æ®µä¹‹é—´çš„åˆ†é’Ÿé—´éš”
+        # ä¾‹å¦‚ï¼š3 æ¬¡/å¤© = æ¯ 8 å°æ—¶ä¸€æ¬¡ = 480 åˆ†é’Ÿ
         minutes_per = int(24 * 60 / times_per_day)
+        
+        # ç”Ÿæˆæ‰€æœ‰æ—¶é—´æ®µçš„èµ·å§‹åˆ†é’Ÿæ•°ï¼ˆä» 0 ç‚¹å¼€å§‹ï¼‰
+        # ä¾‹å¦‚ï¼š3 æ¬¡/å¤© = [0, 480, 960] åˆ†é’Ÿ
         slots = [minutes_per * i for i in range(times_per_day)]
+        
+        # å°†å½“å‰æ—¶é—´è½¬æ¢ä¸ºä» 0 ç‚¹å¼€å§‹çš„åˆ†é’Ÿæ•°
+        # ä¾‹å¦‚ï¼š08:30 = 8*60 + 30 = 510 åˆ†é’Ÿ
         now_min = now.hour * 60 + now.minute
+        
+        # æ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦æ¥è¿‘ä»»ä½•ä¸€ä¸ªæ—¶é—´æ®µ
         for sm in slots:
+            # è®¡ç®—å½“å‰æ—¶é—´ä¸æ—¶é—´æ®µèµ·å§‹æ—¶é—´çš„å·®å€¼ï¼ˆåˆ†é’Ÿï¼‰
             delta = abs(sm - now_min)
+            
+            # å¦‚æœå·®å€¼åœ¨æ—¶é—´çª—å£å†…ï¼ˆâ‰¤5 åˆ†é’Ÿï¼‰
             if delta <= window:
+                # å°†åˆ†é’Ÿæ•°è½¬æ¢å›å°æ—¶å’Œåˆ†é’Ÿ
                 hh, mm = divmod(sm, 60)
+                # è¿”å›æé†’æ¶ˆæ¯
                 return f"Medication time window right now (~{hh:02d}:{mm:02d})."
+    
+    # ä¸åœ¨ä»»ä½•æ—¶é—´çª—å£å†…ï¼Œè¿”å› None
     return None
