# ğŸ“š MemoryCare é¡¹ç›®å¼€å‘æŒ‡å—

> **é›¶åŸºç¡€ç”¨æˆ·å¿«é€Ÿä¸Šæ‰‹æŒ‡å—** - ä»ç†è§£é¡¹ç›®åˆ°ä¿®æ”¹ä»£ç çš„å®Œæ•´æ•™ç¨‹

---

## ğŸ“– ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [é¡¹ç›®ç»“æ„è¯¦è§£](#é¡¹ç›®ç»“æ„è¯¦è§£)
4. [æ ¸å¿ƒæ¦‚å¿µç†è§£](#æ ¸å¿ƒæ¦‚å¿µç†è§£)
5. [å¦‚ä½•ä¿®æ”¹ä»£ç ](#å¦‚ä½•ä¿®æ”¹ä»£ç )
6. [å¸¸è§ä¿®æ”¹åœºæ™¯](#å¸¸è§ä¿®æ”¹åœºæ™¯)
7. [è°ƒè¯•æŠ€å·§](#è°ƒè¯•æŠ€å·§)

---

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®æ˜¯ä»€ä¹ˆï¼Ÿ

MemoryCare æ˜¯ä¸€ä¸ª**æ™ºèƒ½æŠ¤ç†åŠ©æ‰‹åº”ç”¨**ï¼Œä¸“é—¨ä¸ºç—´å‘†ç—‡å’Œé˜¿å°”èŒ¨æµ·é»˜ç—…æ‚£è€…è®¾è®¡ã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼š

- **ä¼šè®°ä½çš„ AI**ï¼šä¸åƒæ™®é€šèŠå¤©æœºå™¨äººï¼Œå®ƒä¼šè®°ä½æ‚£è€…çš„æ‰€æœ‰ä¿¡æ¯
- **ä¸ªæ€§åŒ–å¯¹è¯**ï¼šæ ¹æ®æ¯ä¸ªæ‚£è€…çš„ç‰¹ç‚¹è¿›è¡Œä¸ªæ€§åŒ–äº¤æµ
- **è¯ç‰©ç®¡ç†**ï¼šå¸®åŠ©æ‚£è€…æŒ‰æ—¶æœè¯
- **ç›®æ ‡è¿½è¸ª**ï¼šå¸®åŠ©æ‚£è€…å®Œæˆæ²»ç–—ç›®æ ‡

### é¡¹ç›®ç»„æˆ

é¡¹ç›®åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š
1. **åç«¯ï¼ˆAPIï¼‰**ï¼šå¤„ç†æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ã€æ•°æ®åº“æ“ä½œã€AI å¯¹è¯
2. **å‰ç«¯ï¼ˆUIï¼‰**ï¼šç”¨æˆ·ç•Œé¢ï¼Œæ‚£è€…å’ŒåŒ»ç”Ÿé€šè¿‡ç½‘é¡µä½¿ç”¨

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Streamlit UI  â”‚  â† å‰ç«¯ç•Œé¢ï¼ˆç”¨æˆ·çœ‹åˆ°çš„ç½‘é¡µï¼‰
â”‚  (streamlit_app)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP è¯·æ±‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FastAPI åç«¯   â”‚  â† åç«¯æœåŠ¡å™¨ï¼ˆå¤„ç†æ‰€æœ‰é€»è¾‘ï¼‰
â”‚   (api/main.py) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼          â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SQLite â”‚ â”‚MemMachineâ”‚ â”‚ OpenAI  â”‚ â”‚ æ•°æ®åº“   â”‚
â”‚ æ•°æ®åº“  â”‚ â”‚è®°å¿†æœåŠ¡  â”‚ â”‚  AIæœåŠ¡  â”‚ â”‚ æ¨¡å‹     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆè¯´æ˜

| æŠ€æœ¯ | ç”¨é€” | ä¸ºä»€ä¹ˆç”¨å®ƒ |
|------|------|-----------|
| **FastAPI** | åç«¯æ¡†æ¶ | å¿«é€Ÿã€ç°ä»£ã€è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£ |
| **Streamlit** | å‰ç«¯æ¡†æ¶ | ç®€å•æ˜“ç”¨ï¼Œå¿«é€Ÿæ„å»ºç•Œé¢ |
| **SQLModel** | æ•°æ®åº“ ORM | ç±»å‹å®‰å…¨ï¼Œæ˜“äºæ“ä½œæ•°æ®åº“ |
| **SQLite** | æ•°æ®åº“ | è½»é‡çº§ï¼Œæ— éœ€å•ç‹¬å®‰è£…æ•°æ®åº“æœåŠ¡å™¨ |
| **MemMachine** | è®°å¿†æœåŠ¡ | æä¾›æŒä¹…åŒ–è®°å¿†åŠŸèƒ½ |
| **OpenAI** | AI æœåŠ¡ | æä¾›æ™ºèƒ½å¯¹è¯èƒ½åŠ› |

---

## ğŸ“ é¡¹ç›®ç»“æ„è¯¦è§£

### å®Œæ•´ç›®å½•ç»“æ„

```
Memory-Care/
â”œâ”€â”€ api/                    # åç«¯ API ä»£ç 
â”‚   â”œâ”€â”€ __init__.py        # Python åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”‚   â””â”€â”€ main.py            # â­ åç«¯ä¸»æ–‡ä»¶ï¼ˆæœ€é‡è¦çš„æ–‡ä»¶ï¼‰
â”‚
â”œâ”€â”€ ui/                     # å‰ç«¯ç•Œé¢ä»£ç 
â”‚   â””â”€â”€ streamlit_app.py   # â­ å‰ç«¯ä¸»æ–‡ä»¶ï¼ˆç”¨æˆ·ç•Œé¢ï¼‰
â”‚
â”œâ”€â”€ utils/                  # å·¥å…·æ¨¡å—ï¼ˆè¢«å…¶ä»–æ–‡ä»¶è°ƒç”¨çš„åŠŸèƒ½ï¼‰
â”‚   â”œâ”€â”€ models.py          # æ•°æ®æ¨¡å‹ï¼ˆå®šä¹‰æ•°æ®åº“è¡¨ç»“æ„ï¼‰
â”‚   â”œâ”€â”€ db.py              # æ•°æ®åº“è¿æ¥å’Œåˆå§‹åŒ–
â”‚   â”œâ”€â”€ auth.py            # ç”¨æˆ·è®¤è¯ï¼ˆç™»å½•ã€Tokenï¼‰
â”‚   â”œâ”€â”€ llm_client.py      # OpenAI API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ memmachine_client.py  # MemMachine å®¢æˆ·ç«¯
â”‚   â””â”€â”€ scheduler.py       # è¯ç‰©æé†’è°ƒåº¦å™¨
â”‚
â”œâ”€â”€ app.db                  # SQLite æ•°æ®åº“æ–‡ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ requirements.txt        # Python ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ README.md              # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â””â”€â”€ PROJECT_GUIDE.md       # æœ¬æ–‡ä»¶ï¼ˆå¼€å‘æŒ‡å—ï¼‰
```

### å„æ–‡ä»¶èŒè´£è¯´æ˜

#### 1. `api/main.py` - åç«¯æ ¸å¿ƒæ–‡ä»¶ â­â­â­

**ä½œç”¨**ï¼šå¤„ç†æ‰€æœ‰åç«¯é€»è¾‘ï¼Œæä¾› API æ¥å£

**åŒ…å«å†…å®¹**ï¼š
- API è·¯ç”±å®šä¹‰ï¼ˆå¦‚ `/chat`ã€`/auth/patient/login`ï¼‰
- ä¸šåŠ¡é€»è¾‘å¤„ç†
- æ•°æ®åº“æ“ä½œ
- AI å¯¹è¯ç”Ÿæˆ
- è®°å¿†å­˜å‚¨å’Œæ£€ç´¢

**å…³é”®å‡½æ•°**ï¼š
- `chat_with_memory()` - å¤„ç† AI å¯¹è¯ï¼ˆæœ€å¤æ‚ï¼‰
- `patient_signup()` - æ‚£è€…æ³¨å†Œ
- `add_med()` - æ·»åŠ è¯ç‰©
- `add_goal()` - æ·»åŠ ç›®æ ‡

#### 2. `ui/streamlit_app.py` - å‰ç«¯ç•Œé¢æ–‡ä»¶ â­â­â­

**ä½œç”¨**ï¼šæ„å»ºç”¨æˆ·ç•Œé¢ï¼Œä¸åç«¯ API é€šä¿¡

**åŒ…å«å†…å®¹**ï¼š
- ç™»å½•/æ³¨å†Œç•Œé¢
- æ‚£è€…èŠå¤©ç•Œé¢
- åŒ»ç”Ÿç®¡ç†ç•Œé¢
- è¯ç‰©å’Œç›®æ ‡æ˜¾ç¤º

**å…³é”®éƒ¨åˆ†**ï¼š
- ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆ`st.session_state`ï¼‰
- é¡µé¢è·¯ç”±ï¼ˆæ ¹æ®ç™»å½•çŠ¶æ€æ˜¾ç¤ºä¸åŒé¡µé¢ï¼‰
- API è°ƒç”¨ï¼ˆä½¿ç”¨ `requests` åº“ï¼‰

#### 3. `utils/models.py` - æ•°æ®æ¨¡å‹ â­â­

**ä½œç”¨**ï¼šå®šä¹‰æ•°æ®åº“è¡¨ç»“æ„

**åŒ…å«çš„ç±»**ï¼š
- `Patient` - æ‚£è€…ä¿¡æ¯è¡¨
- `Medication` - è¯ç‰©è¡¨
- `MedicationLog` - è¯ç‰©æœç”¨æ—¥å¿—è¡¨
- `Goal` - æ²»ç–—ç›®æ ‡è¡¨

**å¦‚ä½•ç†è§£**ï¼šæ¯ä¸ªç±»å¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ï¼Œç±»çš„å±æ€§å¯¹åº”è¡¨çš„åˆ—

#### 4. `utils/db.py` - æ•°æ®åº“è¿æ¥ â­

**ä½œç”¨**ï¼šç®¡ç†æ•°æ®åº“è¿æ¥

**å…³é”®å‡½æ•°**ï¼š
- `get_session()` - è·å–æ•°æ®åº“ä¼šè¯
- `create_db_and_tables()` - åˆ›å»ºæ•°æ®åº“å’Œè¡¨

#### 5. `utils/auth.py` - è®¤è¯æ¨¡å— â­

**ä½œç”¨**ï¼šå¤„ç†ç”¨æˆ·ç™»å½•å’Œ Token ç®¡ç†

**å…³é”®å‡½æ•°**ï¼š
- `issue_doctor_token()` - ä¸ºåŒ»ç”Ÿé¢å‘ Token
- `issue_patient_token()` - ä¸ºæ‚£è€…é¢å‘ Token
- `whoami()` - éªŒè¯ Token å¹¶è¿”å›ç”¨æˆ·ä¿¡æ¯

#### 6. `utils/llm_client.py` - AI å®¢æˆ·ç«¯ â­â­

**ä½œç”¨**ï¼šä¸ OpenAI API é€šä¿¡ï¼Œç”Ÿæˆ AI å›å¤

**å…³é”®å‡½æ•°**ï¼š
- `chat()` - å‘é€æ¶ˆæ¯ç»™ OpenAIï¼Œè·å–å›å¤

#### 7. `utils/memmachine_client.py` - è®°å¿†æœåŠ¡å®¢æˆ·ç«¯ â­â­

**ä½œç”¨**ï¼šä¸ MemMachine æœåŠ¡é€šä¿¡ï¼Œå­˜å‚¨å’Œæ£€ç´¢è®°å¿†

**å…³é”®å‡½æ•°**ï¼š
- `remember()` - å­˜å‚¨è®°å¿†ï¼ˆé€šè¿‡typeså‚æ•°æ§åˆ¶è®°å¿†ç±»å‹ï¼‰
  - `types=["episodic"]` - åªå­˜å‚¨ä¸ºæƒ…æ™¯è®°å¿†
  - `types=["semantic"]` - åªå­˜å‚¨ä¸ºè¯­ä¹‰è®°å¿†
  - `types=["episodic", "semantic"]` - åŒæ—¶å­˜å‚¨ä¸ºä¸¤ç§ç±»å‹
- `retrieve()` - æ£€ç´¢æƒ…æ™¯è®°å¿†
- `retrieve_semantic()` - æ£€ç´¢è¯­ä¹‰è®°å¿†

#### 8. `utils/scheduler.py` - è°ƒåº¦å™¨ â­

**ä½œç”¨**ï¼šè®¡ç®—è¯ç‰©æœç”¨æ—¶é—´çª—å£

**å…³é”®å‡½æ•°**ï¼š
- `next_due_window()` - åˆ¤æ–­å½“å‰æ˜¯å¦åœ¨æœè¯æ—¶é—´çª—å£å†…

---

## ğŸ§  æ ¸å¿ƒæ¦‚å¿µç†è§£

### 1. ä¸¤ç§è®°å¿†ç±»å‹

#### æƒ…æ™¯è®°å¿†ï¼ˆEpisodic Memoryï¼‰
- **æ˜¯ä»€ä¹ˆ**ï¼šä¸´æ—¶æ€§çš„äº‹ä»¶å’Œå¯¹è¯è®°å½•
- **ä¾‹å­**ï¼š"ä»Šå¤©æ—©ä¸Šåƒäº†æ—©é¤"ã€"æ˜¨å¤©å’Œå¥³å„¿é€šäº†ç”µè¯"
- **ç‰¹ç‚¹**ï¼šä¼šéšæ—¶é—´ç§¯ç´¯ï¼Œç”¨äºç†è§£ä¸Šä¸‹æ–‡

#### è¯­ä¹‰è®°å¿†ï¼ˆSemantic Memoryï¼‰
- **æ˜¯ä»€ä¹ˆ**ï¼šæ°¸ä¹…æ€§çš„ç”¨æˆ·ä¿¡æ¯å’ŒçŸ¥è¯†
- **ä¾‹å­**ï¼š"æˆ‘å–œæ¬¢æ•£æ­¥"ã€"æˆ‘çš„å¥³å„¿å« Sarah"ã€"ç´§æ€¥è”ç³»äººï¼šJohn"
- **ç‰¹ç‚¹**ï¼šä¸ä¼šæ”¹å˜ï¼Œç”¨äºä¸ªæ€§åŒ–å¯¹è¯
- **åŸæ¡£æ¡ˆè®°å¿†**ï¼šåŒ…å«äº†åŸæ¡£æ¡ˆè®°å¿†çš„æ‰€æœ‰åŠŸèƒ½ï¼Œç°åœ¨ç»Ÿä¸€ä¸ºè¯­ä¹‰è®°å¿†
- **å­˜å‚¨æ–¹å¼**ï¼šé€šè¿‡ `remember()` å‡½æ•°ï¼Œè®¾ç½® `types=["semantic"]` æ¥å­˜å‚¨

### 2. æ•°æ®æµå‘

#### ç”¨æˆ·å‘é€æ¶ˆæ¯çš„å®Œæ•´æµç¨‹ï¼š

```
1. ç”¨æˆ·åœ¨ç½‘é¡µè¾“å…¥æ¶ˆæ¯
   â†“
2. Streamlit å‰ç«¯å‘é€ HTTP è¯·æ±‚åˆ°åç«¯
   â†“
3. FastAPI åç«¯æ¥æ”¶è¯·æ±‚
   â†“
4. ä» MemMachine æ£€ç´¢ç›¸å…³è®°å¿†
   â†“
5. ä»æ•°æ®åº“è·å–æ‚£è€…ä¿¡æ¯ï¼ˆè¯ç‰©ã€ç›®æ ‡ç­‰ï¼‰
   â†“
6. æ„å»ºæç¤ºè¯ï¼Œè°ƒç”¨ OpenAI API
   â†“
7. OpenAI è¿”å› AI å›å¤
   â†“
8. æå–æ–°çš„äº‹å®ä¿¡æ¯ï¼Œå­˜å‚¨åˆ° MemMachine
   â†“
9. æ£€æµ‹ç›®æ ‡å®Œæˆæƒ…å†µ
   â†“
10. è¿”å›å›å¤ç»™å‰ç«¯
    â†“
11. Streamlit æ˜¾ç¤ºå›å¤ç»™ç”¨æˆ·
```

### 3. ä¼šè¯çŠ¶æ€ï¼ˆSession Stateï¼‰

**ä»€ä¹ˆæ˜¯ä¼šè¯çŠ¶æ€ï¼Ÿ**
- Streamlit åœ¨é¡µé¢åˆ·æ–°æ—¶ä¼šé‡ç½®æ‰€æœ‰å˜é‡
- `st.session_state` å¯ä»¥åœ¨åˆ·æ–°ä¹‹é—´ä¿æŒæ•°æ®
- ç”¨äºå­˜å‚¨ç™»å½•çŠ¶æ€ã€å¯¹è¯å†å²ç­‰

**å¸¸ç”¨ä¼šè¯å˜é‡**ï¼š
```python
st.session_state.role          # ç”¨æˆ·è§’è‰²ï¼ˆpatient/doctorï¼‰
st.session_state.token         # è®¤è¯ Token
st.session_state.chat_log      # å¯¹è¯å†å²
st.session_state.patient_username  # å½“å‰æ‚£è€…ç”¨æˆ·å
```

### 4. API è¯·æ±‚å’Œå“åº”

**å‰ç«¯å¦‚ä½•è°ƒç”¨åç«¯ï¼Ÿ**

```python
# ç¤ºä¾‹ï¼šå‘é€èŠå¤©æ¶ˆæ¯
response = requests.post(
    "http://127.0.0.1:8000/chat",  # API åœ°å€
    json={                          # è¯·æ±‚æ•°æ®
        "user_id": "alice",
        "message": "ä½ å¥½",
        "token": "pat_xxx"
    }
)
data = response.json()  # è·å–å“åº”æ•°æ®
reply = data["reply"]   # æå– AI å›å¤
```

---

## âœï¸ å¦‚ä½•ä¿®æ”¹ä»£ç 

### ä¿®æ”¹å‰çš„å‡†å¤‡

1. **ç†è§£éœ€æ±‚**ï¼šæ˜ç¡®è¦æ”¹ä»€ä¹ˆåŠŸèƒ½
2. **æ‰¾åˆ°ç›¸å…³æ–‡ä»¶**ï¼šæ ¹æ®åŠŸèƒ½å®šä½åˆ°å¯¹åº”æ–‡ä»¶
3. **é˜…è¯»ç°æœ‰ä»£ç **ï¼šç†è§£å½“å‰å®ç°é€»è¾‘
4. **åˆ¶å®šä¿®æ”¹è®¡åˆ’**ï¼šæƒ³æ¸…æ¥šå¦‚ä½•ä¿®æ”¹

### ä¿®æ”¹æ­¥éª¤

#### æ­¥éª¤ 1ï¼šå®šä½è¦ä¿®æ”¹çš„æ–‡ä»¶

| è¦ä¿®æ”¹çš„åŠŸèƒ½ | ä¸»è¦æ–‡ä»¶ | è¾…åŠ©æ–‡ä»¶ |
|------------|---------|---------|
| ç”¨æˆ·ç•Œé¢ï¼ˆæŒ‰é’®ã€å¸ƒå±€ï¼‰ | `ui/streamlit_app.py` | - |
| API æ¥å£ï¼ˆæ·»åŠ æ–°æ¥å£ï¼‰ | `api/main.py` | - |
| æ•°æ®åº“è¡¨ç»“æ„ | `utils/models.py` | `utils/db.py` |
| è®¤è¯é€»è¾‘ | `utils/auth.py` | `api/main.py` |
| AI å¯¹è¯è¡Œä¸º | `api/main.py` | `utils/llm_client.py` |
| è®°å¿†å­˜å‚¨é€»è¾‘ | `utils/memmachine_client.py` | `api/main.py` |

#### æ­¥éª¤ 2ï¼šç†è§£ä»£ç ç»“æ„

**ä¿®æ”¹ API æ¥å£ç¤ºä¾‹**ï¼š

```python
# åœ¨ api/main.py ä¸­æ·»åŠ æ–°æ¥å£

@app.post("/your-new-endpoint")  # å®šä¹‰è·¯ç”±
def your_new_function(payload: YourModel):  # å®šä¹‰å¤„ç†å‡½æ•°
    """
    å‡½æ•°è¯´æ˜
    """
    # 1. éªŒè¯ç”¨æˆ·èº«ä»½
    info = whoami(payload.token)
    if not info:
        raise HTTPException(401, "Unauthorized")
    
    # 2. å¤„ç†ä¸šåŠ¡é€»è¾‘
    # ... ä½ çš„ä»£ç  ...
    
    # 3. è¿”å›ç»“æœ
    return {"ok": True, "data": result}
```

**ä¿®æ”¹å‰ç«¯ç•Œé¢ç¤ºä¾‹**ï¼š

```python
# åœ¨ ui/streamlit_app.py ä¸­æ·»åŠ æ–°ç•Œé¢å…ƒç´ 

if st.button("æ–°æŒ‰é’®"):  # æ·»åŠ æŒ‰é’®
    # è°ƒç”¨åç«¯ API
    response = requests.post(
        f"{API}/your-new-endpoint",
        json={"token": st.session_state.token}
    )
    if response.ok:
        st.success("æ“ä½œæˆåŠŸï¼")
```

#### æ­¥éª¤ 3ï¼šæµ‹è¯•ä¿®æ”¹

1. **é‡å¯æœåŠ¡**ï¼šä¿®æ”¹ä»£ç åéœ€è¦é‡å¯
2. **æ£€æŸ¥é”™è¯¯**ï¼šæŸ¥çœ‹ç»ˆç«¯æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. **åŠŸèƒ½æµ‹è¯•**ï¼šå®é™…ä½¿ç”¨åŠŸèƒ½ï¼ŒéªŒè¯æ˜¯å¦æ­£å¸¸

---

## ğŸ”§ å¸¸è§ä¿®æ”¹åœºæ™¯

### åœºæ™¯ 1ï¼šæ·»åŠ æ–°çš„æ‚£è€…ä¿¡æ¯å­—æ®µ

**éœ€æ±‚**ï¼šåœ¨æ‚£è€…æ³¨å†Œæ—¶æ·»åŠ "å¹´é¾„"å­—æ®µ

**æ­¥éª¤**ï¼š

1. **ä¿®æ”¹æ•°æ®æ¨¡å‹** (`utils/models.py`)ï¼š
```python
class Patient(SQLModel, table=True):
    # ... ç°æœ‰å­—æ®µ ...
    age: Optional[int] = None  # æ·»åŠ å¹´é¾„å­—æ®µ
```

2. **ä¿®æ”¹æ³¨å†Œæ¥å£** (`api/main.py`)ï¼š
```python
class PatientSignup(BaseModel):
    # ... ç°æœ‰å­—æ®µ ...
    age: Optional[int] = None  # æ·»åŠ å¹´é¾„åˆ°è¯·æ±‚æ¨¡å‹

@app.post("/auth/patient/signup")
def patient_signup(payload: PatientSignup):
    # ... ç°æœ‰ä»£ç  ...
    p = Patient(
        # ... ç°æœ‰å­—æ®µ ...
        age=payload.age,  # æ·»åŠ å¹´é¾„èµ‹å€¼
    )
```

3. **ä¿®æ”¹å‰ç«¯æ³¨å†Œè¡¨å•** (`ui/streamlit_app.py`)ï¼š
```python
# åœ¨æ³¨å†Œè¡¨å•ä¸­æ·»åŠ 
su_age = st.number_input("å¹´é¾„", key="su_age", min_value=0, max_value=150)
# åœ¨æäº¤æ—¶åŒ…å«
payload = {
    # ... ç°æœ‰å­—æ®µ ...
    "age": su_age,
}
```

4. **æ›´æ–°æ•°æ®åº“**ï¼š
   - åˆ é™¤ `app.db` æ–‡ä»¶ï¼ˆæˆ–ä½¿ç”¨æ•°æ®åº“è¿ç§»å·¥å…·ï¼‰
   - é‡å¯åº”ç”¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ–°è¡¨ç»“æ„

### åœºæ™¯ 2ï¼šä¿®æ”¹ AI å¯¹è¯é£æ ¼

**éœ€æ±‚**ï¼šè®© AI æ›´æ­£å¼æˆ–æ›´å‹å¥½

**ä½ç½®**ï¼š`api/main.py` ä¸­çš„ `chat_with_memory()` å‡½æ•°

**ä¿®æ”¹ç³»ç»Ÿæç¤ºè¯**ï¼š
```python
# æ‰¾åˆ°è¿™æ®µä»£ç 
system = (
    "You are MemoryCare, a compassionate companion..."
)

# ä¿®æ”¹ä¸º
system = (
    "You are MemoryCare, a professional and caring companion. "
    "Use formal language but remain warm and supportive..."
)
```

### åœºæ™¯ 3ï¼šæ·»åŠ æ–°çš„ API æ¥å£

**éœ€æ±‚**ï¼šæ·»åŠ è·å–æ‚£è€…ç»Ÿè®¡ä¿¡æ¯çš„æ¥å£

**æ­¥éª¤**ï¼š

1. **åœ¨ `api/main.py` ä¸­æ·»åŠ **ï¼š
```python
@app.get("/patient/stats")
def get_patient_stats(token: str = Query(...)):
    """
    è·å–æ‚£è€…ç»Ÿè®¡ä¿¡æ¯
    """
    # 1. éªŒè¯èº«ä»½
    me = whoami(token)
    if not me or me["role"] != "patient":
        raise HTTPException(401, "Patient auth required")
    
    # 2. æŸ¥è¯¢æ•°æ®
    with get_session() as s:
        patient = s.exec(select(Patient).where(
            Patient.username == me["username"]
        )).first()
        
        # ç»Ÿè®¡è¯ç‰©
        meds_count = len(s.exec(select(Medication).where(
            Medication.patient_id == patient.id
        )).all())
        
        # ç»Ÿè®¡ç›®æ ‡
        goals_count = len(s.exec(select(Goal).where(
            Goal.patient_id == patient.id
        )).all())
    
    # 3. è¿”å›ç»“æœ
    return {
        "ok": True,
        "stats": {
            "medications": meds_count,
            "goals": goals_count
        }
    }
```

2. **åœ¨å‰ç«¯è°ƒç”¨** (`ui/streamlit_app.py`)ï¼š
```python
# åœ¨æ‚£è€…ç•Œé¢æ·»åŠ 
if st.button("æŸ¥çœ‹ç»Ÿè®¡"):
    response = requests.get(
        f"{API}/patient/stats",
        params={"token": st.session_state.token}
    )
    if response.ok:
        stats = response.json()["stats"]
        st.write(f"è¯ç‰©æ•°é‡: {stats['medications']}")
        st.write(f"ç›®æ ‡æ•°é‡: {stats['goals']}")
```

### åœºæ™¯ 4ï¼šä¿®æ”¹ç•Œé¢æ ·å¼

**ä½ç½®**ï¼š`ui/streamlit_app.py` å¼€å¤´çš„ CSS éƒ¨åˆ†

**ç¤ºä¾‹ï¼šä¿®æ”¹æŒ‰é’®é¢œè‰²**ï¼š
```python
# æ‰¾åˆ°è¿™æ®µ CSS
.stButton>button {
    background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
    # ä¿®æ”¹ä¸º
    background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
}
```

### åœºæ™¯ 5ï¼šæ·»åŠ æ–°çš„è®°å¿†ç±»å‹

**éœ€æ±‚**ï¼šæ·»åŠ "åŒ»ç–—è®°å½•"ç±»å‹çš„è®°å¿†

**ä½ç½®**ï¼š`api/main.py` ä¸­çš„è®°å¿†æå–å‡½æ•°

**ä¿®æ”¹**ï¼š
```python
# åœ¨ extract_and_route_memories() å‡½æ•°çš„æç¤ºè¯ä¸­
Categories: personal, family, medical, preference, routine, memory, location, medical_record
# æ·»åŠ æ–°ç±»åˆ«

# åœ¨å­˜å‚¨æ—¶ä½¿ç”¨æ–°ç±»åˆ«
mm.remember(
    user_id=user_id,
    text=text,
    tags=["medical_record"]  # ä½¿ç”¨æ–°æ ‡ç­¾
)
```

---

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹æ—¥å¿—è¾“å‡º

**åç«¯æ—¥å¿—**ï¼š
- å¯åŠ¨åç«¯æ—¶ï¼Œç»ˆç«¯ä¼šæ˜¾ç¤ºæ‰€æœ‰æ—¥å¿—
- æŸ¥æ‰¾ `[DEBUG]`ã€`[ERROR]`ã€`[WARN]` æ ‡è®°

**å‰ç«¯æ—¥å¿—**ï¼š
- Streamlit ä¼šåœ¨ç»ˆç«¯æ˜¾ç¤ºé”™è¯¯
- ä½¿ç”¨ `st.write()` æˆ– `print()` è¾“å‡ºè°ƒè¯•ä¿¡æ¯

### 2. ä½¿ç”¨è°ƒè¯•å·¥å…·

**æ£€æŸ¥ API æ˜¯å¦æ­£å¸¸**ï¼š
```bash
# åœ¨æµè§ˆå™¨è®¿é—®
http://127.0.0.1:8000/health

# æˆ–ä½¿ç”¨ curl
curl http://127.0.0.1:8000/health
```

**æŸ¥çœ‹ API æ–‡æ¡£**ï¼š
```bash
# å¯åŠ¨åç«¯åè®¿é—®
http://127.0.0.1:8000/docs
```

### 3. å¸¸è§é”™è¯¯åŠè§£å†³

| é”™è¯¯ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|------|---------|---------|
| `ModuleNotFoundError` | ç¼ºå°‘ä¾èµ–åŒ… | `pip install -r requirements.txt` |
| `Connection refused` | åç«¯æœªå¯åŠ¨ | å¯åŠ¨åç«¯æœåŠ¡ |
| `401 Unauthorized` | Token æ— æ•ˆ | é‡æ–°ç™»å½• |
| `404 Not Found` | API è·¯å¾„é”™è¯¯ | æ£€æŸ¥è·¯ç”±å®šä¹‰ |
| æ•°æ®åº“é”™è¯¯ | è¡¨ç»“æ„ä¸åŒ¹é… | åˆ é™¤ `app.db` é‡æ–°åˆ›å»º |

### 4. æ·»åŠ è°ƒè¯•ä»£ç 

**åœ¨åç«¯æ·»åŠ è°ƒè¯•**ï¼š
```python
print(f"[DEBUG] å˜é‡å€¼: {variable}")  # æ‰“å°å˜é‡
print(f"[DEBUG] è¯·æ±‚æ•°æ®: {req.dict()}")  # æ‰“å°è¯·æ±‚
```

**åœ¨å‰ç«¯æ·»åŠ è°ƒè¯•**ï¼š
```python
st.write("è°ƒè¯•ä¿¡æ¯:", variable)  # æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š
with st.expander("è°ƒè¯•è¯¦æƒ…"):
    st.json(data)  # æ˜¾ç¤º JSON æ•°æ®
```

---

## ğŸ“ ä»£ç ä¿®æ”¹æ£€æŸ¥æ¸…å•

ä¿®æ”¹ä»£ç åï¼Œæ£€æŸ¥ä»¥ä¸‹äº‹é¡¹ï¼š

- [ ] è¯­æ³•æ­£ç¡®ï¼ˆæ²¡æœ‰æ‹¼å†™é”™è¯¯ï¼‰
- [ ] å¯¼å…¥çš„æ¨¡å—éƒ½å­˜åœ¨
- [ ] å˜é‡åæ‹¼å†™æ­£ç¡®
- [ ] å‡½æ•°å‚æ•°ç±»å‹åŒ¹é…
- [ ] æ•°æ®åº“æ“ä½œæœ‰é”™è¯¯å¤„ç†
- [ ] API è°ƒç”¨æœ‰é”™è¯¯å¤„ç†
- [ ] æµ‹è¯•äº†æ–°åŠŸèƒ½
- [ ] æ²¡æœ‰ç ´åç°æœ‰åŠŸèƒ½

---

## ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ 

### æ¨èå­¦ä¹ èµ„æº

1. **FastAPI å®˜æ–¹æ–‡æ¡£**ï¼šhttps://fastapi.tiangolo.com
2. **Streamlit å®˜æ–¹æ–‡æ¡£**ï¼šhttps://docs.streamlit.io
3. **SQLModel æ–‡æ¡£**ï¼šhttps://sqlmodel.tiangolo.com
4. **Python åŸºç¡€**ï¼šå¦‚æœå¯¹ Python ä¸ç†Ÿæ‚‰ï¼Œå…ˆå­¦ä¹ åŸºç¡€è¯­æ³•

### è¿›é˜¶ä¿®æ”¹å»ºè®®

1. **æ·»åŠ å•å…ƒæµ‹è¯•**ï¼šä¸ºå…³é”®åŠŸèƒ½ç¼–å†™æµ‹è¯•
2. **ä¼˜åŒ–æ€§èƒ½**ï¼šç¼“å­˜å¸¸ç”¨æ•°æ®ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢
3. **å¢å¼ºå®‰å…¨æ€§**ï¼šå¯†ç åŠ å¯†ã€è¾“å…¥éªŒè¯
4. **æ”¹è¿› UI**ï¼šæ·»åŠ åŠ¨ç”»ã€ä¼˜åŒ–å¸ƒå±€
5. **æ·»åŠ æ–°åŠŸèƒ½**ï¼šè¯­éŸ³è¾“å…¥ã€æ•°æ®åˆ†æç­‰

---

## ğŸ’¡ å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨ä»£ç ç‰‡æ®µ

**å‘é€ POST è¯·æ±‚**ï¼š
```python
response = requests.post(
    f"{API}/endpoint",
    json={"key": "value"},
    params={"token": token}
)
```

**å‘é€ GET è¯·æ±‚**ï¼š
```python
response = requests.get(
    f"{API}/endpoint",
    params={"token": token, "param": value}
)
```

**æ•°æ®åº“æŸ¥è¯¢**ï¼š
```python
with get_session() as s:
    result = s.exec(select(Model).where(Model.field == value)).all()
```

**å­˜å‚¨è®°å¿†**ï¼š
```python
mm.remember(
    user_id="username",
    text="è®°å¿†å†…å®¹",
    tags=["tag1", "tag2"]
)
```

**è°ƒç”¨ AI**ï¼š
```python
reply = chat(
    system_prompt,
    [{"role": "user", "content": user_message}]
)
```

---

## â“ å¸¸è§é—®é¢˜

**Q: å¦‚ä½•æ·»åŠ æ–°çš„æ•°æ®åº“è¡¨ï¼Ÿ**
A: åœ¨ `utils/models.py` ä¸­å®šä¹‰æ–°æ¨¡å‹ç±»ï¼Œé‡å¯åº”ç”¨ä¼šè‡ªåŠ¨åˆ›å»ºè¡¨ã€‚

**Q: å¦‚ä½•ä¿®æ”¹ API å“åº”æ ¼å¼ï¼Ÿ**
A: ä¿®æ”¹ `api/main.py` ä¸­å¯¹åº”è·¯ç”±å‡½æ•°çš„è¿”å›å€¼ã€‚

**Q: å¦‚ä½•æ·»åŠ æ–°çš„é¡µé¢ï¼Ÿ**
A: åœ¨ `ui/streamlit_app.py` ä¸­æ·»åŠ æ–°çš„æ¡ä»¶åˆ†æ”¯å’Œç•Œé¢ä»£ç ã€‚

**Q: è®°å¿†å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ**
A: å­˜å‚¨åœ¨ MemMachine æœåŠ¡ä¸­ï¼Œéœ€è¦ MemMachine æœåŠ¡è¿è¡Œã€‚

**Q: å¦‚ä½•é‡ç½®æ•°æ®åº“ï¼Ÿ**
A: åˆ é™¤ `app.db` æ–‡ä»¶ï¼Œé‡å¯åº”ç”¨ã€‚

---

## ğŸ³ Docker éƒ¨ç½²
        
é¡¹ç›®æ”¯æŒä½¿ç”¨ Docker è¿›è¡Œå®¹å™¨åŒ–éƒ¨ç½²ï¼Œä¾¿äºåœ¨ä¸åŒç¯å¢ƒä¸­è¿è¡Œã€‚
        
### Docker æ–‡ä»¶è¯´æ˜
        
- `Dockerfile` - åç«¯æœåŠ¡çš„ Docker æ„å»ºæ–‡ä»¶
- `Dockerfile.ui` - å‰ç«¯æœåŠ¡çš„ Docker æ„å»ºæ–‡ä»¶
- `docker-compose.yml` - Docker Compose é…ç½®æ–‡ä»¶
- `docker-compose.sh` - ä¸€é”®å¯åŠ¨è„šæœ¬
        
### Docker å¯åŠ¨æ–¹å¼
        
```bash
# 1. ç¡®ä¿å·²é…ç½®ç¯å¢ƒå˜é‡ï¼ˆåˆ›å»º .env æ–‡ä»¶ï¼‰
        
# 2. ç¡®ä¿ MemMachine æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆé‡è¦ï¼ï¼‰
#    åœ¨å¯åŠ¨ Docker å®¹å™¨ä¹‹å‰ï¼Œå¿…é¡»å…ˆå¯åŠ¨ MemMachine æœåŠ¡
#    MemMachine æœåŠ¡é€šå¸¸åœ¨ http://localhost:8080 è¿è¡Œ
        
# 3. ç»™å¯åŠ¨è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x docker-compose.sh
        
# 4. å¯åŠ¨æ‰€æœ‰æœåŠ¡
./docker-compose.sh
```

### MemMachine æœåŠ¡å¯åŠ¨

MemoryCare ä¾èµ–å¤–éƒ¨çš„ MemMachine æœåŠ¡æ¥å­˜å‚¨å’Œæ£€ç´¢è®°å¿†ã€‚åœ¨ä½¿ç”¨ Docker éƒ¨ç½²å‰ï¼Œå¿…é¡»ç¡®ä¿ MemMachine æœåŠ¡æ­£åœ¨è¿è¡Œã€‚

#### ä½¿ç”¨ Docker Compose å¿«é€Ÿå¯åŠ¨ MemMachine

MemMachine æä¾›äº† Docker Compose é…ç½®ï¼Œå¯ä»¥å¿«é€Ÿå¯åŠ¨å®Œæ•´çš„ MemMachine æœåŠ¡ï¼š

1. **è¿›å…¥ MemMachine ç›®å½•**
   ```bash
   cd /memverge/MeetUp/MemMachine-MemMachine-dab4fdf
   ```

2. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   # å¤åˆ¶ç¤ºä¾‹ç¯å¢ƒæ–‡ä»¶
   cp sample_configs/env.dockercompose .env
   
   # ç¼–è¾‘ .env æ–‡ä»¶ï¼Œæ·»åŠ ä½ çš„ OpenAI API å¯†é’¥
   # OPENAI_API_KEY=your_openai_api_key_here
   ```

3. **é…ç½® MemMachine æœåŠ¡**
   ```bash
   # å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶
   cp sample_configs/episodic_memory_config.sample configuration.yml
   
   # ç¼–è¾‘ configuration.yml æ–‡ä»¶ï¼Œæ›´æ–°ä»¥ä¸‹å†…å®¹ï¼š
   # - æ›¿æ¢ <YOUR_API_KEY> ä¸ºä½ çš„ OpenAI API å¯†é’¥
   # - æ›¿æ¢ <YOUR_PASSWORD_HERE> ä¸ºä½ çš„ Neo4j å¯†ç 
   # - ç¡®ä¿ host è®¾ç½®ä¸º 'postgres' å’Œ 'neo4j'ï¼ˆDocker ç½‘ç»œä¸­çš„æœåŠ¡åï¼‰
   ```

4. **å¯åŠ¨ MemMachine æœåŠ¡**
   ```bash
   # ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
   ./memmachine-compose.sh
   
   # æˆ–è€…ç›´æ¥ä½¿ç”¨ docker-compose
   docker-compose up -d
   ```

5. **éªŒè¯ MemMachine æœåŠ¡è¿è¡ŒçŠ¶æ€**
   ```bash
   curl http://localhost:8080/health
   ```

#### MemMachine æœåŠ¡æ¶æ„

MemMachine æœåŠ¡åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š
- **PostgreSQL**: å­˜å‚¨æ¡£æ¡ˆè®°å¿†ï¼ˆprofile memoryï¼‰
- **Neo4j**: å­˜å‚¨æƒ…æ™¯è®°å¿†ï¼ˆepisodic memoryï¼‰
- **MemMachine åº”ç”¨**: æä¾› API æ¥å£ï¼Œç«¯å£ 8080

#### Docker ç½‘ç»œé…ç½®

å½“åœ¨ Docker ä¸­è¿è¡Œ MemoryCare æ—¶ï¼Œéœ€è¦ç¡®ä¿å®¹å™¨èƒ½å¤Ÿè®¿é—®å®¿ä¸»æœºä¸Šçš„ MemMachine æœåŠ¡ã€‚åœ¨ `docker-compose.yml` ä¸­å·²é…ç½®ï¼š
```yaml
extra_hosts:
  - "host.docker.internal:172.17.0.1"
```

è¿™ä½¿å¾— MemoryCare å®¹å™¨å¯ä»¥é€šè¿‡ `http://host.docker.internal:8080` è®¿é—®å®¿ä¸»æœºä¸Šçš„ MemMachine æœåŠ¡ã€‚

**è®¿é—®åœ°å€ï¼š**
- å‰ç«¯åº”ç”¨ï¼šhttp://localhost:8501
- åç«¯ APIï¼šhttp://localhost:8000
- API æ–‡æ¡£ï¼šhttp://localhost:8000/docs

### Docker å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨æœåŠ¡
docker-compose up --build -d

# é‡å¯å•ä¸ªæœåŠ¡
docker-compose restart backend
docker-compose restart frontend
```

### å¸¸è§ Docker é—®é¢˜

1. **ç«¯å£å†²çª**ï¼šå¦‚æœå¯åŠ¨å¤±è´¥ï¼Œæ£€æŸ¥ç«¯å£ 8000 æ˜¯å¦è¢«å ç”¨
   ```bash
   sudo netstat -tulpn | grep :8000
   # å¦‚æœ‰å ç”¨ï¼Œç»ˆæ­¢ç›¸åº”è¿›ç¨‹
   sudo kill <PID>
   ```

2. **æƒé™é—®é¢˜**ï¼šå¦‚æœé‡åˆ° Docker æƒé™é”™è¯¯
   ```bash
   # å°†ç”¨æˆ·æ·»åŠ åˆ° docker ç»„
   sudo groupadd docker 2>/dev/null; sudo usermod -aG docker $USER
   # æˆ–ä½¿ç”¨ sudo è¿è¡Œè„šæœ¬
   sudo ./docker-compose.sh
   ```

3. **Docker Compose å‘½ä»¤ä¸å­˜åœ¨**ï¼šæŸäº›ç³»ç»Ÿä½¿ç”¨ `docker compose` è€Œä¸æ˜¯ `docker-compose`
   ```bash
   # æ£€æŸ¥å¯ç”¨å‘½ä»¤
   docker compose version  # æˆ–
   docker-compose --version
   ```

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ä»£ç æ³¨é‡Šï¼ˆæ‰€æœ‰æ–‡ä»¶éƒ½æœ‰è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼‰
2. æ£€æŸ¥ç»ˆç«¯é”™è¯¯ä¿¡æ¯
3. æŸ¥çœ‹ API æ–‡æ¡£ï¼ˆ`http://127.0.0.1:8000/docs`ï¼‰
4. é˜…è¯»ç›¸å…³æŠ€æœ¯æ–‡æ¡£

---

**ç¥æ‚¨å¼€å‘é¡ºåˆ©ï¼** ğŸ‰


